
<%args>
$query
$raw_blast_url => undef
$coverage_graph_url => undef
$click_map_html => undef
@single_coverage_regions => ()
@double_coverage_regions => ()
$error => undef
$fragment_size => undef
@blast_matches => ()
</%args>

% if ($error) { print "An error occurred. $error."}

<center><b>Conservedness Histogram</b></center>
<p>The histogram shows a count of hits <i>for each base</i> in the query sequence,
but counts <i>only the domains BLAST finds</i>, meaning this is really more a function of region than of individual base.
Within the graph, green shows exact base matches within conserved regions; blue shows non-matching bases within conserved regions. Gaps introduced into the query by BLAST are ignored; gaps introduced into target sequences are not.</p>

% print "COVERAGE GRAPH = " .$coverage_graph_url;

<div align="center" style="color: #777777">
<img src="<% $coverage_graph_url %>" />
</div>

view <a href="<% $raw_blast_url %>">raw blast report</a>

% #print "QUERY: $query. ID=".$query->id()." SEQUENCE:".$query->seq()."<br />";

<& /sequence/highlighted.mas, title=>'Single coverage regions in query', seq=>$query, highlight_coords=> \@single_coverage_regions, whole_seq=>1, highlight_description=>'Single coverage regions in the query are highlighted.', collapsable=>1, collapsed=>0 &>

<& /sequence/highlighted.mas, title=>'Double coverage regions in query', seq=>$query, highlight_coords=> \@double_coverage_regions, whole_seq=>1, highlight_description=>'Regions with single or double coverage are are highlighted.', collapsable=>1, collapsed=>1 &>

% #<h2>Single coverage regions</h2>

% #foreach my $r (@single_coverage_regions) { 
% #  print $r->[0]." ".$r->[1]."<br />\n";
% #}

<h2>Sequences with perfect matches above <% $fragment_size %> bp</h2>

% foreach my $b (@blast_matches) {
%   print $b."<br />";
%}
