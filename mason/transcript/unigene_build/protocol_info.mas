<%doc>
  NAME: protocol_info.mas
  VERSION: 1.0
  DESCRIPTION: It is a MASON module for the unigene_build.pl script to show information about as how the unigene build was done 
  AUTHOR: Aureliano Bombarely (ab782@cornell.edu)
</%doc>


<%perl>
use strict;
use warnings;

use SGN::Schema;
use CXGN::Transcript::UnigeneBuild;
use CXGN::Page::FormattingHelpers  qw/ info_section_html info_table_html columnar_table_html page_title_html html_break_string /;


my $protocol_html;
my $protocol_content;

## If there aren't any unigene_build that comes from unigene_build_detail it will do nothing. 
## The error message will returned by basic information

my $unigene_build = $ARGS{'unigene_build'};
my $unigene_build_id = $ARGS{'unigene_build'}->get_unigene_build_id();

my $schema = $ARGS{'schema'};

## Get the method id
my $method_id =  $unigene_build->get_method_id();


if (defined $method_id) {

   ## Get the data from the sgn.method table

   my ($method_row) = $schema->resultset('Protocols')->search({ protocol_id => $method_id });
   my %method_data = $method_row->get_columns();

   ## Create the HTML table

   $protocol_html = <<HTML;

    <table width="75%">
    	   <tr> <td width="25%"> <b>Protocol Name: </b>           </td> <td> $method_data{'protocol_name'} </td></tr>
	   <tr> <td width="25%"> <b>Version: </b>                 </td> <td> $method_data{'version'} </td></tr>
	   <tr> <td width="25%"> <b>Description: </b>             </td> <td> $method_data{'description'} </td></tr>
   </table>
   
   <br>
HTML
   
} else {
    $protocol_html = 'None protocol was found associated to this unigene build';
}

if (defined $unigene_build_id) {
    $protocol_content = info_section_html( title        => "Assembly Protocol", 
                                           contents     => $protocol_html,
   	        	                   collapsible  => 1,
                                           collapsed    => 0, );

}

</%perl>

<% $protocol_content %>
