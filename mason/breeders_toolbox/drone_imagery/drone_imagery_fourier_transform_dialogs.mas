<%args>
</%args>

<& /util/import_javascript.mas, classes => [ 'jquery.iframe-post-form', 'CXGN.BreederSearch', 'd3.d3v4Min.js', 'CXGN.BreedersToolbox.DroneImagery' ] &>

<div class="modal fade" id="drone_imagery_fourier_transform_dialog" name="drone_imagery_fourier_transform_dialog" tabindex="-1" role="dialog" aria-labelledby="droneImageryFourierTransformDialog">
  <div class="modal-dialog modal-xl" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="droneImageryFourierTransformDialog">Fourier Transform</h4>
      </div>
      <div class="modal-body">
        <div class="container-fluid">
            <form class="form-horizontal">
                <div class="row">
                </div>
            </form>
            <div id="fourier_transform_original_stitched_image"></div>
            <canvas id="canvasOutput">
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>



<script>

jQuery(document).ready(function() {

    var gridData = new Array();

    jQuery(document).on('click', 'button[name="project_drone_imagery_fourier_transform"]', function() {
        var trial_id = jQuery(this).data('field_trial_id');
        var stitched_image_id = jQuery(this).data('image_id');
        var stitched_image = jQuery(this).data('stitched_image');
        var drone_run_project_id = jQuery(this).data('drone_run_project_id');

        jQuery('#drone_imagery_fourier_transform_dialog').modal("show");

        jQuery.ajax({
            url : '/ajax/drone_imagery/fourier_transform?image_id='+stitched_image_id+'&drone_run_project_id='+drone_run_project_id,
            beforeSend: function() {
                jQuery("#working_modal").modal("show");
            },
            success: function(response){
                console.log(response);
                jQuery("#working_modal").modal("hide");
                var html = '<img id="originalCanvasInputImage" src="'+response.image_url+'">';
                jQuery('#original_stitched_image').html(html);
                // let src = cv.imread("originalCanvasInputImage");
                // let dst = new cv.Mat();
                // cv.cvtColor(src, dst, cv.COLOR_RGBA2GRAY);
                // cv.imshow('canvasOutput', dst);
                // src.delete();
                // dst.delete();
            },
            error: function(response){
                jQuery("#working_modal").modal("hide");
                alert('Error retrieving fourier transform for image!')
            }
        });

    });

});

</script>
