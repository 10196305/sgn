
<%args>
$trials_by_breeding_project => ()
@locations => ()
@roles => ()
@breeding_programs
</%args>

% print STDERR "Rendering trials page...\n";

<& /util/import_javascript.mas, classes => [ 'jquery', 'jqueryui', 'jquery.iframe-post-form','CXGN.List','CXGN.BreedersToolbox.AddTrial','CXGN.BreedersToolbox.UploadTrial','CXGN.BreedersToolbox.GenotypingTrial', 'CXGN.List', 'CXGN.BreedersToolbox.HTMLSelect' ] &>

 <style>
  /* IE has layout issues when sorting (see #5413) */
  .group { zoom: 1 }
  .genotyping_trial_list_table  {border-spacing:7px;}
  </style>

<br />

<div id="new_submission_process_explanation">
<b>Instructions:</b><br />Please note the changes to the submission process for the Cornell genotyping facility (all database users): 
The system will now contact the genotyping facility server directly, obviating the need for downloading the facility sample spreadsheet in a separate step. To submit samples, simply click on the "Create Genotyping Trial" link and follow the instructions. You will need a list containing 95 or fewer accessions to define the set to be genotyped.

</div>
<br />
<br />
<div id="genotyping_trials_accordion">
  <%perl>
  foreach my $p (sort keys %$trials_by_breeding_project){
    print '<div class="group">';
    print '<h3 class="ui-accordion-header">'.$p.'</h3>'."\n";
    print '<div>';
    print '<p>';
    print '<table class="genotyping_trial_list_table">';
    #print "<tr><td colspan=\"3\"><h4>$p</h4></td></tr>\n";
    foreach my $t (@{$trials_by_breeding_project->{$p}}) {
      print "<tr><td colspan=\"3\"><a href=\"/breeders_toolbox/trial/$t->[0]\">$t->[1]</td><td>$t->[2]</td></tr>\n";
    }
    print '</table>';
    print '</p>';
    print '</div>';
    print '</div>';
  }
  </%perl>

</div>

<div class="modal fade" id="genotyping_trial_dialog" name="igd_genotyping_trial_dialog" tabindex="-1" role="dialog" aria-labelledby="addGenoTrialDialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="addGenoTrialDialog">Add IGD Genotyping Trial</h4>
      </div>
      <div class="modal-body">
        <div class="container-fluid">
	  <form class="form-horizontal" role="form" method="post" enctype="multipart/form-data" encoding="multipart/form-data" id="upload_genotyping_trials_form" name="upload_genotyping_trials_form" action="/ajax/breeders/genotypetrial">
	    <div class="form-group">
      	      <label class="col-sm-3 control-label">Genotyping trial name </label>
      	      <div class="col-sm-9">
	        <input class="form-control" id="genotyping_trial_name" name="genotyping_trial_name" type="text" />
              </div>
	    </div>
	    <div class="form-group">
      	      <label class="col-sm-3 control-label">Breeding Program: </label>
      	      <div class="col-sm-9">
	        <span id="breeding_program_select_div"></span>
              </div>
	    </div>
	    <div class="form-group">
      	      <label class="col-sm-3 control-label">Location: </label>
      	      <div class="col-sm-9">
	        <span id="location_select_div"></span>
              </div>
	    </div>
	    <div class="form-group">
      	      <label class="col-sm-3 control-label">Year: </label>
      	      <div class="col-sm-9">
	        <span id="year_select_div"></span>
              </div>
	    </div>
	    <div class="form-group">
      	      <label class="col-sm-3 control-label">Description: </label>
      	      <div class="col-sm-9">
	        <textarea class="form-control" id="genotyping_trial_description" name="genotyping_trial_description" ></textarea>
              </div>
	    </div>
	    <div class="form-group">
      	      <div class="col-sm-9">
              </div>
	    </div>
	    <div class="form-group">
      	      <label class="col-sm-3 control-label">Accession List: </label>
      	      <div class="col-sm-9">
	        <span id="accession_select_box_span">[loading...]</span>
              </div>
	    </div>
	  </form>      
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary" name="add_geno_trial_submit" id="add_geno_trial_submit">Submit</button>
      </div>
    </div>
  </div>
</div>



