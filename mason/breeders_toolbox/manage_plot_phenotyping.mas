<%args>
$plot_name
</%args>


<& /util/import_javascript.mas, classes => [ 'CXGN.BreedersToolbox.HTMLSelect' ] &>

<& /page/page_title.mas, title=>"Manage Plot Phenotyping" &>

<div class="well well-sm">
  <div class="row">
    <div class="col-md-1 col-lg-1">
    </div>
    <div class="col-md-10 col-lg-10">


      <div class="form-group form-group-sm">
        <label class="col-sm-4 control-label for="plot_name">Plot:</label>
        <div class="col-sm-8">
          <input type="text" value="<%$plot_name%>" class="form-control" id="plot_name" name="plot_name" disabled="1"></input>
        </div>
      </div>

      <br /><br />

      <div class="form-group form-group-sm">
        <label class="col-sm-4 control-label" for="select_traits_for_trait_file">Select trait: </label>
        <div class="col-sm-8">
          <select class="form-control" id="select_traits_for_trait_file"></select>
        </div>
      </div>

      <br /><br />

      <div class="form-group form-group-sm">
        <label class="col-sm-4 control-label">Enter trait value: </label>
        <div class="col-sm-3">
            <input type="number" class="form-control" id="select_pheno_value" name="select_pheno_value"></input>
        </div>
      </div>


    </div>
    <div class="col-md-1 col-lg-1">
  </div>
</div>
</div>

<script>
  jQuery(document).ready(function($) {
    get_select_box('traits', 'select_traits_for_trait_file', {
        'name': 'html_select_traits_for_trait_file',
        'id': 'html_select_traits_for_trait_file',
        'empty': 1
    });

    jQuery('input[name=select_pheno_value]').change(function() {
      var plot_name = jQuery("#plot_name").val();
      var trait = jQuery("#select_traits_for_trait_file").val();
      var trait_value = jQuery("#select_pheno_value").val();
      //alert(plot_name+","+trait+","+trait_value);

      new jQuery.ajax ( {
        type: 'POST',
        url : '/ajax/phenotype/plot_phenotype_upload',
        dataType: "json",
        data: {
                'plot_name' : plot_name,
                'trait' : trait,
                'trait_value' : trait_value,
        },

        success: function (response) {
          if (response.error){
            alert("Error Saving Trait Value: "+response.error);
          }
        },
          error: function() {
            alert('An error occurred saving trait value');
          }

      });

    });


    jQuery("#select_traits_for_trait_file").click(function() {
      var plot_name = jQuery("#plot_name").val();
      var trait = jQuery("#select_traits_for_trait_file").val();
      //alert(plot_name+","+trait);

      new jQuery.ajax ( {
        type: 'POST',
        url : '/ajax/phenotype/plot_phenotype_retrieve',
        dataType: "json",
        data: {
                'plot_name' : plot_name,
                'trait' : trait,
        },

        success: function (response) {

          if (response.error){
            alert("Error Retrieving Trait Value: "+response.error);
          }else{
              jQuery("#select_pheno_value").val(response.trait_value);
          }
        },
          error: function() {
            alert('An error occurred retrieving trait value');
          }

      });


    });



  });

</script>
