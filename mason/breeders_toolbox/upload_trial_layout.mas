
<%args>
@projects => ()
@locations => ()
@roles => ()
</%args>

<& /util/import_javascript.mas, classes => [ 'jquery', 'jqueryui', 'jquery.iframe-post-form' ] &>


<div id="upload_trial_layout_dialog"  class="ui-widget" >
<br>
<div id="content">
<form method="post" action="/trial/upload_trial_layout"  enctype="multipart/form-data" encoding="multipart/form-data" name="upload_trial_layout_form" id="upload_trial_layout_form" >
<dl>

<dt><label for="inputTypeFile">Upload file:</label></dt>
<dd><input type="file" name="inputTypeFile" id="inputTypeFile" encoding="multipart/form-data"/></dd>
<br><br>
<dt><label for="trial">Select trial:</label></dt>
<dd><select id="trial" name="trial" id="trial">
<%perl>
foreach my $project (@projects) {
	print "<option value=".@$project[0].">".@$project[1]."</option>";
}
</%perl>
</select></dd>
<br><br>
<dt><label for="location">Select Location:</label></dt>
<dd><select id="location" name="location" id="location">
<%perl>
foreach my $location (@locations) {
	print "<option value=".@$location[0].">".@$location[1]."</option>";
}
</%perl>
</select></dd>

</dl>
</form>
</div>
</div>





<script defer="defer" >

jQuery('input[type=\"file\"]').each(function(i, it) {
jQuery(it).closest('form').attr('enctype', 'multipart/form-data').attr('encoding', 'multipart/form-data');
});


jQuery( "form#upload_trial_layout_form" )
.attr( "enctype", "multipart/form-data" )
.attr( "encoding", "multipart/form-data" );



 jQuery(document).ready(function() {

   jQuery("#upload_trial_layout_dialog").dialog( {
      autoOpen: false,
      buttons: { "Cancel" :  function() { jQuery("#upload_trial_layout_dialog").dialog("close"); }, "Submit": function() { read_trial_layout_upload() }  },
      modal: true,
      width: 500,
      height: 400,
      title: 'Upload a layout of plots for a trial',
    });
    
    jQuery("#upload_trial_layout_link").click( function () { 
     jQuery("#upload_trial_layout_dialog" ).dialog("open");
    });
   
    function read_trial_layout_upload() { 
      //var formatType = jQuery('input[name=format_type]:checked').val();
      var uploadFile = jQuery("#inputTypeFile").val();
      if (!uploadFile) { alert("Please select a file");return;}
      else { jQuery("#upload_trial_layout_form").submit();}
    }

   jQuery('#upload_trial_layout_form').iframePostForm
	({
           json : true,
           post : function ()
	   {
              var message;
              //alert("You selected a file");
              if (!jQuery('.message').length)
                {
                  alert("no message");
                }

              var formatType = jQuery('input[name=format_type]:checked').val();
              var uploadTrialLayoutFile = jQuery("#inputTypeFile").val();
              alert(jQuery('input[type=radio]').val());
              alert(uploadTrialLayoutFile);
              if (uploadTrialLayoutFile.length)
              {
                alert("something about a file length");
              }
              else
              {
                alert("no length");
              }
           },
           complete : function (response)
           {
              alert("submit complete");
              alert(response.error); 
              alert(response);
              if (!response.success)
              {
                 alert("no success");
              }
              else
              {
                 alert("success");
              }
           }
        });


 });

</script>

