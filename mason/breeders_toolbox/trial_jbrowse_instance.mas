<%args>
$trial_name
</%args>

<p id="trial_jbrowse_check">[loading...]</p>

<%perl>

my $project_name = lc($c->config->{project_name});
my $test_url = "/jbrowse_$project_name/current/data/json/trials/" . $trial_name . "/trackList.json";
my $jbrowse_url = "/jbrowse/?data=data%2Fjson%2Ftrials%2F" . $trial_name;

print STDERR "\n\n\n\n\n\n\n\n\n\n test_url = $test_url \n\n\n\n\n\n\n\n\n\n";

</%perl>

<script type="text/javascript" defer="defer">
jQuery(document).ready(function () {
	prepareJbrowse();

function prepareJbrowse () { //ajax function to test for existence of given jbrowse trial url
  jQuery.ajax({
    type: 'GET',
    url: "<% $test_url %>",
    statusCode: {
        200: function () {  // if page is found, create and display link
		jQuery('#trial_jbrowse_check').replaceWith('<a id="jbrowse_link" href="<% $jbrowse_url %>">View the vcf tracks for <% $trial_name %> in JBrowse</a>');
		},
	404: function () { // if page not found, display message that jbrowse instance wasn't found
		jQuery('#trial_jbrowse_check').html(" <i>No Jbrowse instance found for this trial</i>.");
     		}
	}
  });
}
});
</script>