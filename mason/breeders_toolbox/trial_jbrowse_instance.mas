<%args>
$trial_id
</%args>

<p id="trial_jbrowse_check">[loading...]</p>

<%perl>

my $jbrowse_path = $c->config->{jbrowse_path};
my @path_parts = split('/', $jbrowse_path);
my $basepath = $path_parts[1];
my $test_url = "/" . $basepath ;#. "/index.html";
my $jbrowse_url = $jbrowse_path ."%2Ftrials%2F" . $trial_id ."&tracks=DNA%2CGene%20exons%2C&cat=Diversity/NEXTGEN/Imputed&highlight=";

</%perl>

<script type="text/javascript" defer="defer">
jQuery(document).ready(function () {
	prepareJbrowse();

function prepareJbrowse () { //ajax function to test for existence of given jbrowse trial instance
  jQuery.ajax({
    url: "<% $test_url %>",
    cache: false,
    success: function(response) {
		    console.log(response);
        var find_result = jQuery(response).find("a[href$='/<%$trial_id%>']");
				var filter_result = jQuery(response).filter("a[href$='/<%$trial_id%>']");
        console.log(JSON.stringify(find_result));
				console.log(JSON.stringify(filter_result));
				if ( find_result.length ) { // if jbrowse instance is found, create and display link
					jQuery('#trial_jbrowse_check').replaceWith('<a id="jbrowse_link" href="<% $jbrowse_url %>">View the vcf tracks for this trial in JBrowse</a>');
				}
				else { // if not found, display message that jbrowse instance wasn't found
					jQuery('#trial_jbrowse_check').html(" <i>No Jbrowse instance found for this trial</i>.");
     		}
				}
  });
}
});
</script>
