<%args>
$trial_id
$project_id
</%args>

<& /util/import_javascript.mas, classes => [ 'jquery', 'jquery.dataTables' ] &>

<& /util/import_css.mas, paths => ['/documents/inc/datatables/jquery.dataTables.css'] &>

<table class="table table-hover table-bordered" id="audit_results">

</table>

<script> 

function filterStatusInfo (str){
            alert("went into funct");
            if(str!=null){
            for(var j=0;j<str.length;j++){
              if(str[j]=="{" || str[j]=="}" || str[j]=='"'){
                str = str.replace(str[j],"");
                j--;
              }
              if(str[j]==','){
                str = str.replace(str[j]+" ",'\n');
                j--;
              }
            }
          }
          return str;
        }
    jQuery(document).ready(function () {
      
      
      

      var trial_id = "<% $trial_id %>";
      jQuery.ajax({
        url: '/ajax/audit/retrieve_trial_audits',
        data: {'trial_id':trial_id},
        timeout: 300000,
          success: function(response){
          var data = response.match_project;
          var json_object = JSON.parse(data);
          var num_audit_rows = json_object.length;
          var before_data_string;
          var after_data_string;

          
          for(var j = 0; j<num_audit_rows;j++){
            
            for(var column = 4; column <=5; column++){
              
              var datastring = json_object[j][column];
              

              if(datastring != null){
                for(var i=0;i<datastring.length;i++){
                if (datastring[i]=='{' || datastring[i]=='}' || datastring[i]=='"'){
                  
                  datastring = datastring.replace(datastring[i],"");
                  i--;
                }
                if (datastring[i]==','){
                  datastring = datastring.replace(datastring[i]+" ",'\n');
                  i--;
                }
                
                json_object[j][column] = datastring;
                
                }
              }
            }
          }


          jQuery('#audit_results').DataTable({
              data: json_object,
              columns: [
                  { title: 'Timestamp' },
                  { title: 'Operation' },
                  { title: 'Username' },
                  { title: 'Logged in user' },
                  { title: 'Before' },
                  { title: 'After' },
              ],
              
                
          });

          }
        
      });
    });

</script>
