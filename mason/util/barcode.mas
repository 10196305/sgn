
<%doc>

Generate a barcode from an identifier. The identifer supplied should be as specific as possible, eg. SGN-A3939 for an accession (not just the number!).

</%doc>

<%args>
$identifier
$tempdir
$tempuri
$text => ''
$format => ''
</%args>

<%perl>

use GD;
use Barcode::Code128;

my $cache_file = $tempdir."/barcode-".$identifier;
my $cache_uri  = $tempuri."/barcode-".$identifier;

if (! -e $cache_file.".label") {
  print STDERR "file does not exist..\n\n\n\n";
  my $barcode_object = Barcode::Code128->new();
  $barcode_object->barcode($identifier);
  $barcode_object->font('large');
$barcode_object->border(2);
#  $barcode_object->width(300);
  $barcode_object->top_margin(30);
  $barcode_object->font_align("center");
  my  $barcode = $barcode_object ->gd_image();
  my $text_width = gdLargeFont->width()*length($text);
  $barcode->string(gdLargeFont,int(($barcode->width()-$text_width)/2),10,$text, $barcode->colorAllocate(0, 0, 0));

  open(my $F, ">", $cache_file.".label") || die "Can't open tempfile $cache_file"; 
  print $F $barcode->png();
  close($F);
}
</%perl>

<center><img src="<% $cache_uri.'.label' %>" /></center>
