<%args>
  $opts                       => undef
  $request                    => undef
  $sp_person_autocomplete_uri
  $trait_autocomplete_uri
</%args>

<%once>
    use HTML::FormFu;
    use YAML::Any;
</%once>

<& /util/import_javascript.mas,
 classes=>[qw[CXGN.Effects jquery jqueryui popup] ]
&>
<style>

div[class*="advanced"] {
    display: none;
}

#stock_search_form .select span span {
  white-space: nowrap;
  float: left;
  width: 10em;
}
#stock_search_form div label, #stock_search_form legend {
  font-weight: bold;
}
#stock_search_form label {
  float: left;
  width: 8em;
}

div.paginate_nav {
  margin: 0 auto;
  width: 80%;
  white-space: nowrap;
  text-align: center;
}
</style>


<script language="javascript">
  jQuery(function() {
     jQuery("#person").autocomplete({
        source: '<% $sp_person_autocomplete_uri %>'
     });
     jQuery("#trait").autocomplete({
        source: '<% $trait_autocomplete_uri %>'
     });
  });
</script>

<%perl>

my $form = HTML::FormFu->new(Load(<<EOY));
      method: GET
      action: "/stock/search"
      attributes:
        name: stock_search_form
        id: stock_search_form
      javascript:
            function toggle_advanced() {
                    jQuery('div[class*="advanced"]').toggle();
            }
            jQuery(function(){ jQuery("#advanced_toggle").click(
                function(){
                   toggle_advanced();
                });
            });
      elements:
          - type: Checkbox
            name: advanced
            label: Advanced
            value: unchecked
            id: advanced_toggle
            default: 0

          - type: Text
            name: stock_name
            label: Stock name
            size: 30

          - type: Select
            name: stock_type
            label: Stock type

          - type: Select
            name: organism
            label: Organism

          - type: Hidden
            name: search_submitted
            value: 1

          # hidden form values for page and page size
          - type: Hidden
            name: page
            value: 1

          - type: Hidden
            name: page_size
            default: 20

          - type: Text
            name: person
            id: person
            label: Editor
            container_attributes:
                class: advanced

          - type: Text
            name: trait
            id: trait
            label: Trait
            size: 40
            container_attributes:
                class: advanced

          - type: Text
            name: min_limit
            id: min_limit
            label: Min. value
            size: 5
            container_attributes:
                class: advanced

          - type: Text
            name: max_limit
            id: max_limit
            label: Max. value
            size: 5
            container_attributes:
                class: advanced

          - type: Submit
            name: submit
            value: Search

EOY

    # set the stock type multi-select choices from the db
    $form->get_element({ name => 'stock_type'})->options( $opts->{stock_types} );
    $form->get_element({ name => 'organism'})->options( $opts->{organisms} );

$form->process( $request );


</%perl>


<!-- This CSS should probably go somewhere better -->

<% $form->render %>
