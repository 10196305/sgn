<%args>
</%args>

<& /util/import_javascript.mas, classes => [ 'CXGN.List', 'd3.d3v4Min' ] &>

<&| /page/info_section.mas, id=>"stock_search_graphical_filter", title => 'Graphical Filter Accessions By Traits (Includes all Search Criteria From Above Search Form)', collapsible=>1, collapsed=>1&>

<div class="well well-sm">

<div class="panel panel-default">
    <div class="panel-body">
        <div id="stock_search_graphical_filter_div" style="margin:1em">
        [LOADING...]
        </div>
    </div>
</div>

<br/>

<div class="panel panel-default">
    <div class="panel-body">
        <div style="overflow:scroll">
            <table id="stock_search_graphical_filter_results_div" >
            </table>
        </div>
    </div>
</div>

<br/>

<&| /page/info_section.mas, title => 'Copy Filtered Accessions to a List', collapsible=>1, collapsed=>0, subtitle=>'<i>Copy the accession names in table to a new or exisiting list</i>'&>
<div style="text-align:right" id="graphical_filter_results_to_list_menu"></div>
<div id="graphical_filter_result_names" style="display: none;"></div>
</&>


</div>

</&>

<& '/util/import_javascript.mas', entries => [ 'graphicalfiltering' ] &>
<script>

(function() {
  'use strict';
  var gfilter = jsMod["graphicalfiltering"].init(
    "#stock_search_graphical_filter_div",
    "#stock_search_graphical_filter_results_div"
  );

  gfilter.onUpdate(function(){
    _make_graphical_filtering_list_select();
    jQuery('#stock_search_graphical_filter_results_div').on( 'draw.dt', function () {
        _make_graphical_filtering_list_select();
    });
  });

  function _make_graphical_filtering_list_select(){
      var data = gfilter.current.results_table.context[0].aoData;
      var displayed_rows = gfilter.current.results_table.context[0].aiDisplay;
      var names = [];
      for (var i =0; i< displayed_rows.length; i++){
          var displayed_index = displayed_rows[i];
          names.push(data[displayed_index].nTr.firstChild.innerText+'\n');
      }
      //console.log(names);
      jQuery('#graphical_filter_result_names').html(names);
  }

  addToListMenu('graphical_filter_results_to_list_menu', 'graphical_filter_result_names', {
      listType: 'accessions'
  });
}());
  

</script>
