
use strict;
use warnings;

#use lib 't/lib';
#use SGN::Test::Fixture;
use Test::More;
use Test::WWW::Mechanize;

#Needed to update IO::Socket::SSL
use Data::Dumper;
use JSON;
local $Data::Dumper::Indent = 0;

my $mech = Test::WWW::Mechanize->new;
my $response;

$mech->get_ok('http://localhost:3010/brapi/v1/calls');
$response = decode_json $mech->content;
print STDERR Dumper $response;

is_deeply($response, {'metadata' => {'status' => [{'code' => 'info','message' => 'BrAPI base call found with page=0, pageSize=10'},{'message' => 'Loading CXGN::BrAPI::v1::Calls','code' => 'info'},{'message' => 'Calls result constructed','code' => '200'}],'pagination' => {'pageSize' => 1000,'totalPages' => 1,'currentPage' => 0,'totalCount' => 48},'datafiles' => []},'result' => {'data' => [{'datatypes' => ['json'],'versions' => ['1.0','1.2'],'methods' => ['POST','DELETE'],'call' => 'token'},{'versions' => ['1.0','1.2'],'methods' => ['GET'],'call' => 'calls','datatypes' => ['json']},{'call' => 'observationlevels','methods' => ['GET'],'versions' => ['1.0','1.2'],'datatypes' => ['json']},{'call' => 'germplasm-search','versions' => ['1.0','1.2'],'methods' => ['GET','POST'],'datatypes' => ['json']},{'call' => 'germplasm/{germplasmDbId}','methods' => ['GET'],'versions' => ['1.0','1.2'],'datatypes' => ['json']},{'versions' => ['1.0','1.2'],'methods' => ['GET'],'call' => 'germplasm/{germplasmDbId}/pedigree','datatypes' => ['json']},{'datatypes' => ['json'],'methods' => ['GET'],'versions' => ['1.0','1.2'],'call' => 'germplasm/{germplasmDbId}/progeny'},{'methods' => ['GET'],'versions' => ['1.0','1.2'],'call' => 'germplasm/{germplasmDbId}/markerprofiles','datatypes' => ['json']},{'versions' => ['1.0','1.2'],'methods' => ['GET'],'call' => 'germplasm/{germplasmDbId}/attributes','datatypes' => ['json']},{'datatypes' => ['json'],'versions' => ['1.0','1.2'],'methods' => ['GET'],'call' => 'attributes'},{'methods' => ['GET'],'versions' => ['1.0','1.2'],'call' => 'attributes/categories','datatypes' => ['json']},{'methods' => ['GET'],'versions' => ['1.0','1.2'],'call' => 'markerprofiles','datatypes' => ['json']},{'datatypes' => ['json'],'call' => 'markerprofiles/{markerprofileDbId}','methods' => ['GET'],'versions' => ['1.0','1.2']},{'call' => 'markerprofiles/methods','versions' => ['1.0','1.2'],'methods' => ['GET'],'datatypes' => ['json']},{'datatypes' => ['json','tsv','csv','xls'],'call' => 'allelematrix-search','methods' => ['GET','POST'],'versions' => ['1.0','1.2']},{'datatypes' => ['json','tsv','csv','xls'],'call' => 'allelematrices-search','methods' => ['GET','POST'],'versions' => ['1.0','1.2']},{'call' => 'programs','versions' => ['1.0','1.2'],'methods' => ['GET','POST'],'datatypes' => ['json']},{'datatypes' => ['json'],'versions' => ['1.0','1.2'],'methods' => ['GET'],'call' => 'crops'},{'datatypes' => ['json'],'call' => 'seasons','methods' => ['GET','POST'],'versions' => ['1.0','1.2']},{'datatypes' => ['json'],'versions' => ['1.0','1.2'],'methods' => ['GET','POST'],'call' => 'studytypes'},{'datatypes' => ['json'],'call' => 'trials','versions' => ['1.0','1.2'],'methods' => ['GET','POST']},{'call' => 'trials/{trialDbId}','methods' => ['GET'],'versions' => ['1.0','1.2'],'datatypes' => ['json']},{'call' => 'studies-search','methods' => ['GET','POST'],'versions' => ['1.0','1.2'],'datatypes' => ['json']},{'datatypes' => ['json'],'call' => 'studies/{studyDbId}','methods' => ['GET'],'versions' => ['1.0','1.2']},{'datatypes' => ['json'],'call' => 'studies/{studyDbId}/germplasm','versions' => ['1.0','1.2'],'methods' => ['GET']},{'datatypes' => ['json'],'versions' => ['1.0','1.2'],'methods' => ['GET'],'call' => 'studies/{studyDbId}/observationvariables'},{'call' => 'studies/{studyDbId}/observationunits','methods' => ['GET'],'versions' => ['1.0','1.2'],'datatypes' => ['json']},{'methods' => ['GET'],'versions' => ['1.0','1.2'],'call' => 'studies/{studyDbId}/table','datatypes' => ['json','csv','xls','tsv']},{'datatypes' => ['json'],'methods' => ['GET'],'versions' => ['1.0','1.2'],'call' => 'studies/{studyDbId}/layout'},{'versions' => ['1.0','1.2'],'methods' => ['GET'],'call' => 'studies/{studyDbId}/observations','datatypes' => ['json']},{'versions' => ['1.0','1.2'],'methods' => ['GET','POST'],'call' => 'phenotypes-search','datatypes' => ['json']},{'datatypes' => ['json'],'call' => 'phenotypes-search/table','methods' => ['GET','POST'],'versions' => ['1.0','1.2']},{'datatypes' => ['json'],'versions' => ['1.0','1.2'],'methods' => ['GET','POST'],'call' => 'phenotypes-search/tsv'},{'methods' => ['GET','POST'],'versions' => ['1.0','1.2'],'call' => 'phenotypes-search/csv','datatypes' => ['json']},{'call' => 'traits','versions' => ['1.0','1.2'],'methods' => ['GET'],'datatypes' => ['json']},{'datatypes' => ['json'],'methods' => ['GET'],'versions' => ['1.0','1.2'],'call' => 'traits/{traitDbId}'},{'datatypes' => ['json'],'call' => 'maps','methods' => ['GET'],'versions' => ['1.0','1.2']},{'versions' => ['1.0','1.2'],'methods' => ['GET'],'call' => 'maps/{mapDbId}','datatypes' => ['json']},{'datatypes' => ['json'],'methods' => ['GET'],'versions' => ['1.0','1.2'],'call' => 'maps/{mapDbId}/positions'},{'datatypes' => ['json'],'versions' => ['1.0','1.2'],'methods' => ['GET'],'call' => 'maps/{mapDbId}/positions/id'},{'methods' => ['GET'],'versions' => ['1.0','1.2'],'call' => 'locations','datatypes' => ['json']},{'versions' => ['1.0','1.2'],'methods' => ['GET'],'call' => 'variables/datatypes','datatypes' => ['json']},{'datatypes' => ['json'],'versions' => ['1.0','1.2'],'methods' => ['GET'],'call' => 'ontologies'},{'call' => 'variables','methods' => ['GET'],'versions' => ['1.0','1.2'],'datatypes' => ['json']},{'versions' => ['1.0','1.2'],'methods' => ['GET'],'call' => 'variables/{observationVariableDbId}','datatypes' => ['json']},{'datatypes' => ['json'],'call' => 'variables-search','versions' => ['1.0','1.2'],'methods' => ['GET','POST']},{'versions' => ['1.0','1.2'],'methods' => ['GET','POST'],'call' => 'samples-search','datatypes' => ['json']},{'datatypes' => ['json'],'call' => 'samples/{sampleDbId}','versions' => ['1.0','1.2'],'methods' => ['GET']}]}}, 'check calls response content');

$mech->get_ok('http://localhost:3010/brapi/v1/calls?pageSize=50&datatype=tsv');
$response = decode_json $mech->content;
print STDERR Dumper $response;

is_deeply($response, {'result' => {'data' => [{'datatypes' => ['json','tsv','csv','xls'],'call' => 'allelematrix-search','versions' => ['1.0','1.2'],'methods' => ['GET','POST']},{'versions' => ['1.0','1.2'],'methods' => ['GET','POST'],'call' => 'allelematrices-search','datatypes' => ['json','tsv','csv','xls']},{'call' => 'studies/{studyDbId}/table','versions' => ['1.0','1.2'],'methods' => ['GET'],'datatypes' => ['json','csv','xls','tsv']}]},'metadata' => {'status' => [{'code' => 'info','message' => 'BrAPI base call found with page=0, pageSize=50'},{'code' => 'info','message' => 'Loading CXGN::BrAPI::v1::Calls'},{'message' => 'Calls result constructed','code' => '200'}],'datafiles' => [],'pagination' => {'totalPages' => 1,'pageSize' => 1000,'totalCount' => 3,'currentPage' => 0}}}, 'check calls response content');

$mech->post_ok('http://localhost:3010/brapi/v1/token', [ "username"=> "janedoe", "password"=> "secretpw", "grant_type"=> "password" ]);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is($response->{'metadata'}->{'status'}->[2]->{'message'}, 'Login Successfull');
is($response->{'userDisplayName'}, 'Jane Doe');
is($response->{'expires_in'}, '7200');

$mech->delete_ok('http://localhost:3010/brapi/v1/token');
$response = decode_json $mech->content;
print STDERR Dumper $response;
is($response->{'metadata'}->{'status'}->[2]->{'message'}, 'User Logged Out');

$mech->post_ok('http://localhost:3010/brapi/v1/token', [ "username"=> "janedoe", "password"=> "secretpw", "grant_type"=> "password" ]);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is($response->{'metadata'}->{'status'}->[2]->{'message'}, 'Login Successfull');
is($response->{'userDisplayName'}, 'Jane Doe');
is($response->{'expires_in'}, '7200');
my $access_token = $response->{access_token};

$mech->get_ok('http://localhost:3010/brapi/v1/observationlevels');
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'metadata' => {'status' => [{'code' => 'info','message' => 'BrAPI base call found with page=0, pageSize=10'},{'message' => 'Loading CXGN::BrAPI::v1::ObservationVariables','code' => 'info'},{'message' => 'Observation Levels result constructed','code' => '200'}],'datafiles' => [],'pagination' => {'totalPages' => 1,'pageSize' => 10,'totalCount' => 4,'currentPage' => 0}},'result' => {'data' => ['plant','plot','tissue_sample','all']}}, 'observationlevels');

$mech->get_ok('http://localhost:3010/brapi/v1/germplasm-search?pageSize=2&page=3&access_token='.$access_token);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'result' => {'data' => [{'countryOfOriginCode' => '','pedigree' => 'test_accession4/test_accession5','germplasmPUI' => '','subtaxa' => '','germplasmSeedSource' => '','germplasmName' => 'new_test_crossP002','typeOfGermplasmStorageCode' => [],'acquisitionDate' => '','species' => 'Solanum lycopersicum','defaultDisplayName' => 'new_test_crossP002','germplasmDbId' => 38847,'speciesAuthority' => '','synonyms' => [],'commonCropName' => 'tomato','donors' => [],'instituteCode' => '','genus' => 'Lycopersicon','taxonIds' => [],'instituteName' => '','subtaxaAuthority' => '','biologicalStatusOfAccessionCode' => '0','accessionNumber' => ''},{'typeOfGermplasmStorageCode' => [],'germplasmName' => 'new_test_crossP003','germplasmSeedSource' => '','subtaxa' => '','countryOfOriginCode' => '','germplasmPUI' => '','pedigree' => 'test_accession4/test_accession5','speciesAuthority' => '','defaultDisplayName' => 'new_test_crossP003','germplasmDbId' => 38848,'species' => 'Solanum lycopersicum','acquisitionDate' => '','donors' => [],'instituteCode' => '','synonyms' => [],'commonCropName' => 'tomato','accessionNumber' => '','biologicalStatusOfAccessionCode' => '0','subtaxaAuthority' => '','instituteName' => '','taxonIds' => [],'genus' => 'Lycopersicon'}]},'metadata' => {'datafiles' => [],'pagination' => {'totalPages' => 240,'pageSize' => 2,'totalCount' => 479,'currentPage' => 3},'status' => [{'code' => 'info','message' => 'BrAPI base call found with page=3, pageSize=2'},{'code' => 'info','message' => 'Loading CXGN::BrAPI::v1::Germplasm'},{'code' => '200','message' => 'Germplasm-search result constructed'}]}}, 'germplasm-search');

$mech->get_ok('http://localhost:3010/brapi/v1/germplasm-search?pageSize=2&page=5&access_token='.$access_token);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'result' => {'data' => [{'pedigree' => 'test_accession4/test_accession5','countryOfOriginCode' => '','germplasmPUI' => '','subtaxa' => '','germplasmSeedSource' => '','germplasmName' => 'new_test_crossP006','typeOfGermplasmStorageCode' => [],'acquisitionDate' => '','species' => 'Solanum lycopersicum','defaultDisplayName' => 'new_test_crossP006','germplasmDbId' => 38851,'speciesAuthority' => '','synonyms' => [],'commonCropName' => 'tomato','instituteCode' => '','donors' => [],'genus' => 'Lycopersicon','taxonIds' => [],'instituteName' => '','subtaxaAuthority' => '','biologicalStatusOfAccessionCode' => '0','accessionNumber' => ''},{'subtaxa' => '','countryOfOriginCode' => '','pedigree' => 'test_accession4/test_accession5','germplasmPUI' => '','typeOfGermplasmStorageCode' => [],'germplasmSeedSource' => '','germplasmName' => 'new_test_crossP007','species' => 'Solanum lycopersicum','germplasmDbId' => 38852,'defaultDisplayName' => 'new_test_crossP007','acquisitionDate' => '','speciesAuthority' => '','donors' => [],'instituteCode' => '','commonCropName' => 'tomato','synonyms' => [],'subtaxaAuthority' => '','genus' => 'Lycopersicon','taxonIds' => [],'instituteName' => '','accessionNumber' => '','biologicalStatusOfAccessionCode' => '0'}]},'metadata' => {'pagination' => {'currentPage' => 5,'totalCount' => 479,'pageSize' => 2,'totalPages' => 240},'datafiles' => [],'status' => [{'code' => 'info','message' => 'BrAPI base call found with page=5, pageSize=2'},{'code' => 'info','message' => 'Loading CXGN::BrAPI::v1::Germplasm'},{'code' => '200','message' => 'Germplasm-search result constructed'}]}}, 'germplasm-search');

$mech->get_ok('http://localhost:3010/brapi/v1/germplasm-search?pageSize=2&page=0&germplasmDbId=38849&access_token='.$access_token);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'result' => {'data' => [{'subtaxa' => '','germplasmPUI' => '','pedigree' => 'test_accession4/test_accession5','countryOfOriginCode' => '','typeOfGermplasmStorageCode' => [],'germplasmName' => 'new_test_crossP004','germplasmSeedSource' => '','germplasmDbId' => 38849,'defaultDisplayName' => 'new_test_crossP004','species' => 'Solanum lycopersicum','acquisitionDate' => '','speciesAuthority' => '','donors' => [],'instituteCode' => '','commonCropName' => 'tomato','synonyms' => [],'subtaxaAuthority' => '','instituteName' => '','taxonIds' => [],'genus' => 'Lycopersicon','accessionNumber' => '','biologicalStatusOfAccessionCode' => '0'}]},'metadata' => {'pagination' => {'totalPages' => 1,'pageSize' => 2,'currentPage' => 0,'totalCount' => 1},'datafiles' => [],'status' => [{'message' => 'BrAPI base call found with page=0, pageSize=2','code' => 'info'},{'code' => 'info','message' => 'Loading CXGN::BrAPI::v1::Germplasm'},{'code' => '200','message' => 'Germplasm-search result constructed'}]}}, 'germplasm-search');

$mech->get_ok('http://localhost:3010/brapi/v1/germplasm-search?pageSize=2&page=4&germplasmName=te%&matchMethod=wildcard&access_token='.$access_token);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'metadata' => {'datafiles' => [],'pagination' => {'currentPage' => 4,'totalCount' => 25,'pageSize' => 2,'totalPages' => 13},'status' => [{'message' => 'BrAPI base call found with page=4, pageSize=2','code' => 'info'},{'code' => 'info','message' => 'Loading CXGN::BrAPI::v1::Germplasm'},{'message' => 'Germplasm-search result constructed','code' => '200'}]},'result' => {'data' => [{'donors' => [],'instituteCode' => '','commonCropName' => 'tomato','synonyms' => [],'accessionNumber' => '','biologicalStatusOfAccessionCode' => '0','subtaxaAuthority' => '','genus' => 'Lycopersicon','taxonIds' => [],'instituteName' => '','typeOfGermplasmStorageCode' => [],'germplasmSeedSource' => '','germplasmName' => 'new_test_crossP009','subtaxa' => '','germplasmPUI' => '','countryOfOriginCode' => '','pedigree' => 'test_accession4/test_accession5','speciesAuthority' => '','species' => 'Solanum lycopersicum','germplasmDbId' => 38854,'defaultDisplayName' => 'new_test_crossP009','acquisitionDate' => ''},{'accessionNumber' => '','biologicalStatusOfAccessionCode' => '0','subtaxaAuthority' => '','genus' => 'Lycopersicon','taxonIds' => [],'instituteName' => '','instituteCode' => '','donors' => [],'commonCropName' => 'tomato','synonyms' => [],'speciesAuthority' => '','defaultDisplayName' => 'new_test_crossP010','germplasmDbId' => 38855,'species' => 'Solanum lycopersicum','acquisitionDate' => '','typeOfGermplasmStorageCode' => [],'germplasmSeedSource' => '','germplasmName' => 'new_test_crossP010','subtaxa' => '','pedigree' => 'test_accession4/test_accession5','germplasmPUI' => '','countryOfOriginCode' => ''}]}}, 'germplasm-search');

$mech->post_ok('http://localhost:3010/brapi/v1/germplasm-search?access_token='.$access_token, ['pageSize'=>'1', 'page'=>'5', 'germplasmNames'=>['t%'], 'matchMethod'=>'wildcard'] );
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'metadata' => {'status' => [{'message' => 'BrAPI base call found with page=5, pageSize=1','code' => 'info'},{'code' => 'info','message' => 'Loading CXGN::BrAPI::v1::Germplasm'},{'message' => 'Germplasm-search result constructed','code' => '200'}],'datafiles' => [],'pagination' => {'totalCount' => 31,'currentPage' => 5,'pageSize' => 1,'totalPages' => 31}},'result' => {'data' => [{'commonCropName' => 'tomato','synonyms' => [],'donors' => [],'instituteCode' => '','genus' => 'Lycopersicon','instituteName' => '','taxonIds' => [],'subtaxaAuthority' => '','biologicalStatusOfAccessionCode' => '0','accessionNumber' => '','countryOfOriginCode' => '','pedigree' => 'test_accession4/test_accession5','germplasmPUI' => '','subtaxa' => '','germplasmSeedSource' => '','germplasmName' => 'new_test_crossP002','typeOfGermplasmStorageCode' => [],'acquisitionDate' => '','species' => 'Solanum lycopersicum','defaultDisplayName' => 'new_test_crossP002','germplasmDbId' => 38847,'speciesAuthority' => ''}]}}, 'germplasm-search post');

$mech->get_ok('http://localhost:3010/brapi/v1/germplasm/38876?access_token='.$access_token);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'metadata' => {'datafiles' => [],'pagination' => {'totalPages' => 1,'pageSize' => 1,'totalCount' => 1,'currentPage' => 0},'status' => [{'message' => 'BrAPI base call found with page=0, pageSize=10','code' => 'info'},{'message' => 'Loading CXGN::BrAPI::v1::Germplasm','code' => 'info'},{'message' => 'Germplasm detail result constructed','code' => '200'}]},'result' => {'instituteCode' => '','donors' => [],'commonCropName' => 'tomato','synonyms' => [],'accessionNumber' => '','biologicalStatusOfAccessionCode' => '0','subtaxaAuthority' => '','instituteName' => '','taxonIds' => [],'genus' => 'Lycopersicon','typeOfGermplasmStorageCode' => [],'germplasmName' => 'test5P004','germplasmSeedSource' => '','subtaxa' => '','germplasmPUI' => '','countryOfOriginCode' => '','pedigree' => 'test_accession4/test_accession5','speciesAuthority' => '','defaultDisplayName' => 'test5P004','species' => 'Solanum lycopersicum','germplasmDbId' => 38876,'acquisitionDate' => ''}}, 'germplasm detail');

$mech->get_ok('http://localhost:3010/brapi/v1/germplasm/38876/pedigree?access_token='.$access_token);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'metadata' => {'datafiles' => [],'pagination' => {'pageSize' => 1,'totalPages' => 1,'currentPage' => 0,'totalCount' => 1},'status' => [{'code' => 'info','message' => 'BrAPI base call found with page=0, pageSize=10'},{'message' => 'Loading CXGN::BrAPI::v1::Germplasm','code' => 'info'},{'code' => '200','message' => 'Germplasm pedigree result constructed'}]},'result' => {'parent2DbId' => 38844,'pedigree' => 'test_accession4/test_accession5','parent2Type' => 'MALE','parent2Id' => 38844,'parent1DbId' => 38843,'parent2Name' => 'test_accession5','siblings' => [{'defaultDisplayName' => 'new_test_crossP001','germplasmDbId' => '38846'},{'germplasmDbId' => '38847','defaultDisplayName' => 'new_test_crossP002'},{'defaultDisplayName' => 'new_test_crossP003','germplasmDbId' => '38848'},{'defaultDisplayName' => 'new_test_crossP004','germplasmDbId' => '38849'},{'germplasmDbId' => '38850','defaultDisplayName' => 'new_test_crossP005'},{'defaultDisplayName' => 'new_test_crossP006','germplasmDbId' => '38851'},{'defaultDisplayName' => 'new_test_crossP007','germplasmDbId' => '38852'},{'germplasmDbId' => '38853','defaultDisplayName' => 'new_test_crossP008'},{'defaultDisplayName' => 'new_test_crossP009','germplasmDbId' => '38854'},{'germplasmDbId' => '38855','defaultDisplayName' => 'new_test_crossP010'},{'defaultDisplayName' => 'test5P001','germplasmDbId' => '38873'},{'defaultDisplayName' => 'test5P002','germplasmDbId' => '38874'},{'germplasmDbId' => '38875','defaultDisplayName' => 'test5P003'},{'germplasmDbId' => '38877','defaultDisplayName' => 'test5P005'}],'crossingYear' => '','crossingPlan' => '','germplasmDbId' => '38876','defaultDisplayName' => 'test5P004','parent1Name' => 'test_accession4','parent1Type' => 'FEMALE','parent1Id' => 38843,'familyCode' => ''}}, 'germplasm pedigree');

$mech->get_ok('http://localhost:3010/brapi/v1/germplasm/38843/progeny?access_token='.$access_token);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'result' => {'data' => [{'progenyGermplasmDbId' => 38846,'defaultDisplayName' => 'new_test_crossP001','germplasmDbId' => 38846,'parentType' => 'FEMALE'},{'defaultDisplayName' => 'new_test_crossP002','germplasmDbId' => 38847,'progenyGermplasmDbId' => 38847,'parentType' => 'FEMALE'},{'parentType' => 'FEMALE','progenyGermplasmDbId' => 38848,'defaultDisplayName' => 'new_test_crossP003','germplasmDbId' => 38848},{'progenyGermplasmDbId' => 38849,'defaultDisplayName' => 'new_test_crossP004','germplasmDbId' => 38849,'parentType' => 'FEMALE'},{'progenyGermplasmDbId' => 38850,'defaultDisplayName' => 'new_test_crossP005','germplasmDbId' => 38850,'parentType' => 'FEMALE'},{'progenyGermplasmDbId' => 38851,'defaultDisplayName' => 'new_test_crossP006','germplasmDbId' => 38851,'parentType' => 'FEMALE'},{'parentType' => 'FEMALE','defaultDisplayName' => 'new_test_crossP007','germplasmDbId' => 38852,'progenyGermplasmDbId' => 38852},{'germplasmDbId' => 38853,'defaultDisplayName' => 'new_test_crossP008','progenyGermplasmDbId' => 38853,'parentType' => 'FEMALE'},{'parentType' => 'FEMALE','progenyGermplasmDbId' => 38854,'defaultDisplayName' => 'new_test_crossP009','germplasmDbId' => 38854},{'germplasmDbId' => 38855,'defaultDisplayName' => 'new_test_crossP010','progenyGermplasmDbId' => 38855,'parentType' => 'FEMALE'}],'progeny' => [{'parentType' => 'FEMALE','progenyGermplasmDbId' => 38846,'germplasmDbId' => 38846,'defaultDisplayName' => 'new_test_crossP001'},{'parentType' => 'FEMALE','germplasmDbId' => 38847,'defaultDisplayName' => 'new_test_crossP002','progenyGermplasmDbId' => 38847},{'progenyGermplasmDbId' => 38848,'defaultDisplayName' => 'new_test_crossP003','germplasmDbId' => 38848,'parentType' => 'FEMALE'},{'germplasmDbId' => 38849,'defaultDisplayName' => 'new_test_crossP004','progenyGermplasmDbId' => 38849,'parentType' => 'FEMALE'},{'parentType' => 'FEMALE','defaultDisplayName' => 'new_test_crossP005','germplasmDbId' => 38850,'progenyGermplasmDbId' => 38850},{'parentType' => 'FEMALE','progenyGermplasmDbId' => 38851,'germplasmDbId' => 38851,'defaultDisplayName' => 'new_test_crossP006'},{'progenyGermplasmDbId' => 38852,'germplasmDbId' => 38852,'defaultDisplayName' => 'new_test_crossP007','parentType' => 'FEMALE'},{'defaultDisplayName' => 'new_test_crossP008','germplasmDbId' => 38853,'progenyGermplasmDbId' => 38853,'parentType' => 'FEMALE'},{'germplasmDbId' => 38854,'defaultDisplayName' => 'new_test_crossP009','progenyGermplasmDbId' => 38854,'parentType' => 'FEMALE'},{'defaultDisplayName' => 'new_test_crossP010','germplasmDbId' => 38855,'progenyGermplasmDbId' => 38855,'parentType' => 'FEMALE'}],'defaultDisplayName' => 'test_accession4','germplasmDbId' => '38843'},'metadata' => {'status' => [{'message' => 'BrAPI base call found with page=0, pageSize=10','code' => 'info'},{'message' => 'Loading CXGN::BrAPI::v1::Germplasm','code' => 'info'},{'message' => 'Germplasm progeny result constructed','code' => '200'}],'pagination' => {'totalCount' => 15,'currentPage' => 0,'pageSize' => 10,'totalPages' => 2},'datafiles' => []}}, 'germplasm progeny');

$mech->get_ok('http://localhost:3010/brapi/v1/germplasm/38937/markerprofiles?access_token='.$access_token);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'result' => {'markerprofileDbIds' => [1622,1934],'germplasmDbId' => '38937'},'metadata' => {'status' => [{'code' => 'info','message' => 'BrAPI base call found with page=0, pageSize=10'},{'message' => 'Loading CXGN::BrAPI::v1::Germplasm','code' => 'info'},{'message' => 'Germplasm markerprofiles result constructed','code' => '200'}],'pagination' => {'totalCount' => 2,'currentPage' => 0,'pageSize' => 10,'totalPages' => 1},'datafiles' => []}}, 'germplasm markerprofile');

$mech->get_ok('http://localhost:3010/brapi/v1/markerprofiles?pageSize=2&page=3&access_token='.$access_token);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'metadata' => {'status' => [{'message' => 'BrAPI base call found with page=3, pageSize=2','code' => 'info'},{'code' => 'info','message' => 'Loading CXGN::BrAPI::v1::Markerprofiles'},{'code' => '200','message' => 'Markerprofiles-search result constructed'}],'datafiles' => [],'pagination' => {'totalCount' => 535,'pageSize' => 2,'currentPage' => 3,'totalPages' => 268}},'result' => {'data' => [{'resultCount' => 500,'analysisMethod' => 'GBS ApeKI genotyping v4','extractDbId' => '38881','sampleDbId' => '38881','markerprofileDbId' => '1626','uniqueDisplayName' => 'UG120004|78264','germplasmDbId' => '38881'},{'extractDbId' => '38881','sampleDbId' => '38881','analysisMethod' => 'GBS ApeKI genotyping v4','resultCount' => 500,'markerprofileDbId' => '1930','uniqueDisplayName' => 'UG120004|79798','germplasmDbId' => '38881'}]}}, 'markerprofile');

$mech->get_ok('http://localhost:3010/brapi/v1/markerprofiles?pageSize=1&page=1&germplasmDbId=38937&access_token='.$access_token);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'result' => {'data' => [{'resultCount' => 500,'markerprofileDbId' => '1934','extractDbId' => 38937,'analysisMethod' => 'GBS ApeKI genotyping v4','germplasmDbId' => '38937','sampleDbId' => 38937,'uniqueDisplayName' => 'UG120066|79802'}]},'metadata' => {'pagination' => {'currentPage' => 1,'totalCount' => 2,'pageSize' => 1,'totalPages' => 2},'datafiles' => [],'status' => [{'message' => 'BrAPI base call found with page=1, pageSize=1','code' => 'info'},{'message' => 'Loading CXGN::BrAPI::v1::Markerprofiles','code' => 'info'},{'message' => 'Markerprofiles-search result constructed','code' => '200'}]}}, 'markerprofile');

$mech->get_ok('http://localhost:3010/brapi/v1/markerprofiles?pageSize=2&page=3&methodDbId=1&access_token='.$access_token);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'result' => {'data' => [{'uniqueDisplayName' => 'UG120004|78264','germplasmDbId' => '38881','extractDbId' => '38881','sampleDbId' => '38881','analysisMethod' => 'GBS ApeKI genotyping v4','resultCount' => 500,'markerprofileDbId' => '1626'},{'uniqueDisplayName' => 'UG120004|79798','germplasmDbId' => '38881','extractDbId' => '38881','sampleDbId' => '38881','analysisMethod' => 'GBS ApeKI genotyping v4','resultCount' => 500,'markerprofileDbId' => '1930'}]},'metadata' => {'status' => [{'code' => 'info','message' => 'BrAPI base call found with page=3, pageSize=2'},{'message' => 'Loading CXGN::BrAPI::v1::Markerprofiles','code' => 'info'},{'code' => '200','message' => 'Markerprofiles-search result constructed'}],'datafiles' => [],'pagination' => {'totalPages' => 268,'currentPage' => 3,'pageSize' => 2,'totalCount' => 535}}}, 'markerprofile');

$mech->get_ok('http://localhost:3010/brapi/v1/markerprofiles/1627?access_token='.$access_token);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'result' => {'data' => [{'S5_36739' => 'BB'},{'S13_92567' => 'BB'},{'S69_57277' => 'BB'},{'S80_224901' => 'AA'},{'S80_232173' => 'BB'},{'S80_265728' => 'AA'},{'S97_219243' => 'AB'},{'S224_309814' => 'BB'},{'S248_174244' => 'BB'},{'S318_245078' => 'AA'},{'S325_476494' => 'AA'},{'S341_311907' => 'BB'},{'S341_745165' => 'BB'},{'S341_927602' => 'BB'},{'S435_153155' => 'AA'},{'S620_130205' => 'BB'},{'S784_76866' => 'BB'},{'S821_289681' => 'AB'},{'S823_109683' => 'AA'},{'S823_119622' => 'BB'},{'S832_39811' => 'AA'},{'S847_188168' => 'BB'},{'S847_1315798' => 'AB'},{'S847_1804912' => 'AA'},{'S847_2403992' => 'BB'},{'S935_45975' => 'AB'},{'S940_150103' => 'AA'},{'S952_150314' => 'BB'},{'S999_310366' => 'AA'},{'S1027_465354' => 'BB'},{'S1046_216535' => 'BB'},{'S1127_16826' => 'BB'},{'S1441_60654' => 'AA'},{'S1551_652731' => 'BB'},{'S1551_712371' => 'BB'},{'S1551_1108196' => 'BB'},{'S1551_1252422' => 'AA'},{'S1551_1483219' => 'AA'},{'S1551_1622871' => 'BB'},{'S1551_1838719' => 'BB'},{'S1551_2906760' => 'AA'},{'S1551_2925283' => 'AA'},{'S1551_3200002' => 'BB'},{'S1551_3239448' => 'BB'},{'S1551_3366575' => 'AA'},{'S1551_3722622' => 'BB'},{'S1624_164812' => 'BB'},{'S1701_727586' => 'BB'},{'S1828_8899' => 'AA'},{'S1842_18522' => 'AA'},{'S1934_97870' => 'BB'},{'S1945_591357' => 'BB'},{'S1945_666842' => 'AA'},{'S2080_103510' => 'BB'},{'S2080_165181' => 'AA'},{'S2264_241725' => 'AA'},{'S2295_15627' => 'BB'},{'S2421_322288' => 'BB'},{'S2421_401501' => 'BB'},{'S2421_1140337' => 'AB'},{'S2431_166818' => 'BB'},{'S2431_391893' => 'AA'},{'S2436_67341' => 'BB'},{'S2477_162755' => 'AA'},{'S2477_323725' => 'AA'},{'S2477_406510' => 'AA'},{'S2538_42936' => 'AA'},{'S2538_411592' => 'AA'},{'S2572_310038' => 'AA'},{'S2572_338710' => 'BB'},{'S2658_486557' => 'BB'},{'S2658_601679' => 'BB'},{'S2658_679751' => 'BB'},{'S2688_335617' => 'BB'},{'S2817_91598' => 'AA'},{'S2817_245804' => 'BB'},{'S2853_503599' => 'AB'},{'S2892_478987' => 'AB'},{'S2895_111794' => 'BB'},{'S2912_229140' => 'BB'},{'S2915_246230' => 'BB'},{'S2915_247882' => 'AA'},{'S2915_338070' => 'BB'},{'S2932_69572' => 'BB'},{'S2936_101466' => 'AB'},{'S2943_243361' => 'AA'},{'S2943_739571' => 'BB'},{'S2959_122486' => 'AA'},{'S2960_262567' => 'AA'},{'S2960_406907' => 'BB'},{'S2960_544575' => 'BB'},{'S2960_642939' => 'BB'},{'S2975_103241' => 'AA'},{'S3000_214855' => 'BB'},{'S3000_300696' => 'AA'},{'S3049_211198' => 'BB'},{'S3049_609125' => 'AA'},{'S3049_747203' => 'BB'},{'S3049_987925' => 'BB'},{'S3115_41451' => 'BB'},{'S3115_135611' => 'BB'},{'S3115_156392' => 'AB'},{'S3115_240349' => 'BB'},{'S3130_128901' => 'AA'},{'S3150_262120' => 'AA'},{'S3150_319271' => 'BB'},{'S3150_505410' => 'BB'},{'S3186_44615' => 'AB'},{'S3235_140317' => 'BB'},{'S3237_271879' => 'BB'},{'S3241_181474' => 'BB'},{'S3241_314241' => 'AA'},{'S3241_355591' => 'AA'},{'S3245_85163' => 'BB'},{'S3264_99474' => 'BB'},{'S3264_149094' => 'BB'},{'S3264_464491' => 'AA'},{'S3264_734293' => 'AB'},{'S3264_774153' => 'AA'},{'S3329_32933' => 'AA'},{'S3332_613796' => 'AA'},{'S3332_808673' => 'AB'},{'S3332_1040319' => 'AA'},{'S3333_300006' => 'AA'},{'S3333_321757' => 'BB'},{'S3378_380126' => 'AA'},{'S3402_49570' => 'BB'},{'S3484_40231' => 'AA'},{'S3542_507815' => 'AA'},{'S3581_377460' => 'BB'},{'S3581_431736' => 'AB'},{'S3581_773436' => 'AB'},{'S3581_1333049' => 'AB'},{'S3581_1431971' => 'AB'},{'S3602_597743' => 'BB'},{'S3604_370570' => 'BB'},{'S3604_430194' => 'BB'},{'S3604_1044096' => 'BB'},{'S3614_10643' => 'BB'},{'S3614_529844' => 'AA'},{'S3614_868194' => 'BB'},{'S3614_1817341' => 'BB'},{'S3614_2789312' => 'AA'},{'S3614_3881800' => 'BB'},{'S3651_300950' => 'BB'},{'S3651_443200' => 'BB'},{'S3718_276118' => 'AA'},{'S3735_394293' => 'BB'},{'S3736_59970' => 'AA'},{'S3736_123338' => 'AA'},{'S3741_151581' => 'AA'},{'S3741_387303' => 'AA'},{'S3741_440684' => 'AA'},{'S3741_508439' => 'AA'},{'S3741_937767' => 'AA'},{'S3741_987743' => 'BB'},{'S3750_584997' => 'BB'},{'S3750_654240' => 'BB'},{'S3750_668529' => 'BB'},{'S3750_1088142' => 'AA'},{'S3750_1090019' => 'BB'},{'S3754_7252' => 'BB'},{'S3787_76554' => 'AA'},{'S3802_796806' => 'BB'},{'S3846_12968' => 'BB'},{'S3859_212947' => 'BB'},{'S3975_237757' => 'BB'},{'S3975_252778' => 'BB'},{'S4043_373081' => 'BB'},{'S4043_959955' => 'BB'},{'S4043_1147239' => 'BB'},{'S4043_1370276' => 'BB'},{'S4056_140993' => 'AB'},{'S4065_150573' => 'BB'},{'S4065_263245' => 'BB'},{'S4065_271143' => 'AA'},{'S4080_8045' => 'AA'},{'S4083_456173' => 'AA'},{'S4083_489335' => 'BB'},{'S4151_408968' => 'BB'},{'S4165_382338' => 'AA'},{'S4175_365840' => 'AB'},{'S4175_515602' => 'BB'},{'S4175_567563' => 'BB'},{'S4175_686615' => 'BB'},{'S4209_210894' => 'BB'},{'S4209_755236' => 'AA'},{'S4251_304804' => 'BB'},{'S4269_27179' => 'BB'},{'S4269_52542' => 'AB'},{'S4274_140837' => 'AA'},{'S4274_177473' => 'BB'},{'S4285_227555' => 'AB'},{'S4305_131355' => 'AA'},{'S4439_28513' => 'BB'},{'S4450_193257' => 'BB'},{'S4457_297856' => 'BB'},{'S4457_462709' => 'AA'},{'S4457_1097015' => 'BB'},{'S4457_1300393' => 'BB'},{'S4489_189071' => 'AA'},{'S4681_262496' => 'BB'},{'S4681_593453' => 'AA'},{'S4851_601229' => 'AA'},{'S4882_161352' => 'BB'},{'S4882_470222' => 'BB'},{'S5005_46565' => 'AA'},{'S5019_47183' => 'AB'},{'S5162_212284' => 'BB'},{'S5219_79565' => 'BB'},{'S5280_446764' => 'AA'},{'S5280_564518' => 'AA'},{'S5335_402068' => 'BB'},{'S5335_417949' => 'BB'},{'S5375_53450' => 'BB'},{'S5375_132818' => 'BB'},{'S5459_69682' => 'AA'},{'S5848_77293' => 'BB'},{'S5859_652772' => 'BB'},{'S5865_159403' => 'AA'},{'S5875_130394' => 'AA'},{'S5875_342195' => 'AA'},{'S5875_654914' => 'AA'},{'S5916_58666' => 'BB'},{'S5977_101347' => 'BB'},{'S5979_296753' => 'BB'},{'S6028_67175' => 'BB'},{'S6089_24864' => 'AB'},{'S6089_509226' => 'AA'},{'S6137_47666' => 'BB'},{'S6155_5121' => 'AA'},{'S6206_155413' => 'BB'},{'S6278_558480' => 'AA'},{'S6278_610459' => 'AA'},{'S6278_650925' => 'BB'},{'S6278_732960' => 'AA'},{'S6407_232902' => 'AA'},{'S6446_121660' => 'AA'},{'S6512_104772' => 'BB'},{'S6512_575155' => 'BB'},{'S6512_1743766' => 'AA'},{'S6512_2254100' => 'BB'},{'S6550_52292' => 'BB'},{'S6550_324831' => 'BB'},{'S6550_503577' => 'AB'},{'S6598_300948' => 'AB'},{'S6598_454335' => 'AA'},{'S6609_375938' => 'BB'},{'S6609_419187' => 'AA'},{'S6611_35506' => 'AA'},{'S6611_103757' => 'AA'},{'S6629_942' => 'AA'},{'S6631_66971' => 'BB'},{'S6656_80205' => 'BB'},{'S6656_133278' => 'BB'},{'S6656_309064' => 'BB'},{'S6656_803304' => 'BB'},{'S6701_438755' => 'BB'},{'S6705_400094' => 'BB'},{'S6707_77683' => 'AB'},{'S6707_146411' => 'BB'},{'S6761_25246' => 'AB'},{'S6775_95179' => 'BB'},{'S6814_93934' => 'BB'},{'S6814_392390' => 'AB'},{'S6814_646247' => 'BB'},{'S6816_60873' => 'AA'},{'S6825_286368' => 'AA'},{'S6825_291677' => 'AA'},{'S6825_348051' => 'BB'},{'S6850_23519' => 'AA'},{'S6853_107002' => 'AA'},{'S6877_11081' => 'BB'},{'S6908_174548' => 'BB'},{'S6908_232376' => 'BB'},{'S6908_237833' => 'AA'},{'S6914_477062' => 'BB'},{'S6914_917023' => 'BB'},{'S6914_1376609' => 'AB'},{'S6916_343692' => 'BB'},{'S6916_898371' => 'BB'},{'S6916_1130850' => 'AA'},{'S6916_1173117' => 'BB'},{'S6916_1522636' => 'BB'},{'S6980_52703' => 'AB'},{'S7012_411405' => 'AA'},{'S7012_666222' => 'AA'},{'S7012_1050824' => 'BB'},{'S7012_12891891' => 'BB'},{'S7035_17812' => 'AA'},{'S7035_107575' => 'BB'},{'S7035_336332' => 'AA'},{'S7041_105481' => 'BB'},{'S7069_330799' => 'AA'},{'S7069_339027' => 'BB'},{'S7088_73067' => 'AA'},{'S7107_65000' => 'AA'},{'S7292_69' => 'AB'},{'S7351_123029' => 'BB'},{'S7444_119272' => 'AA'},{'S7463_71588' => 'AA'},{'S7478_325486' => 'BB'},{'S7488_50987' => 'BB'},{'S7519_562902' => 'AA'},{'S7520_393434' => 'AA'},{'S7520_639628' => 'BB'},{'S7520_657920' => 'BB'},{'S7520_730357' => 'BB'},{'S7520_1438963' => 'AA'},{'S7520_1890285' => 'BB'},{'S7520_1896478' => 'BB'},{'S7520_2302096' => 'BB'},{'S7520_2326151' => 'BB'},{'S7520_2562868' => 'BB'},{'S7520_2804544' => 'BB'},{'S7543_258314' => 'BB'},{'S7571_117345' => 'BB'},{'S7571_291382' => 'AA'},{'S7571_626158' => 'BB'},{'S7571_657127' => 'BB'},{'S7591_141290' => 'BB'},{'S7660_98872' => 'BB'},{'S7762_171787' => 'AB'},{'S7762_244113' => 'BB'},{'S7861_4499' => 'AA'},{'S7991_19945' => 'BB'},{'S7996_258208' => 'BB'},{'S8003_188563' => 'BB'},{'S8004_147325' => 'BB'},{'S8122_306261' => 'BB'},{'S8151_113577' => 'BB'},{'S8167_142287' => 'AA'},{'S8245_22275' => 'AA'},{'S8265_125202' => 'AA'},{'S8265_252356' => 'BB'},{'S8265_382843' => 'BB'},{'S8265_404788' => 'AA'},{'S8265_1262361' => 'BB'},{'S8265_1563741' => 'AA'},{'S8265_1788254' => 'BB'},{'S8265_2172104' => 'BB'},{'S8265_2750819' => 'BB'},{'S8265_3146272' => 'BB'},{'S8265_3178182' => 'AB'},{'S8265_4827922' => 'AA'},{'S8265_6168752' => 'BB'},{'S8265_13857522' => 'AA'},{'S8265_22544562' => 'BB'},{'S8265_24005142' => 'BB'},{'S8265_28094061' => 'BB'},{'S8265_29680101' => 'AA'},{'S8265_32288641' => 'AA'},{'S8265_36795792' => 'BB'},{'S8265_42380592' => 'AB'},{'S8265_44371882' => 'BB'},{'S8314_33002' => 'AA'},{'S8316_61524' => 'AA'},{'S8316_64051' => 'AA'},{'S8316_828081' => 'BB'},{'S8359_287419' => 'AA'},{'S8359_781759' => 'AB'},{'S8359_1561375' => 'BB'},{'S8359_1689389' => 'BB'},{'S8359_1752715' => 'BB'},{'S8473_17888' => 'AA'},{'S8473_23707' => 'BB'},{'S8473_154142' => 'BB'},{'S8494_164649' => 'BB'},{'S8542_178809' => 'AB'},{'S8542_302774' => 'AB'},{'S8593_56062' => 'BB'},{'S8617_19507' => 'BB'},{'S8673_46833' => 'BB'},{'S8673_48171' => 'BB'},{'S8686_843269' => 'AA'},{'S8686_1074871' => 'AB'},{'S8686_5839121' => 'AA'},{'S8686_7615221' => 'BB'},{'S8686_7793511' => 'AA'},{'S8757_543709' => 'AB'},{'S8799_611047' => 'AA'},{'S8799_699207' => 'AA'},{'S8828_26701' => 'AA'},{'S8847_267195' => 'AB'},{'S8860_12876' => 'BB'},{'S8873_203398' => 'BB'},{'S8994_202519' => 'AA'},{'S9000_187825' => 'BB'},{'S9013_98478' => 'AB'},{'S9035_226' => 'BB'},{'S9120_441308' => 'AB'},{'S9120_466058' => 'AB'},{'S9231_115745' => 'AA'},{'S9260_85990' => 'BB'},{'S9324_41069' => 'BB'},{'S9360_88379' => 'BB'},{'S9365_148585' => 'BB'},{'S9410_23080' => 'BB'},{'S9414_6599' => 'AA'},{'S9460_85039' => 'BB'},{'S9460_91231' => 'BB'},{'S9492_223801' => 'BB'},{'S9501_521580' => 'AA'},{'S9692_230167' => 'BB'},{'S9702_205063' => 'BB'},{'S9761_459530' => 'AB'},{'S9788_66332' => 'AB'},{'S9788_453634' => 'AA'},{'S9876_584512' => 'AB'},{'S10114_185859' => 'AA'},{'S10173_777651' => 'BB'},{'S10173_899514' => 'BB'},{'S10241_146006' => 'AA'},{'S10367_21679' => 'BB'},{'S10493_191533' => 'BB'},{'S10493_282956' => 'AA'},{'S10493_529025' => 'BB'},{'S10551_41284' => 'BB'},{'S10551_44996' => 'AA'},{'S10551_96591' => 'BB'},{'S10563_6640' => 'AA'},{'S10563_110710' => 'BB'},{'S10563_458792' => 'AA'},{'S10563_535346' => 'AB'},{'S10563_996687' => 'AA'},{'S10689_537521' => 'BB'},{'S10689_585587' => 'AA'},{'S10780_25444' => 'AB'},{'S10797_134409' => 'AA'},{'S10797_244349' => 'AB'},{'S10963_781226' => 'AA'},{'S11106_78443' => 'AB'},{'S11179_10653' => 'AA'},{'S11179_231468' => 'BB'},{'S11267_108022' => 'BB'},{'S11279_135336' => 'BB'},{'S11297_160003' => 'AA'},{'S11297_430854' => 'AA'},{'S11297_587571' => 'AA'},{'S11297_591849' => 'AA'},{'S11341_175970' => 'BB'},{'S11341_582872' => 'AA'},{'S11378_324775' => 'AA'},{'S11388_132103' => 'BB'},{'S11495_150387' => 'BB'},{'S11495_272492' => 'BB'},{'S11495_580938' => 'AB'},{'S11581_567114' => 'AB'},{'S11581_902331' => 'AB'},{'S11584_97726' => 'BB'},{'S11661_221624' => 'AA'},{'S11661_255071' => 'BB'},{'S11689_120997' => 'BB'},{'S11689_232183' => 'BB'},{'S11689_416021' => 'AA'},{'S11821_196927' => 'BB'},{'S11874_29482' => 'AA'},{'S11897_254957' => 'AB'},{'S11998_475883' => 'BB'},{'S11998_632212' => 'BB'},{'S11998_795409' => 'AB'},{'S11998_912093' => 'BB'},{'S12004_39799' => 'AB'},{'S12004_43792' => 'AA'},{'S12004_315885' => 'BB'},{'S12004_526993' => 'AA'},{'S12091_54588' => 'BB'},{'S12211_104742' => 'AA'},{'S12211_157511' => 'BB'},{'S12262_123295' => 'AA'},{'S12262_166442' => 'BB'},{'S12262_295534' => 'BB'},{'S12279_48910' => 'BB'},{'S12414_138577' => 'BB'},{'S12439_186389' => 'BB'},{'S12455_245618' => 'AA'},{'S12455_488938' => 'AA'},{'S12455_550518' => 'AA'},{'S12498_209195' => 'BB'},{'S12525_579339' => 'BB'},{'S12525_581929' => 'BB'},{'S12525_872745' => 'BB'},{'S12529_29862' => 'BB'},{'S12542_14293' => 'BB'},{'S12686_58507' => 'BB'},{'S12728_11449' => 'AA'},{'S12753_445856' => 'AA'},{'S12759_185633' => 'BB'},{'S12794_742415' => 'BB'},{'S12794_1396029' => 'BB'},{'S12794_1408925' => 'AA'},{'S12794_1417026' => 'BB'},{'S12794_1615271' => 'AA'},{'S12794_1671144' => 'AB'},{'S12794_1740426' => 'BB'},{'S12794_1825180' => 'BB'},{'S12794_1954311' => 'BB'},{'S12794_2162836' => 'BB'},{'S12865_649906' => 'BB'},{'S12946_101555' => 'BB'}],'uniqueDisplayName' => 'UG120156|78265','markerprofileDbId' => '1627','sampleDbId' => '39007','germplasmDbId' => '39007','extractDbId' => '39007','analysisMethod' => 'GBS ApeKI genotyping v4'},'metadata' => {'status' => [{'code' => 'info','message' => 'BrAPI base call found with page=0, pageSize=10'},{'code' => 'info','message' => 'Loading CXGN::BrAPI::v1::Markerprofiles'},{'code' => '200','message' => 'Markerprofiles detail result constructed'}],'datafiles' => [],'pagination' => undef}}, 'markerprofile');

$mech->post_ok('http://localhost:3010/brapi/v1/allelematrices-search?access_token='.$access_token, ['markerprofileDbId'=>[1626,1627], 'format'=>'json'] );
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'result' => {'data' => [['S10114_185859','1626','BB'],['S10173_777651','1626','BB'],['S10173_899514','1626','BB'],['S10241_146006','1626','AA'],['S1027_465354','1626','AA'],['S10367_21679','1626','AA'],['S1046_216535','1626','AB'],['S10493_191533','1626','BB'],['S10493_282956','1626','AB'],['S10493_529025','1626','BB']]},'metadata' => {'datafiles' => [],'pagination' => {'pageSize' => 10,'currentPage' => 0,'totalCount' => 2000,'totalPages' => 200},'status' => [{'message' => 'BrAPI base call found with page=0, pageSize=10','code' => 'info'},{'message' => 'Loading CXGN::BrAPI::v1::Markerprofiles','code' => 'info'},{'message' => 'Markerprofiles allelematrix result constructed','code' => '200'}]}}, 'allelematrices-search');

$mech->get_ok('http://localhost:3010/brapi/v1/programs?access_token='.$access_token );
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'result' => {'data' => [{'objective' => 'test','programDbId' => '134','abbreviation' => '','name' => 'test','commonCropName' => 'Cassava','leadPerson' => ''}]},'metadata' => {'datafiles' => [],'pagination' => {'pageSize' => 10,'totalPages' => 1,'totalCount' => 1,'currentPage' => 0},'status' => [{'message' => 'BrAPI base call found with page=0, pageSize=10','code' => 'info'},{'code' => 'info','message' => 'Loading CXGN::BrAPI::v1::Programs'},{'message' => 'Program list result constructed','code' => '200'}]}}, 'programs');

$mech->get_ok('http://localhost:3010/brapi/v1/crops?access_token='.$access_token );
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'result' => {'data' => ['Cassava']},'metadata' => {'datafiles' => [],'pagination' => {'pageSize' => 10,'totalPages' => 1,'currentPage' => 0,'totalCount' => 1},'status' => [{'message' => 'BrAPI base call found with page=0, pageSize=10','code' => 'info'},{'code' => 'info','message' => 'Loading CXGN::BrAPI::v1::Crops'},{'message' => 'Crops result constructed','code' => '200'}]}}, 'crops');

$mech->get_ok('http://localhost:3010/brapi/v1/seasons?access_token='.$access_token );
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'result' => {'data' => [{'seasonDbId' => '2014','season' => '','year' => '2014'},{'season' => '','year' => '2015','seasonDbId' => '2015'},{'seasonDbId' => '2016','year' => '2016','season' => ''},{'seasonDbId' => '2017','year' => '2017','season' => ''}]},'metadata' => {'status' => [{'code' => 'info','message' => 'BrAPI base call found with page=0, pageSize=10'},{'message' => 'Loading CXGN::BrAPI::v1::Studies','code' => 'info'},{'code' => '200','message' => 'Seasons list result constructed'}],'datafiles' => [],'pagination' => {'totalPages' => 1,'currentPage' => 0,'pageSize' => 10,'totalCount' => 4}}}, 'seasons');

$mech->get_ok('http://localhost:3010/brapi/v1/studytypes?access_token='.$access_token );
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'metadata' => {'status' => [{'message' => 'BrAPI base call found with page=0, pageSize=10','code' => 'info'},{'code' => 'info','message' => 'Loading CXGN::BrAPI::v1::Studies'},{'code' => '200','message' => 'StudyTypes list result constructed'}],'pagination' => {'totalCount' => 18,'currentPage' => 0,'totalPages' => 2,'pageSize' => 10},'datafiles' => []},'result' => {'data' => [{'name' => 'Seedling Nursery','description' => 'seedling'},{'description' => 'phenotyping_trial','name' => 'phenotyping_trial'},{'name' => 'genotyping_trial','description' => 'genotyping_trial'},{'description' => '','name' => 'Advanced Yield Trial'},{'name' => 'Preliminary Yield Trial','description' => ''},{'name' => 'Uniform Yield Trial','description' => ''},{'name' => 'Variety Release Trial','description' => ''},{'name' => 'Clonal Evaluation','description' => ''},{'name' => 'genetic_gain_trial','description' => ''},{'name' => 'storage_trial','description' => ''}]}}, 'studyTypes');

$mech->get_ok('http://localhost:3010/brapi/v1/studytypes?pageSize=2&page=2&access_token='.$access_token);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'result' => {'data' => [{'description' => '','name' => 'Preliminary Yield Trial'},{'description' => '','name' => 'Uniform Yield Trial'}]},'metadata' => {'datafiles' => [],'pagination' => {'pageSize' => 2,'totalPages' => 9,'totalCount' => 18,'currentPage' => 2},'status' => [{'message' => 'BrAPI base call found with page=2, pageSize=2','code' => 'info'},{'message' => 'Loading CXGN::BrAPI::v1::Studies','code' => 'info'},{'message' => 'StudyTypes list result constructed','code' => '200'}]}}, 'studyTypes');

# $mech->get_ok('http://localhost:3010/brapi/v1/trials?pageSize=2&page=0&access_token='.$access_token);
# $response = decode_json $mech->content;
# print STDERR Dumper $response;
# is_deeply($response, {}, 'trials');

$mech->post_ok('http://localhost:3010/brapi/v1/studies-search?pageSize=2&page=2&access_token='.$access_token );
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {"result"=>{"data"=>[{"trialDbId"=>"","studyType"=>undef,"studyDbId"=>"137","programName"=>"test","commonCropName"=>"Cassava","studyTypeName"=>"","programDbId"=>"134","locationName"=>"test_location","startDate"=>"2017-July-21","endDate"=>"2017-July-04","studyTypeDbId"=>"","additionalInfo"=>{"description"=>"test trial","design"=>"CRD"},"active"=>JSON::true,"trialName"=>undef,"name"=>"test_trial","documentationURL"=>"","seasons"=>[{"seasonDbId"=>"","year"=>"2014","season"=>""}],"locationDbId"=>"23","studyName"=>"test_trial"},{"studyName"=>"trial2 NaCRRI","name"=>"trial2 NaCRRI","trialName"=>undef,"seasons"=>[{"season"=>"","year"=>"2014","seasonDbId"=>""}],"documentationURL"=>"","locationDbId"=>"23","programDbId"=>"134","locationName"=>"test_location","startDate"=>undef,"active"=>JSON::true,"endDate"=>undef,"studyTypeDbId"=>"","additionalInfo"=>{"description"=>"another trial for solGS","design"=>"CRD"},"studyDbId"=>"141","programName"=>"test","trialDbId"=>"","studyType"=>undef,"commonCropName"=>"Cassava","studyTypeName"=>""}]},"metadata"=>{"datafiles"=>[],"pagination"=>{"currentPage"=>2,"totalPages"=>3,"totalCount"=>6,"pageSize"=>2},"status"=>[{"code"=>"info","message"=>"BrAPI base call found with page=2, pageSize=2"},{"code"=>"info","message"=>"Loading CXGN::BrAPI::v1::Studies"},{"message"=>"Studies-search result constructed","code"=>"200"}]}}, 'studies-search');

$mech->post_ok('http://localhost:3010/brapi/v1/studies-search?pageSize=2&page=0&programDbIds=100&access_token='.$access_token );
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {"result"=>{"data"=>[]},"metadata"=>{"status"=>[{"message"=>"BrAPI base call found with page=0, pageSize=2","code"=>"info"},{"message"=>"Loading CXGN::BrAPI::v1::Studies","code"=>"info"},{"message"=>"Studies-search result constructed","code"=>"200"}],"pagination"=>{"totalCount"=>0,"pageSize"=>2,"totalPages"=>0,"currentPage"=>0},"datafiles"=>[]}}, 'studies-search with program');

$mech->post_ok('http://localhost:3010/brapi/v1/studies-search?pageSize=2&page=0&programDbIds=134&access_token='.$access_token );
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {"metadata"=>{"datafiles"=>[],"status"=>[{"code"=>"info","message"=>"BrAPI base call found with page=0, pageSize=2"},{"code"=>"info","message"=>"Loading CXGN::BrAPI::v1::Studies"},{"message"=>"Studies-search result constructed","code"=>"200"}],"pagination"=>{"currentPage"=>0,"pageSize"=>2,"totalCount"=>6,"totalPages"=>3}},"result"=>{"data"=>[{"studyTypeName"=>"","name"=>"CASS_6Genotypes_Sampling_2015","additionalInfo"=>{"design"=>"RCBD","description"=>"Copy of trial with postcomposed phenotypes from cassbase."},"commonCropName"=>"Cassava","documentationURL"=>"","active"=>JSON::true,"locationName"=>"test_location","trialName"=>undef,"startDate"=>undef,"seasons"=>[{"season"=>"","seasonDbId"=>"","year"=>"2017"}],"programName"=>"test","studyDbId"=>"165","studyName"=>"CASS_6Genotypes_Sampling_2015","studyTypeDbId"=>"","trialDbId"=>"","programDbId"=>"134","locationDbId"=>"23","endDate"=>undef,"studyType"=>"Preliminary Yield Trial"},{"studyType"=>"Clonal Evaluation","endDate"=>undef,"programDbId"=>"134","locationDbId"=>"23","studyName"=>"Kasese solgs trial","trialDbId"=>"","studyTypeDbId"=>"","programName"=>"test","seasons"=>[{"season"=>"","year"=>"2014","seasonDbId"=>""}],"studyDbId"=>"139","startDate"=>undef,"active"=>JSON::true,"locationName"=>"test_location","trialName"=>undef,"additionalInfo"=>{"design"=>"Alpha","description"=>"This trial was loaded into the fixture to test solgs."},"commonCropName"=>"Cassava","documentationURL"=>"","studyTypeName"=>"","name"=>"Kasese solgs trial"}]}}, 'studies-search with program');

$mech->post_ok('http://localhost:3010/brapi/v1/studies-search?pageSize=2&page=0&trialDbIds=167&access_token='.$access_token );
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {"metadata"=>{"datafiles"=>[],"status"=>[{"message"=>"BrAPI base call found with page=0, pageSize=2","code"=>"info"},{"message"=>"Loading CXGN::BrAPI::v1::Studies","code"=>"info"},{"code"=>"200","message"=>"Studies-search result constructed"}],"pagination"=>{"currentPage"=>0,"totalPages"=>0,"totalCount"=>0,"pageSize"=>2}},"result"=>{"data"=>[]}}, 'studies-search with trial');

$mech->post_ok('http://localhost:3010/brapi/v1/studies-search?pageSize=2&page=0&studyLocations=test_location&access_token='.$access_token );
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {"metadata"=>{"datafiles"=>[],"status"=>[{"code"=>"info","message"=>"BrAPI base call found with page=0, pageSize=2"},{"message"=>"Loading CXGN::BrAPI::v1::Studies","code"=>"info"},{"code"=>"200","message"=>"Studies-search result constructed"}],"pagination"=>{"totalPages"=>3,"totalCount"=>6,"currentPage"=>0,"pageSize"=>2}},"result"=>{"data"=>[{"studyName"=>"CASS_6Genotypes_Sampling_2015","documentationURL"=>"","seasons"=>[{"season"=>"","year"=>"2017","seasonDbId"=>""}],"locationDbId"=>"23","name"=>"CASS_6Genotypes_Sampling_2015","trialName"=>undef,"studyTypeDbId"=>"","additionalInfo"=>{"description"=>"Copy of trial with postcomposed phenotypes from cassbase.","design"=>"RCBD"},"endDate"=>undef,"active"=>JSON::true,"programDbId"=>"134","startDate"=>undef,"locationName"=>"test_location","commonCropName"=>"Cassava","studyTypeName"=>"","studyType"=>"Preliminary Yield Trial","trialDbId"=>"","programName"=>"test","studyDbId"=>"165"},{"name"=>"Kasese solgs trial","trialName"=>undef,"seasons"=>[{"seasonDbId"=>"","season"=>"","year"=>"2014"}],"documentationURL"=>"","locationDbId"=>"23","studyName"=>"Kasese solgs trial","programName"=>"test","studyDbId"=>"139","trialDbId"=>"","studyType"=>"Clonal Evaluation","studyTypeName"=>"","commonCropName"=>"Cassava","programDbId"=>"134","startDate"=>undef,"locationName"=>"test_location","active"=>JSON::true,"studyTypeDbId"=>"","endDate"=>undef,"additionalInfo"=>{"design"=>"Alpha","description"=>"This trial was loaded into the fixture to test solgs."}}]}}, 'studies-search');

$mech->post_ok('http://localhost:3010/brapi/v1/studies-search?pageSize=2&page=0&locationName=test_location&studyType=Clonal%20Evaluation&access_token='.$access_token );
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {"result"=>{"data"=>[{"documentationURL"=>"","seasons"=>[{"year"=>"2014","season"=>"","seasonDbId"=>""}],"locationDbId"=>"23","trialName"=>undef,"name"=>"Kasese solgs trial","studyName"=>"Kasese solgs trial","studyTypeName"=>"","commonCropName"=>"Cassava","trialDbId"=>"","studyType"=>"Clonal Evaluation","programName"=>"test","studyDbId"=>"139","studyTypeDbId"=>"","endDate"=>undef,"additionalInfo"=>{"design"=>"Alpha","description"=>"This trial was loaded into the fixture to test solgs."},"active"=>JSON::true,"programDbId"=>"134","startDate"=>undef,"locationName"=>"test_location"}]},"metadata"=>{"pagination"=>{"currentPage"=>0,"totalPages"=>1,"totalCount"=>1,"pageSize"=>2},"status"=>[{"code"=>"info","message"=>"BrAPI base call found with page=0, pageSize=2"},{"message"=>"Loading CXGN::BrAPI::v1::Studies","code"=>"info"},{"message"=>"Studies-search result constructed","code"=>"200"}],"datafiles"=>[]}}, 'studies-search');

$mech->post_ok('http://localhost:3010/brapi/v1/studies-search?pageSize=2&page=0&programName=test&access_token='.$access_token );
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {"metadata"=>{"pagination"=>{"currentPage"=>0,"totalCount"=>6,"totalPages"=>3,"pageSize"=>2},"status"=>[{"code"=>"info","message"=>"BrAPI base call found with page=0, pageSize=2"},{"message"=>"Loading CXGN::BrAPI::v1::Studies","code"=>"info"},{"code"=>"200","message"=>"Studies-search result constructed"}],"datafiles"=>[]},"result"=>{"data"=>[{"seasons"=>[{"year"=>"2017","season"=>"","seasonDbId"=>""}],"documentationURL"=>"","locationDbId"=>"23","trialName"=>undef,"name"=>"CASS_6Genotypes_Sampling_2015","studyName"=>"CASS_6Genotypes_Sampling_2015","commonCropName"=>"Cassava","studyTypeName"=>"","studyDbId"=>"165","programName"=>"test","studyType"=>"Preliminary Yield Trial","trialDbId"=>"","active"=>JSON::true,"studyTypeDbId"=>"","endDate"=>undef,"additionalInfo"=>{"description"=>"Copy of trial with postcomposed phenotypes from cassbase.","design"=>"RCBD"},"programDbId"=>"134","startDate"=>undef,"locationName"=>"test_location"},{"commonCropName"=>"Cassava","studyTypeName"=>"","studyDbId"=>"139","programName"=>"test","trialDbId"=>"","studyType"=>"Clonal Evaluation","active"=>JSON::true,"studyTypeDbId"=>"","endDate"=>undef,"additionalInfo"=>{"description"=>"This trial was loaded into the fixture to test solgs.","design"=>"Alpha"},"programDbId"=>"134","startDate"=>undef,"locationName"=>"test_location","seasons"=>[{"seasonDbId"=>"","season"=>"","year"=>"2014"}],"documentationURL"=>"","locationDbId"=>"23","trialName"=>undef,"name"=>"Kasese solgs trial","studyName"=>"Kasese solgs trial"}]}}, 'studies-search');

$mech->post_ok('http://localhost:3010/brapi/v1/studies-search?pageSize=2&page=0&germplasmNames=TMEB693&access_token='.$access_token );
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {"result"=>{"data"=>[{"studyTypeDbId"=>"","trialDbId"=>"","studyName"=>"CASS_6Genotypes_Sampling_2015","studyDbId"=>"165","programName"=>"test","seasons"=>[{"season"=>"","seasonDbId"=>"","year"=>"2017"}],"endDate"=>undef,"studyType"=>"Preliminary Yield Trial","locationDbId"=>"23","programDbId"=>"134","documentationURL"=>"","commonCropName"=>"Cassava","additionalInfo"=>{"description"=>"Copy of trial with postcomposed phenotypes from cassbase.","design"=>"RCBD"},"name"=>"CASS_6Genotypes_Sampling_2015","studyTypeName"=>"","startDate"=>undef,"trialName"=>undef,"locationName"=>"test_location","active"=>JSON::true}]},"metadata"=>{"datafiles"=>[],"pagination"=>{"currentPage"=>0,"pageSize"=>2,"totalCount"=>1,"totalPages"=>1},"status"=>[{"code"=>"info","message"=>"BrAPI base call found with page=0, pageSize=2"},{"message"=>"Loading CXGN::BrAPI::v1::Studies","code"=>"info"},{"code"=>"200","message"=>"Studies-search result constructed"}]}}, 'studies-search with germplasm name');

$mech->post_ok('http://localhost:3010/brapi/v1/studies-search?pageSize=2&page=0&observationVariableDbIds=77549&access_token='.$access_token );
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {"result"=>{"data"=>[{"name"=>"CASS_6Genotypes_Sampling_2015","studyTypeName"=>"","documentationURL"=>"","commonCropName"=>"Cassava","additionalInfo"=>{"design"=>"RCBD","description"=>"Copy of trial with postcomposed phenotypes from cassbase."},"trialName"=>undef,"locationName"=>"test_location","active"=>JSON::true,"startDate"=>undef,"studyDbId"=>"165","seasons"=>[{"season"=>"","year"=>"2017","seasonDbId"=>""}],"programName"=>"test","trialDbId"=>"","studyTypeDbId"=>"","studyName"=>"CASS_6Genotypes_Sampling_2015","locationDbId"=>"23","programDbId"=>"134","endDate"=>undef,"studyType"=>"Preliminary Yield Trial"}]},"metadata"=>{"datafiles"=>[],"pagination"=>{"currentPage"=>0,"pageSize"=>2,"totalCount"=>1,"totalPages"=>1},"status"=>[{"code"=>"info","message"=>"BrAPI base call found with page=0, pageSize=2"},{"message"=>"Loading CXGN::BrAPI::v1::Studies","code"=>"info"},{"code"=>"200","message"=>"Studies-search result constructed"}]}}, 'studies-search with trait');

$mech->get_ok('http://localhost:3010/brapi/v1/studies/139?access_token='.$access_token);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {"result"=>{"studyTypeDbId"=>"","additionalInfo"=>{},"endDate"=>undef,"active"=>JSON::true,"license"=>"","startDate"=>undef,"programDbId"=>"134","contacts"=>undef,"studyTypeName"=>"","commonCropName"=>"Cassava","location"=>{"name"=>"test_location","instituteAddress"=>"","locationDbId"=>"23","documentationURL"=>"","instituteName"=>"","locationName"=>"test_location","latitude"=>32.6136,"abbreviation"=>"","countryName"=>"United States","locationType"=>"","altitude"=>109,"countryCode"=>"USA","additionalInfo"=>{"geodetic datum"=>undef,"breeding_program"=>"134"},"longitude"=>-115.864},"dataLinks"=>[],"trialDbId"=>"134","studyType"=>"Clonal Evaluation","programName"=>"test","studyDbId"=>"139","studyDescription"=>"This trial was loaded into the fixture to test solgs.","studyName"=>"Kasese solgs trial","documentationURL"=>"","seasons"=>["2014"],"lastUpdate"=>{"version"=>"","timestamp"=>undef},"trialName"=>"test"},"metadata"=>{"status"=>[{"message"=>"BrAPI base call found with page=0, pageSize=10","code"=>"info"},{"code"=>"info","message"=>"Loading CXGN::BrAPI::v1::Studies"},{"message"=>"Studies detail result constructed","code"=>"200"}],"pagination"=>{"pageSize"=>10,"currentPage"=>0,"totalCount"=>1,"totalPages"=>1},"datafiles"=>[]}}, 'study details');

$mech->get_ok('http://localhost:3010/brapi/v1/studies/139/germplasm?access_token='.$access_token);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'result' => {'studyName' => 'Kasese solgs trial','data' => [{'accessionNumber' => '','germplasmDbId' => '38878','seedSource' => '','entryNumber' => '','germplasmName' => 'UG120001','synonyms' => [],'pedigree' => '','germplasmPUI' => ''},{'germplasmDbId' => '38879','accessionNumber' => '','pedigree' => '','germplasmPUI' => '','seedSource' => '','entryNumber' => '','germplasmName' => 'UG120002','synonyms' => []},{'accessionNumber' => '','germplasmDbId' => '38880','entryNumber' => '','seedSource' => '','synonyms' => [],'germplasmName' => 'UG120003','pedigree' => '','germplasmPUI' => ''},{'germplasmDbId' => '38881','accessionNumber' => '','germplasmPUI' => '','pedigree' => '','synonyms' => [],'germplasmName' => 'UG120004','entryNumber' => '','seedSource' => ''},{'germplasmDbId' => '38882','accessionNumber' => '','germplasmPUI' => '','pedigree' => '','germplasmName' => 'UG120005','synonyms' => [],'entryNumber' => '','seedSource' => ''},{'synonyms' => [],'germplasmName' => 'UG120006','seedSource' => '','entryNumber' => '','germplasmPUI' => '','pedigree' => '','accessionNumber' => '','germplasmDbId' => '38883'},{'pedigree' => '','germplasmPUI' => '','germplasmName' => 'UG120007','synonyms' => [],'seedSource' => '','entryNumber' => '','germplasmDbId' => '38884','accessionNumber' => ''},{'accessionNumber' => '','germplasmDbId' => '38885','entryNumber' => '','seedSource' => '','synonyms' => [],'germplasmName' => 'UG120008','germplasmPUI' => '','pedigree' => ''},{'accessionNumber' => '','germplasmDbId' => '38886','entryNumber' => '','seedSource' => '','synonyms' => [],'germplasmName' => 'UG120009','pedigree' => '','germplasmPUI' => ''},{'seedSource' => '','entryNumber' => '','germplasmName' => 'UG120010','synonyms' => [],'germplasmPUI' => '','pedigree' => '','accessionNumber' => '','germplasmDbId' => '38887'}],'studyDbId' => '139'},'metadata' => {'pagination' => {'totalPages' => 38,'pageSize' => 10,'totalCount' => 374,'currentPage' => 0},'datafiles' => [],'status' => [{'code' => 'info','message' => 'BrAPI base call found with page=0, pageSize=10'},{'message' => 'Loading CXGN::BrAPI::v1::Studies','code' => 'info'},{'code' => '200','message' => 'Studies-germplasm result constructed'}]}}, 'study germplasm');

$mech->get_ok('http://localhost:3010/brapi/v1/studies/165/observationvariables?pageSize=2&page=1&access_token='.$access_token);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {"result"=>{"data"=>[{"status"=>JSON::true,"language"=>"EN","ontologyReference"=>{"version"=>"","documentationURL"=>{"URL"=>"","type"=>""},"ontologyDbId"=>"305","ontologyName"=>"COMP"},"defaultValue"=>"","growthStage"=>"","trait"=>{"ontologyReference"=>{"version"=>"","documentationURL"=>{"URL"=>"","type"=>""},"ontologyDbId"=>"305","ontologyName"=>"COMP"},"xref"=>"COMP:0000010","mainAbbreviation"=>"","class"=>"","synonyms"=>[],"description"=>undef,"entity"=>"","traitName"=>"cass sink leaf|ADP|ug/g|week 16","alternativeAbbreviations"=>[],"status"=>JSON::true,"name"=>"cass sink leaf|ADP|ug/g|week 16","traitDbId"=>"77556"},"ontologyName"=>"COMP","observationVariableName"=>"cass sink leaf|ADP|ug/g|week 16","documentationURL"=>"","observationVariableDbId"=>"cass sink leaf|ADP|ug/g|week 16|COMP:0000010","institution"=>"","scientist"=>"","ontologyDbId"=>"305","crop"=>"Cassava","name"=>"cass sink leaf|ADP|ug/g|week 16","contextOfUse"=>[],"scale"=>{"scaleName"=>"","name"=>"","dataType"=>"","xref"=>"","ontologyReference"=>{"version"=>"","documentationURL"=>{"URL"=>"","type"=>""},"ontologyDbId"=>"305","ontologyName"=>"COMP"},"validValues"=>{"max"=>0,"categories"=>[],"min"=>0},"decimalPlaces"=>undef,"scaleDbId"=>""},"xref"=>"COMP:0000010","submissionTimeStamp"=>undef,"method"=>{"name"=>"","reference"=>"","methodName"=>"","formula"=>"","methodDbId"=>"","description"=>"","class"=>"","ontologyReference"=>{"version"=>"","documentationURL"=>{"URL"=>"","type"=>""},"ontologyDbId"=>"305","ontologyName"=>"COMP"}},"synonyms"=>[]},{"observationVariableName"=>"cass source leaf|3-phosphoglyceric acid|ug/g|week 16","ontologyName"=>"COMP","trait"=>{"traitName"=>"cass source leaf|3-phosphoglyceric acid|ug/g|week 16","alternativeAbbreviations"=>[],"traitDbId"=>"77548","name"=>"cass source leaf|3-phosphoglyceric acid|ug/g|week 16","status"=>JSON::true,"xref"=>"COMP:0000002","ontologyReference"=>{"ontologyDbId"=>"305","ontologyName"=>"COMP","version"=>"","documentationURL"=>{"type"=>"","URL"=>""}},"mainAbbreviation"=>"","description"=>undef,"synonyms"=>[],"class"=>"","entity"=>""},"growthStage"=>"","defaultValue"=>"","ontologyReference"=>{"ontologyDbId"=>"305","ontologyName"=>"COMP","version"=>"","documentationURL"=>{"type"=>"","URL"=>""}},"language"=>"EN","status"=>JSON::true,"synonyms"=>[],"scale"=>{"scaleDbId"=>"","xref"=>"","ontologyReference"=>{"ontologyDbId"=>"305","ontologyName"=>"COMP","version"=>"","documentationURL"=>{"type"=>"","URL"=>""}},"validValues"=>{"max"=>0,"categories"=>[],"min"=>0},"decimalPlaces"=>undef,"name"=>"","dataType"=>"","scaleName"=>""},"xref"=>"COMP:0000002","submissionTimeStamp"=>undef,"method"=>{"ontologyReference"=>{"ontologyDbId"=>"305","ontologyName"=>"COMP","version"=>"","documentationURL"=>{"type"=>"","URL"=>""}},"class"=>"","methodDbId"=>"","description"=>"","formula"=>"","methodName"=>"","reference"=>"","name"=>""},"contextOfUse"=>[],"name"=>"cass source leaf|3-phosphoglyceric acid|ug/g|week 16","crop"=>"Cassava","ontologyDbId"=>"305","scientist"=>"","institution"=>"","observationVariableDbId"=>"cass source leaf|3-phosphoglyceric acid|ug/g|week 16|COMP:0000002","documentationURL"=>""}],"studyName"=>"CASS_6Genotypes_Sampling_2015","studyDbId"=>"165"},"metadata"=>{"status"=>[{"message"=>"BrAPI base call found with page=1, pageSize=2","code"=>"info"},{"code"=>"info","message"=>"Loading CXGN::BrAPI::v1::Studies"},{"message"=>"Studies observation variables result constructed","code"=>"200"}],"pagination"=>{"pageSize"=>2,"currentPage"=>1,"totalPages"=>6,"totalCount"=>12},"datafiles"=>[]}}, 'study variables');

$mech->get_ok('http://localhost:3010/brapi/v1/studies/165/observationunits?pageSize=1&page=1&access_token='.$access_token);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {"result"=>{"data"=>[{"plantNumber"=>undef,"observationUnitName"=>"CASS_6Genotypes_104","plotNumber"=>"104","observationUnitDbId"=>"41295","programName"=>"test","studyDbId"=>"165","studyLocationDbId"=>"23","entryNumber"=>"","Y"=>undef,"entryType"=>"test","pedigree"=>"NA/NA","germplasmDbId"=>"41282","studyLocation"=>"test_location","X"=>undef,"studyName"=>"CASS_6Genotypes_Sampling_2015","observationLevel"=>"plot","treatments"=>[{"factor"=>"No ManagementFactor","modality"=>undef}],"germplasmName"=>"IITA-TMS-IBA980002","replicate"=>undef,"observationUnitXref"=>[],"observations"=>[{"observationVariableDbId"=>"77559","observationDbId"=>"740348","observationTimestamp"=>undef,"collector"=>"johndoe","season"=>{"season"=>"","year"=>"2017","seasonDbId"=>""},"value"=>"221.6135","observationVariableName"=>"cass sink leaf|3-phosphoglyceric acid|ug/g|week 16|COMP:0000013"},{"observationDbId"=>"740349","observationVariableDbId"=>"77557","observationTimestamp"=>undef,"collector"=>"johndoe","season"=>{"seasonDbId"=>"","year"=>"2017","season"=>""},"observationVariableName"=>"cass sink leaf|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000011","value"=>"36.12425"},{"observationVariableDbId"=>"77556","observationDbId"=>"740350","observationTimestamp"=>undef,"collector"=>"johndoe","season"=>{"season"=>"","year"=>"2017","seasonDbId"=>""},"observationVariableName"=>"cass sink leaf|ADP|ug/g|week 16|COMP:0000010","value"=>"316.489"},{"value"=>"908.9045","observationVariableName"=>"cass source leaf|3-phosphoglyceric acid|ug/g|week 16|COMP:0000002","season"=>{"season"=>"","year"=>"2017","seasonDbId"=>""},"observationTimestamp"=>undef,"collector"=>"johndoe","observationVariableDbId"=>"77548","observationDbId"=>"740351"},{"observationTimestamp"=>undef,"collector"=>"johndoe","observationVariableDbId"=>"77553","observationDbId"=>"740352","value"=>"29.6934","observationVariableName"=>"cass source leaf|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000007","season"=>{"seasonDbId"=>"","season"=>"","year"=>"2017"}},{"observationDbId"=>"740353","observationVariableDbId"=>"77549","observationTimestamp"=>undef,"collector"=>"johndoe","season"=>{"year"=>"2017","season"=>"","seasonDbId"=>""},"observationVariableName"=>"cass source leaf|ADP|ug/g|week 16|COMP:0000003","value"=>"162.9475"},{"observationVariableName"=>"cass storage root|3-phosphoglyceric acid|ug/g|week 16|COMP:0000006","value"=>"23.09545","season"=>{"season"=>"","year"=>"2017","seasonDbId"=>""},"observationTimestamp"=>undef,"collector"=>"johndoe","observationVariableDbId"=>"77552","observationDbId"=>"740354"},{"collector"=>"johndoe","observationTimestamp"=>undef,"observationVariableDbId"=>"77550","observationDbId"=>"740355","observationVariableName"=>"cass storage root|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000004","value"=>"14.3795","season"=>{"seasonDbId"=>"","season"=>"","year"=>"2017"}},{"season"=>{"seasonDbId"=>"","year"=>"2017","season"=>""},"observationVariableName"=>"cass storage root|ADP|ug/g|week 16|COMP:0000005","value"=>"85.9106","observationVariableDbId"=>"77551","observationDbId"=>"740356","collector"=>"johndoe","observationTimestamp"=>undef},{"observationTimestamp"=>undef,"collector"=>"johndoe","observationVariableDbId"=>"77558","observationDbId"=>"740357","observationVariableName"=>"cass upper stem|3-phosphoglyceric acid|ug/g|week 16|COMP:0000012","value"=>"54.2099","season"=>{"year"=>"2017","season"=>"","seasonDbId"=>""}},{"observationVariableName"=>"cass upper stem|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000008","value"=>"13.8628","season"=>{"seasonDbId"=>"","year"=>"2017","season"=>""},"observationTimestamp"=>undef,"collector"=>"johndoe","observationVariableDbId"=>"77554","observationDbId"=>"740358"},{"observationTimestamp"=>undef,"collector"=>"johndoe","observationDbId"=>"740359","observationVariableDbId"=>"77555","observationVariableName"=>"cass upper stem|ADP|ug/g|week 16|COMP:0000009","value"=>"341.041","season"=>{"seasonDbId"=>"","year"=>"2017","season"=>""}}],"blockNumber"=>undef,"observationLevels"=>"plot"}]},"metadata"=>{"datafiles"=>[],"pagination"=>{"currentPage"=>1,"totalPages"=>19,"totalCount"=>19,"pageSize"=>1},"status"=>[{"message"=>"BrAPI base call found with page=1, pageSize=1","code"=>"info"},{"code"=>"info","message"=>"Loading CXGN::BrAPI::v1::Studies"},{"message"=>"Studies observations result constructed","code"=>"200"}]}}, 'study observation units');

$mech->get_ok('http://localhost:3010/brapi/v1/studies/165/table?access_token='.$access_token);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'metadata' => {'pagination' => {'currentPage' => 0,'pageSize' => 10,'totalCount' => 19,'totalPages' => 2},'status' => [{'message' => 'BrAPI base call found with page=0, pageSize=10','code' => 'info'},{'message' => 'Loading CXGN::BrAPI::v1::Studies','code' => 'info'},{'code' => '200','message' => 'Studies observations table result constructed'}],'datafiles' => []},'result' => {'observationVariableNames' => ['cass sink leaf|3-phosphoglyceric acid|ug/g|week 16|COMP:0000013','cass sink leaf|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000011','cass sink leaf|ADP|ug/g|week 16|COMP:0000010','cass source leaf|3-phosphoglyceric acid|ug/g|week 16|COMP:0000002','cass source leaf|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000007','cass source leaf|ADP|ug/g|week 16|COMP:0000003','cass storage root|3-phosphoglyceric acid|ug/g|week 16|COMP:0000006','cass storage root|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000004','cass storage root|ADP|ug/g|week 16|COMP:0000005','cass upper stem|3-phosphoglyceric acid|ug/g|week 16|COMP:0000012','cass upper stem|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000008','cass upper stem|ADP|ug/g|week 16|COMP:0000009','notes'],'data' => [['studyYear','programDbId','programName','programDescription','studyDbId','studyName','studyDescription','studyDesign','plotWidth','plotLength','fieldSize','fieldTrialIsPlannedToBeGenotyped','fieldTrialIsPlannedToCross','plantingDate','harvestDate','locationDbId','locationName','germplasmDbId','germplasmName','germplasmSynonyms','observationLevel','observationUnitDbId','observationUnitName','replicate','blockNumber','plotNumber','rowNumber','colNumber','entryType','plantNumber','plantedSeedlotStockDbId','plantedSeedlotStockUniquename','plantedSeedlotCurrentCount','plantedSeedlotCurrentWeightGram','plantedSeedlotBoxName','plantedSeedlotTransactionCount','plantedSeedlotTransactionWeight','plantedSeedlotTransactionDescription','availableGermplasmSeedlotUniquenames','cass sink leaf|3-phosphoglyceric acid|ug/g|week 16|COMP:0000013','cass sink leaf|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000011','cass sink leaf|ADP|ug/g|week 16|COMP:0000010','cass source leaf|3-phosphoglyceric acid|ug/g|week 16|COMP:0000002','cass source leaf|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000007','cass source leaf|ADP|ug/g|week 16|COMP:0000003','cass storage root|3-phosphoglyceric acid|ug/g|week 16|COMP:0000006','cass storage root|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000004','cass storage root|ADP|ug/g|week 16|COMP:0000005','cass upper stem|3-phosphoglyceric acid|ug/g|week 16|COMP:0000012','cass upper stem|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000008','cass upper stem|ADP|ug/g|week 16|COMP:0000009','notes'],['2017',134,'test','test',165,'CASS_6Genotypes_Sampling_2015','Copy of trial with postcomposed phenotypes from cassbase.','RCBD',undef,undef,undef,undef,undef,undef,undef,'23','test_location',41283,'IITA-TMS-IBA980581','','plot',41284,'CASS_6Genotypes_103','1','1','103',undef,undef,'test',undef,undef,undef,undef,undef,undef,undef,undef,undef,'','601.518','39.84365','655.92','1259.08','17.38275','192.1495','67.9959','20.3038','102.0875','108.56995','28.83915','379.16',undef],['2017',134,'test','test',165,'CASS_6Genotypes_Sampling_2015','Copy of trial with postcomposed phenotypes from cassbase.','RCBD',undef,undef,undef,undef,undef,undef,undef,'23','test_location',41282,'IITA-TMS-IBA980002','','plot',41295,'CASS_6Genotypes_104','1','1','104',undef,undef,'test',undef,undef,undef,undef,undef,undef,undef,undef,undef,'','221.6135','36.12425','316.489','908.9045','29.6934','162.9475','23.09545','14.3795','85.9106','54.2099','13.8628','341.041',undef],['2017',134,'test','test',165,'CASS_6Genotypes_Sampling_2015','Copy of trial with postcomposed phenotypes from cassbase.','RCBD',undef,undef,undef,undef,undef,undef,undef,'23','test_location',41279,'IITA-TMS-IBA30572','','plot',41296,'CASS_6Genotypes_105','1','1','105',undef,undef,'test',undef,undef,undef,undef,undef,undef,undef,undef,undef,'','662.087','46.1458','559.441','1974.265','38.1064','484.765','33.1455','16.7238','98.71395','97.8179','35.4435','439.9695',undef],['2017',134,'test','test',165,'CASS_6Genotypes_Sampling_2015','Copy of trial with postcomposed phenotypes from cassbase.','RCBD',undef,undef,undef,undef,undef,undef,undef,'23','test_location',41281,'IITA-TMS-IBA011412','','plot',41297,'CASS_6Genotypes_106','1','1','106',undef,undef,'test',undef,undef,undef,undef,undef,undef,undef,undef,undef,'','612.37','23.788','604.5625','646.902','26.60415','192.46','39.6698','16.78125','107.74','78.72305','28.3805','469.818',undef],['2017',134,'test','test',165,'CASS_6Genotypes_Sampling_2015','Copy of trial with postcomposed phenotypes from cassbase.','RCBD',undef,undef,undef,undef,undef,undef,undef,'23','test_location',41280,'TMEB693','','plot',41298,'CASS_6Genotypes_107','1','1','107',undef,undef,'test',undef,undef,undef,undef,undef,undef,undef,undef,undef,'','198.089','47.64845','485.944','779.191','21.12875','147.0405','31.554','10.59626','46.41935','101.7506','30.86975','423.355',undef],['2017',134,'test','test',165,'CASS_6Genotypes_Sampling_2015','Copy of trial with postcomposed phenotypes from cassbase.','RCBD',undef,undef,undef,undef,undef,undef,undef,'23','test_location',40326,'BLANK','','plot',41299,'CASS_6Genotypes_201','1','2','201',undef,undef,'test',undef,undef,undef,undef,undef,undef,undef,undef,undef,'',undef,undef,undef,undef,undef,undef,undef,undef,undef,undef,undef,undef,undef],['2017',134,'test','test',165,'CASS_6Genotypes_Sampling_2015','Copy of trial with postcomposed phenotypes from cassbase.','RCBD',undef,undef,undef,undef,undef,undef,undef,'23','test_location',41280,'TMEB693','','plot',41300,'CASS_6Genotypes_202','1','2','202',undef,undef,'test',undef,undef,undef,undef,undef,undef,undef,undef,undef,'','250.228','39.2627','478.0445','1295.29','21.56485','169.757','26.2744','5.31292','39.4774','61.51325','36.2316','241.418',undef],['2017',134,'test','test',165,'CASS_6Genotypes_Sampling_2015','Copy of trial with postcomposed phenotypes from cassbase.','RCBD',undef,undef,undef,undef,undef,undef,undef,'23','test_location',41282,'IITA-TMS-IBA980002','','plot',41301,'CASS_6Genotypes_203','1','2','203',undef,undef,'test',undef,undef,undef,undef,undef,undef,undef,undef,undef,'','245.679','29.4029','299.096','1013.111','17.04795','202.893','40.306','7.442495','75.2132','57.47695','20.43645','303.3225',undef]],'observationVariableDbIds' => [77559,77557,77556,77548,77553,77549,77552,77550,77551,77558,77554,77555,0],'headerRow' => ['studyYear','programDbId','programName','programDescription','studyDbId','studyName','studyDescription','studyDesign','plotWidth','plotLength','fieldSize','fieldTrialIsPlannedToBeGenotyped','fieldTrialIsPlannedToCross','plantingDate','harvestDate','locationDbId','locationName','germplasmDbId','germplasmName','germplasmSynonyms','observationLevel','observationUnitDbId','observationUnitName','replicate','blockNumber','plotNumber','rowNumber','colNumber','entryType','plantNumber','plantedSeedlotStockDbId','plantedSeedlotStockUniquename','plantedSeedlotCurrentCount','plantedSeedlotCurrentWeightGram','plantedSeedlotBoxName','plantedSeedlotTransactionCount','plantedSeedlotTransactionWeight','plantedSeedlotTransactionDescription','availableGermplasmSeedlotUniquenames']}}, 'study table');

$mech->get_ok('http://localhost:3010/brapi/v1/studies/165/layout?pageSize=2&page=1&access_token='.$access_token);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'metadata' => {'status' => [{'message' => 'BrAPI base call found with page=1, pageSize=2','code' => 'info'},{'message' => 'Loading CXGN::BrAPI::v1::Studies','code' => 'info'},{'message' => 'Studies layout result constructed','code' => '200'}],'datafiles' => [],'pagination' => {'totalPages' => 10,'pageSize' => 2,'totalCount' => 19,'currentPage' => 1}},'result' => {'data' => [{'germplasmDbId' => 41279,'blockNumber' => '1','observationLevel' => 'plot','X' => '','observationUnitDbId' => 41296,'studyDbId' => '165','replicate' => '1','additionalInfo' => {'plantNames' => [],'plotNumber' => '105','designType' => 'RCBD','plotImageDbIds' => [],'plantDbIds' => []},'observationUnitName' => 'CASS_6Genotypes_105','entryType' => 'Test','germplasmName' => 'IITA-TMS-IBA30572','Y' => ''},{'X' => '','observationUnitDbId' => 41297,'studyDbId' => '165','blockNumber' => '1','germplasmDbId' => 41281,'observationLevel' => 'plot','Y' => '','germplasmName' => 'IITA-TMS-IBA011412','entryType' => 'Test','replicate' => '1','additionalInfo' => {'plotNumber' => '106','plantNames' => [],'plantDbIds' => [],'plotImageDbIds' => [],'designType' => 'RCBD'},'observationUnitName' => 'CASS_6Genotypes_106'}]}}, 'study layout');

$mech->get_ok('http://localhost:3010/brapi/v1/studies/165/observations?pageSize=2&page=1&access_token='.$access_token);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'metadata' => {'status' => [{'code' => 'info','message' => 'BrAPI base call found with page=1, pageSize=2'},{'message' => 'Loading CXGN::BrAPI::v1::Studies','code' => 'info'},{'code' => '200','message' => 'Studies observations granular result constructed'}],'datafiles' => [],'pagination' => {'pageSize' => 2,'totalPages' => 99,'currentPage' => 1,'totalCount' => 198}},'result' => {'data' => [{'uploadedBy' => 'johndoe','operator' => 'johndoe','observationUnitName' => 'CASS_6Genotypes_103','studyDbId' => 165,'germplasmName' => 'IITA-TMS-IBA980581','observationUnitDbId' => 41284,'value' => '655.92','germplasmDbId' => 41283,'observationDbId' => 740338,'observationLevel' => 'plot','observationTimestamp' => undef,'observationVariableName' => 'cass sink leaf|ADP|ug/g|week 16|COMP:0000010','observationVariableDbId' => 77556},{'uploadedBy' => 'johndoe','operator' => 'johndoe','observationUnitName' => 'CASS_6Genotypes_103','studyDbId' => 165,'germplasmName' => 'IITA-TMS-IBA980581','observationUnitDbId' => 41284,'value' => '1259.08','germplasmDbId' => 41283,'observationDbId' => 740339,'observationLevel' => 'plot','observationTimestamp' => undef,'observationVariableDbId' => 77548,'observationVariableName' => 'cass source leaf|3-phosphoglyceric acid|ug/g|week 16|COMP:0000002'}]}}, 'study observations');

$mech->get_ok('http://localhost:3010/brapi/v1/phenotypes-search?pageSize=2&access_token='.$access_token);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'result' => {'data' => [{'studyDbId' => '165','observationLevels' => 'plot','X' => undef,'plantNumber' => undef,'observations' => [{'season' => '2017','observationDbId' => '740336','observationVariableDbId' => '77559','observationTimeStamp' => undef,'collector' => 'johndoe','value' => '601.518','observationVariableName' => 'cass sink leaf|3-phosphoglyceric acid|ug/g|week 16|COMP:0000013'},{'observationVariableName' => 'cass sink leaf|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000011','value' => '39.84365','collector' => 'johndoe','observationTimeStamp' => undef,'season' => '2017','observationDbId' => '740337','observationVariableDbId' => '77557'},{'observationVariableDbId' => '77556','season' => '2017','observationDbId' => '740338','collector' => 'johndoe','observationTimeStamp' => undef,'value' => '655.92','observationVariableName' => 'cass sink leaf|ADP|ug/g|week 16|COMP:0000010'},{'observationTimeStamp' => undef,'collector' => 'johndoe','observationDbId' => '740339','season' => '2017','observationVariableDbId' => '77548','observationVariableName' => 'cass source leaf|3-phosphoglyceric acid|ug/g|week 16|COMP:0000002','value' => '1259.08'},{'observationDbId' => '740340','season' => '2017','observationVariableDbId' => '77553','collector' => 'johndoe','observationTimeStamp' => undef,'value' => '17.38275','observationVariableName' => 'cass source leaf|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000007'},{'collector' => 'johndoe','observationTimeStamp' => undef,'observationVariableDbId' => '77549','observationDbId' => '740341','season' => '2017','observationVariableName' => 'cass source leaf|ADP|ug/g|week 16|COMP:0000003','value' => '192.1495'},{'observationVariableName' => 'cass storage root|3-phosphoglyceric acid|ug/g|week 16|COMP:0000006','value' => '67.9959','collector' => 'johndoe','observationTimeStamp' => undef,'observationVariableDbId' => '77552','observationDbId' => '740342','season' => '2017'},{'observationVariableName' => 'cass storage root|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000004','value' => '20.3038','collector' => 'johndoe','observationTimeStamp' => undef,'observationVariableDbId' => '77550','observationDbId' => '740343','season' => '2017'},{'value' => '102.0875','observationVariableName' => 'cass storage root|ADP|ug/g|week 16|COMP:0000005','observationVariableDbId' => '77551','season' => '2017','observationDbId' => '740344','observationTimeStamp' => undef,'collector' => 'johndoe'},{'collector' => 'johndoe','observationTimeStamp' => undef,'season' => '2017','observationDbId' => '740345','observationVariableDbId' => '77558','observationVariableName' => 'cass upper stem|3-phosphoglyceric acid|ug/g|week 16|COMP:0000012','value' => '108.56995'},{'season' => '2017','observationDbId' => '740346','observationVariableDbId' => '77554','observationTimeStamp' => undef,'collector' => 'johndoe','value' => '28.83915','observationVariableName' => 'cass upper stem|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000008'},{'observationVariableName' => 'cass upper stem|ADP|ug/g|week 16|COMP:0000009','value' => '379.16','collector' => 'johndoe','observationTimeStamp' => undef,'season' => '2017','observationDbId' => '740347','observationVariableDbId' => '77555'}],'observationUnitName' => 'CASS_6Genotypes_103','germplasmDbId' => '41283','entryType' => 'test','entryNumber' => '','programName' => 'test','studyLocation' => 'test_location','plotNumber' => '103','Y' => undef,'germplasmName' => 'IITA-TMS-IBA980581','treatments' => [{'modality' => '','factor' => 'No ManagementFactor'}],'observationLevel' => 'plot','studyLocationDbId' => '23','observationUnitDbId' => '41284','replicate' => '1','studyName' => 'CASS_6Genotypes_Sampling_2015','blockNumber' => '1'}]},'metadata' => {'status' => [{'code' => 'info','message' => 'BrAPI base call found with page=0, pageSize=2'},{'message' => 'Loading CXGN::BrAPI::v1::Phenotypes','code' => 'info'},{'code' => '200','message' => 'Phenotype search result constructed'}],'datafiles' => [],'pagination' => {'totalCount' => 1954,'currentPage' => 0,'totalPages' => 977,'pageSize' => 2}}}, 'phenotype search');

$mech->get_ok('http://localhost:3010/brapi/v1/phenotypes-search?pageSize=2&studyDbId=165&observationVariableDbId=77551&access_token='.$access_token);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'result' => {'data' => [{'observationLevels' => 'plot','studyDbId' => '165','plantNumber' => undef,'observations' => [{'season' => '2017','observationDbId' => '740344','observationVariableDbId' => '77551','observationTimeStamp' => undef,'collector' => 'johndoe','value' => '102.0875','observationVariableName' => 'cass storage root|ADP|ug/g|week 16|COMP:0000005'}],'X' => undef,'observationUnitName' => 'CASS_6Genotypes_103','entryNumber' => '','entryType' => 'test','programName' => 'test','germplasmDbId' => '41283','Y' => undef,'plotNumber' => '103','studyLocation' => 'test_location','studyLocationDbId' => '23','observationLevel' => 'plot','treatments' => [{'factor' => 'No ManagementFactor','modality' => ''}],'germplasmName' => 'IITA-TMS-IBA980581','observationUnitDbId' => '41284','blockNumber' => '1','studyName' => 'CASS_6Genotypes_Sampling_2015','replicate' => '1'}]},'metadata' => {'status' => [{'message' => 'BrAPI base call found with page=0, pageSize=2','code' => 'info'},{'message' => 'Loading CXGN::BrAPI::v1::Phenotypes','code' => 'info'},{'code' => '200','message' => 'Phenotype search result constructed'}],'datafiles' => [],'pagination' => {'totalCount' => 15,'currentPage' => 0,'pageSize' => 2,'totalPages' => 8}}}, 'phenotype search study 139');

$mech->get_ok('http://localhost:3010/brapi/v1/traits?pageSize=1&page=1&access_token='.$access_token );
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'metadata' => {'status' => [{'message' => 'BrAPI base call found with page=1, pageSize=1','code' => 'info'},{'code' => 'info','message' => 'Loading CXGN::BrAPI::v1::Traits'},{'code' => '200','message' => 'Traits list result constructed'}],'datafiles' => [],'pagination' => {'pageSize' => 1,'totalPages' => 245,'currentPage' => 1,'totalCount' => 245}},'result' => {'data' => [{'observationVariables' => ['amylopectin content ug/g in percentage|CO_334:0000121'],'description' => 'Estimation of amylopectin content of cassava roots in percentage(%).','traitDbId' => '70761','defaultValue' => '','traitId' => 'CO_334:0000121','name' => 'amylopectin content ug/g in percentage'}]}}, 'traits');

# $mech->get_ok('http://localhost:3010/brapi/v1/maps?pageSize=1&page=1&access_token='.$access_token );
# $response = decode_json $mech->content;
# print STDERR Dumper $response;
# is_deeply($response, {'metadata' => {'datafiles' => [],'pagination' => {'totalCount' => 1,'currentPage' => 1,'pageSize' => 1,'totalPages' => 1},'status' => [{'code' => 'info','message' => 'BrAPI base call found with page=1, pageSize=1'},{'message' => 'Loading CXGN::BrAPI::v1::GenomeMaps','code' => 'info'},{'code' => '200','message' => 'Maps list result constructed'}]},'result' => {'data' => [{'markerCount' => '0','species' => 'Solanum lycopersicum','name' => 'Tomato Pachytene Chromosomes','unit' => 'cM','type' => 'Genetic','linkageGroupCount' => 12,'comments' => 'This map shows the pachytene chromosomes of tomato. It is only for illustrative purposes and does not contain any markers. <br /><br />Images courtesy of Prof. Stephen Stack, Colorado State University.','mapDbId' => 'pachy'}]}}, 'maps');

$mech->get_ok('http://localhost:3010/brapi/v1/locations?pageSize=1&page=1&access_token='.$access_token );
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'result' => {'data' => [{'altitude' => '274','latitude' => '42.4534','locationType' => '','countryCode' => 'USA','additionalInfo' => {'geodetic datum' => undef,'breeding_program' => '134'},'locationDbId' => '24','countryName' => 'United States','instituteName' => '','longitude' => '-76.4735','abbreviation' => '','name' => 'Cornell Biotech','instituteAddress' => ''}]},'metadata' => {'datafiles' => [],'pagination' => {'totalPages' => 3,'currentPage' => 1,'totalCount' => 3,'pageSize' => 1},'status' => [{'code' => 'info','message' => 'BrAPI base call found with page=1, pageSize=1'},{'code' => 'info','message' => 'Loading CXGN::BrAPI::v1::Locations'},{'message' => 'Locations list result constructed','code' => '200'}]}}, 'location');

$mech->get_ok('http://localhost:3010/brapi/v1/ontologies?access_token='.$access_token );
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {"metadata"=>{"datafiles"=>[],"status"=>[{"message"=>"BrAPI base call found with page=0, pageSize=10","code"=>"info"},{"code"=>"info","message"=>"Loading CXGN::BrAPI::v1::ObservationVariables"},{"message"=>"Ontologies result constructed","code"=>"200"}],"pagination"=>{"totalPages"=>1,"totalCount"=>2,"pageSize"=>10,"currentPage"=>0}},"result"=>{"data"=>[{"description"=>"CGIAR cassava trait ontology","copyright"=>"","ontologyName"=>"CO_334","version"=>"","authors"=>"","ontologyDbId"=>"186","ontologyDbxrefAccession"=>"0000000","licence"=>""},{"copyright"=>"","description"=>"fieldbook_image","ontologyName"=>"CO_334","authors"=>"","version"=>"","ontologyDbxrefAccession"=>"0010472","licence"=>"","ontologyDbId"=>"186"}]}}, 'ontologies');

$mech->get_ok('http://localhost:3010/brapi/v1/variables?access_token='.$access_token );
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {"result"=>{"data"=>[{"ontologyReference"=>{"documentationURL"=>{"type"=>"","URL"=>""},"version"=>"","ontologyDbId"=>"186","ontologyName"=>"CO_334"},"ontologyName"=>"CO_334","observationVariableName"=>"abscisic acid content of leaf ug/g","growthStage"=>"","defaultValue"=>"","trait"=>{"name"=>"abscisic acid content of leaf ug/g","traitDbId"=>"70692","status"=>"","alternativeAbbreviations"=>[],"attribute"=>"abscisic acid content of leaf ug/g","mainAbbreviations"=>"","traitName"=>"abscisic acid content of leaf ug/g","entity"=>"","synonyms"=>[],"description"=>"Abscisic acid content of leaf sample.","class"=>"","xref"=>"CO_334:0000047","ontologyReference"=>{"documentationURL"=>{"type"=>"","URL"=>""},"version"=>"","ontologyDbId"=>"186","ontologyName"=>"CO_334"}},"language"=>"","status"=>JSON::true,"xref"=>"CO_334:0000047","method"=>{"ontologyReference"=>{"documentationURL"=>{"type"=>"","URL"=>""},"version"=>"","ontologyDbId"=>"186","ontologyName"=>"CO_334"},"methodDbId"=>"","description"=>"","class"=>"","formula"=>"","methodName"=>"","name"=>"","reference"=>""},"scale"=>{"scaleDbId"=>"","decimalPlaces"=>undef,"xref"=>"","ontologyReference"=>{"documentationURL"=>{"type"=>"","URL"=>""},"version"=>"","ontologyDbId"=>"186","ontologyName"=>"CO_334"},"validValues"=>{"categories"=>[],"max"=>undef,"min"=>undef},"dataType"=>"","name"=>"","scaleName"=>""},"contextOfUse"=>[],"submissionTimestamp"=>undef,"synonyms"=>[],"institution"=>"https://breedbase.org","scientist"=>"","documentationURL"=>"","observationVariableDbId"=>"abscisic acid content of leaf ug/g|CO_334:0000047","crop"=>"Cassava","ontologyDbId"=>"186","name"=>"abscisic acid content of leaf ug/g"},{"crop"=>"Cassava","ontologyDbId"=>"186","name"=>"amylopectin content ug/g in percentage","documentationURL"=>"","observationVariableDbId"=>"amylopectin content ug/g in percentage|CO_334:0000121","institution"=>"https://breedbase.org","scientist"=>"","synonyms"=>[],"submissionTimestamp"=>undef,"contextOfUse"=>[],"method"=>{"ontologyReference"=>{"documentationURL"=>{"type"=>"","URL"=>""},"version"=>"","ontologyDbId"=>"186","ontologyName"=>"CO_334"},"formula"=>"","methodDbId"=>"","description"=>"","class"=>"","methodName"=>"","name"=>"","reference"=>""},"xref"=>"CO_334:0000121","scale"=>{"dataType"=>"","name"=>"","scaleName"=>"","scaleDbId"=>"","xref"=>"","ontologyReference"=>{"documentationURL"=>{"type"=>"","URL"=>""},"version"=>"","ontologyDbId"=>"186","ontologyName"=>"CO_334"},"validValues"=>{"categories"=>[],"max"=>undef,"min"=>undef},"decimalPlaces"=>undef},"status"=>JSON::true,"language"=>"","defaultValue"=>"","growthStage"=>"","trait"=>{"entity"=>"","class"=>"","synonyms"=>[],"description"=>"Estimation of amylopectin content of cassava roots in percentage(%).","ontologyReference"=>{"documentationURL"=>{"type"=>"","URL"=>""},"version"=>"","ontologyDbId"=>"186","ontologyName"=>"CO_334"},"xref"=>"CO_334:0000121","status"=>"","traitDbId"=>"70761","name"=>"amylopectin content ug/g in percentage","alternativeAbbreviations"=>[],"mainAbbreviations"=>"","traitName"=>"amylopectin content ug/g in percentage","attribute"=>"amylopectin content ug/g in percentage"},"ontologyName"=>"CO_334","observationVariableName"=>"amylopectin content ug/g in percentage","ontologyReference"=>{"documentationURL"=>{"type"=>"","URL"=>""},"version"=>"","ontologyDbId"=>"186","ontologyName"=>"CO_334"}},{"language"=>"","status"=>JSON::true,"ontologyReference"=>{"ontologyDbId"=>"186","ontologyName"=>"CO_334","version"=>"","documentationURL"=>{"type"=>"","URL"=>""}},"ontologyName"=>"CO_334","observationVariableName"=>"amylose amylopectin root content ratio","growthStage"=>"","defaultValue"=>"","trait"=>{"class"=>"","synonyms"=>[],"description"=>"The amylose content of a cassava root sample divided by the amylopectin content of the same sample.","entity"=>"","xref"=>"CO_334:0000124","ontologyReference"=>{"ontologyDbId"=>"186","ontologyName"=>"CO_334","version"=>"","documentationURL"=>{"type"=>"","URL"=>""}},"alternativeAbbreviations"=>[],"status"=>"","name"=>"amylose amylopectin root content ratio","traitDbId"=>"70752","traitName"=>"amylose amylopectin root content ratio","mainAbbreviations"=>"","attribute"=>"amylose amylopectin root content ratio"},"scientist"=>"","institution"=>"https://breedbase.org","documentationURL"=>"","observationVariableDbId"=>"amylose amylopectin root content ratio|CO_334:0000124","ontologyDbId"=>"186","crop"=>"Cassava","name"=>"amylose amylopectin root content ratio","xref"=>"CO_334:0000124","scale"=>{"scaleName"=>"","dataType"=>"","name"=>"","decimalPlaces"=>undef,"xref"=>"","validValues"=>{"max"=>undef,"categories"=>[],"min"=>undef},"ontologyReference"=>{"ontologyDbId"=>"186","ontologyName"=>"CO_334","version"=>"","documentationURL"=>{"type"=>"","URL"=>""}},"scaleDbId"=>""},"method"=>{"ontologyReference"=>{"ontologyDbId"=>"186","ontologyName"=>"CO_334","version"=>"","documentationURL"=>{"type"=>"","URL"=>""}},"formula"=>"","class"=>"","methodDbId"=>"","description"=>"","methodName"=>"","reference"=>"","name"=>""},"contextOfUse"=>[],"synonyms"=>[],"submissionTimestamp"=>undef},{"documentationURL"=>"","observationVariableDbId"=>"amylose content in ug/g percentage|CO_334:0000075","institution"=>"https://breedbase.org","scientist"=>"","ontologyDbId"=>"186","crop"=>"Cassava","name"=>"amylose content in ug/g percentage","contextOfUse"=>[],"xref"=>"CO_334:0000075","scale"=>{"name"=>"","dataType"=>"","scaleName"=>"","scaleDbId"=>"","validValues"=>{"min"=>undef,"categories"=>[],"max"=>undef},"xref"=>"","ontologyReference"=>{"ontologyName"=>"CO_334","ontologyDbId"=>"186","version"=>"","documentationURL"=>{"type"=>"","URL"=>""}},"decimalPlaces"=>undef},"method"=>{"methodName"=>"","name"=>"","reference"=>"","ontologyReference"=>{"ontologyName"=>"CO_334","ontologyDbId"=>"186","version"=>"","documentationURL"=>{"type"=>"","URL"=>""}},"formula"=>"","description"=>"","methodDbId"=>"","class"=>""},"submissionTimestamp"=>undef,"synonyms"=>[],"status"=>JSON::true,"language"=>"","ontologyReference"=>{"ontologyName"=>"CO_334","ontologyDbId"=>"186","version"=>"","documentationURL"=>{"type"=>"","URL"=>""}},"defaultValue"=>"","growthStage"=>"","trait"=>{"attribute"=>"amylose content in ug/g percentage","mainAbbreviations"=>"","traitName"=>"amylose content in ug/g percentage","name"=>"amylose content in ug/g percentage","traitDbId"=>"70676","status"=>"","alternativeAbbreviations"=>[],"ontologyReference"=>{"ontologyName"=>"CO_334","ontologyDbId"=>"186","version"=>"","documentationURL"=>{"type"=>"","URL"=>""}},"xref"=>"CO_334:0000075","entity"=>"","description"=>"Estimation of amylose content of cassava roots in percentage (%).","synonyms"=>[],"class"=>""},"ontologyName"=>"CO_334","observationVariableName"=>"amylose content in ug/g percentage"},{"language"=>"","status"=>JSON::true,"observationVariableName"=>"anther color","ontologyName"=>"CO_334","trait"=>{"alternativeAbbreviations"=>[],"status"=>"","name"=>"anther color","traitDbId"=>"70717","mainAbbreviations"=>"","traitName"=>"anther color","attribute"=>"anther color","class"=>"","synonyms"=>[],"description"=>"Visual scoring of anther color with 1 = cream, 2 = yellow, and 3 = other.","entity"=>"","xref"=>"CO_334:0000061","ontologyReference"=>{"ontologyDbId"=>"186","ontologyName"=>"CO_334","documentationURL"=>{"type"=>"","URL"=>""},"version"=>""}},"growthStage"=>"","defaultValue"=>"","ontologyReference"=>{"ontologyDbId"=>"186","ontologyName"=>"CO_334","documentationURL"=>{"type"=>"","URL"=>""},"version"=>""},"name"=>"anther color","ontologyDbId"=>"186","crop"=>"Cassava","institution"=>"https://breedbase.org","scientist"=>"","observationVariableDbId"=>"anther color|CO_334:0000061","documentationURL"=>"","submissionTimestamp"=>undef,"synonyms"=>[],"method"=>{"reference"=>"","name"=>"","methodName"=>"","class"=>"","description"=>"","methodDbId"=>"","formula"=>"","ontologyReference"=>{"ontologyDbId"=>"186","ontologyName"=>"CO_334","documentationURL"=>{"type"=>"","URL"=>""},"version"=>""}},"xref"=>"CO_334:0000061","scale"=>{"scaleName"=>"","dataType"=>"","name"=>"","decimalPlaces"=>undef,"ontologyReference"=>{"ontologyDbId"=>"186","ontologyName"=>"CO_334","documentationURL"=>{"type"=>"","URL"=>""},"version"=>""},"xref"=>"","validValues"=>{"min"=>undef,"categories"=>[],"max"=>undef},"scaleDbId"=>""},"contextOfUse"=>[]},{"ontologyReference"=>{"documentationURL"=>{"URL"=>"","type"=>""},"version"=>"","ontologyName"=>"CO_334","ontologyDbId"=>"186"},"ontologyName"=>"CO_334","observationVariableName"=>"anthocyanin pigmentation visual rating 0-3","growthStage"=>"","defaultValue"=>"","trait"=>{"ontologyReference"=>{"documentationURL"=>{"URL"=>"","type"=>""},"version"=>"","ontologyName"=>"CO_334","ontologyDbId"=>"186"},"xref"=>"CO_334:0000103","entity"=>"","description"=>"Visual rating of distribution of anthocyanin pigmentation with 0 = absent, 1 = top part, 2 = central part, 3 = totally pigmented.","synonyms"=>[],"class"=>"","attribute"=>"anthocyanin pigmentation visual rating 0-3","traitName"=>"anthocyanin pigmentation visual rating 0-3","mainAbbreviations"=>"","name"=>"anthocyanin pigmentation visual rating 0-3","traitDbId"=>"70775","status"=>"","alternativeAbbreviations"=>[]},"language"=>"","status"=>JSON::true,"xref"=>"CO_334:0000103","method"=>{"description"=>"","methodDbId"=>"","class"=>"","formula"=>"","ontologyReference"=>{"documentationURL"=>{"URL"=>"","type"=>""},"version"=>"","ontologyName"=>"CO_334","ontologyDbId"=>"186"},"name"=>"","reference"=>"","methodName"=>""},"scale"=>{"dataType"=>"","name"=>"","scaleName"=>"","scaleDbId"=>"","decimalPlaces"=>undef,"ontologyReference"=>{"documentationURL"=>{"URL"=>"","type"=>""},"version"=>"","ontologyName"=>"CO_334","ontologyDbId"=>"186"},"xref"=>"","validValues"=>{"min"=>undef,"max"=>undef,"categories"=>[]}},"contextOfUse"=>[],"synonyms"=>[],"submissionTimestamp"=>undef,"scientist"=>"","institution"=>"https://breedbase.org","documentationURL"=>"","observationVariableDbId"=>"anthocyanin pigmentation visual rating 0-3|CO_334:0000103","crop"=>"Cassava","ontologyDbId"=>"186","name"=>"anthocyanin pigmentation visual rating 0-3"},{"status"=>JSON::true,"language"=>"","trait"=>{"ontologyReference"=>{"ontologyDbId"=>"186","ontologyName"=>"CO_334","version"=>"","documentationURL"=>{"URL"=>"","type"=>""}},"xref"=>"CO_334:0000086","class"=>"","description"=>"Number of weeks from planting to first apical branching associated with the formation of inflorescence.","synonyms"=>[],"entity"=>"","traitName"=>"apical branching","mainAbbreviations"=>"","attribute"=>"apical branching","alternativeAbbreviations"=>[],"status"=>"","traitDbId"=>"70693","name"=>"apical branching"},"growthStage"=>"","defaultValue"=>"","observationVariableName"=>"apical branching","ontologyName"=>"CO_334","ontologyReference"=>{"ontologyDbId"=>"186","ontologyName"=>"CO_334","version"=>"","documentationURL"=>{"URL"=>"","type"=>""}},"name"=>"apical branching","crop"=>"Cassava","ontologyDbId"=>"186","observationVariableDbId"=>"apical branching|CO_334:0000086","documentationURL"=>"","institution"=>"https://breedbase.org","scientist"=>"","synonyms"=>[],"submissionTimestamp"=>undef,"contextOfUse"=>[],"xref"=>"CO_334:0000086","scale"=>{"scaleDbId"=>"","xref"=>"","validValues"=>{"min"=>undef,"max"=>undef,"categories"=>[]},"ontologyReference"=>{"ontologyDbId"=>"186","ontologyName"=>"CO_334","version"=>"","documentationURL"=>{"URL"=>"","type"=>""}},"decimalPlaces"=>undef,"dataType"=>"","name"=>"","scaleName"=>""},"method"=>{"ontologyReference"=>{"ontologyDbId"=>"186","ontologyName"=>"CO_334","version"=>"","documentationURL"=>{"URL"=>"","type"=>""}},"description"=>"","methodDbId"=>"","class"=>"","formula"=>"","methodName"=>"","name"=>"","reference"=>""}},{"name"=>"apical pubescence","crop"=>"Cassava","ontologyDbId"=>"186","observationVariableDbId"=>"apical pubescence|CO_334:0000026","documentationURL"=>"","scientist"=>"","institution"=>"https://breedbase.org","synonyms"=>[],"submissionTimestamp"=>undef,"contextOfUse"=>[],"xref"=>"CO_334:0000026","scale"=>{"name"=>"","dataType"=>"","scaleName"=>"","scaleDbId"=>"","decimalPlaces"=>undef,"xref"=>"","ontologyReference"=>{"ontologyName"=>"CO_334","ontologyDbId"=>"186","version"=>"","documentationURL"=>{"type"=>"","URL"=>""}},"validValues"=>{"min"=>undef,"max"=>undef,"categories"=>[]}},"method"=>{"ontologyReference"=>{"ontologyName"=>"CO_334","ontologyDbId"=>"186","version"=>"","documentationURL"=>{"type"=>"","URL"=>""}},"formula"=>"","description"=>"","methodDbId"=>"","class"=>"","methodName"=>"","name"=>"","reference"=>""},"status"=>JSON::true,"language"=>"","trait"=>{"ontologyReference"=>{"ontologyName"=>"CO_334","ontologyDbId"=>"186","version"=>"","documentationURL"=>{"type"=>"","URL"=>""}},"xref"=>"CO_334:0000026","synonyms"=>[],"description"=>"Visual rating of young leaf pubescence with 0 = absent or glabrous, 3 = little pubescence, 5 = moderate pubescence, and 7 = high pubescence.","class"=>"","entity"=>"","attribute"=>"apical pubescence","mainAbbreviations"=>"","traitName"=>"apical pubescence","alternativeAbbreviations"=>[],"traitDbId"=>"70743","name"=>"apical pubescence","status"=>""},"growthStage"=>"","defaultValue"=>"","observationVariableName"=>"apical pubescence","ontologyName"=>"CO_334","ontologyReference"=>{"ontologyName"=>"CO_334","ontologyDbId"=>"186","version"=>"","documentationURL"=>{"type"=>"","URL"=>""}}},{"ontologyName"=>"CO_334","observationVariableName"=>"ascorbic acid in root percentage","growthStage"=>"","defaultValue"=>"","trait"=>{"traitName"=>"ascorbic acid in root percentage","mainAbbreviations"=>"","attribute"=>"ascorbic acid in root percentage","alternativeAbbreviations"=>[],"status"=>"","traitDbId"=>"70739","name"=>"ascorbic acid in root percentage","ontologyReference"=>{"version"=>"","documentationURL"=>{"URL"=>"","type"=>""},"ontologyDbId"=>"186","ontologyName"=>"CO_334"},"xref"=>"CO_334:0000065","class"=>"","description"=>"Antioxidant and water soluble vitamin of cassava storage root.","synonyms"=>[],"entity"=>""},"ontologyReference"=>{"version"=>"","documentationURL"=>{"URL"=>"","type"=>""},"ontologyDbId"=>"186","ontologyName"=>"CO_334"},"language"=>"","status"=>JSON::true,"synonyms"=>[],"submissionTimestamp"=>undef,"scale"=>{"scaleName"=>"","name"=>"","dataType"=>"","decimalPlaces"=>undef,"ontologyReference"=>{"version"=>"","documentationURL"=>{"URL"=>"","type"=>""},"ontologyDbId"=>"186","ontologyName"=>"CO_334"},"xref"=>"","validValues"=>{"categories"=>[],"max"=>undef,"min"=>undef},"scaleDbId"=>""},"xref"=>"CO_334:0000065","method"=>{"formula"=>"","methodDbId"=>"","description"=>"","class"=>"","ontologyReference"=>{"version"=>"","documentationURL"=>{"URL"=>"","type"=>""},"ontologyDbId"=>"186","ontologyName"=>"CO_334"},"name"=>"","reference"=>"","methodName"=>""},"contextOfUse"=>[],"ontologyDbId"=>"186","crop"=>"Cassava","name"=>"ascorbic acid in root percentage","scientist"=>"","institution"=>"https://breedbase.org","documentationURL"=>"","observationVariableDbId"=>"ascorbic acid in root percentage|CO_334:0000065"},{"status"=>JSON::true,"language"=>"","ontologyReference"=>{"ontologyDbId"=>"186","ontologyName"=>"CO_334","version"=>"","documentationURL"=>{"URL"=>"","type"=>""}},"trait"=>{"name"=>"ash content in percentage","traitDbId"=>"70663","status"=>"","alternativeAbbreviations"=>[],"attribute"=>"ash content in percentage","mainAbbreviations"=>"","traitName"=>"ash content in percentage","entity"=>"","description"=>"Residue left behind after all organic matter has been burnt off, a measure of total mineral salts in a food estimated in percentage (%).","synonyms"=>[],"class"=>"","ontologyReference"=>{"ontologyDbId"=>"186","ontologyName"=>"CO_334","version"=>"","documentationURL"=>{"URL"=>"","type"=>""}},"xref"=>"CO_334:0000066"},"growthStage"=>"","defaultValue"=>"","observationVariableName"=>"ash content in percentage","ontologyName"=>"CO_334","observationVariableDbId"=>"ash content in percentage|CO_334:0000066","documentationURL"=>"","scientist"=>"","institution"=>"https://breedbase.org","name"=>"ash content in percentage","ontologyDbId"=>"186","crop"=>"Cassava","contextOfUse"=>[],"xref"=>"CO_334:0000066","method"=>{"ontologyReference"=>{"ontologyDbId"=>"186","ontologyName"=>"CO_334","version"=>"","documentationURL"=>{"URL"=>"","type"=>""}},"methodDbId"=>"","description"=>"","class"=>"","formula"=>"","methodName"=>"","name"=>"","reference"=>""},"scale"=>{"name"=>"","dataType"=>"","scaleName"=>"","scaleDbId"=>"","decimalPlaces"=>undef,"xref"=>"","ontologyReference"=>{"ontologyDbId"=>"186","ontologyName"=>"CO_334","version"=>"","documentationURL"=>{"URL"=>"","type"=>""}},"validValues"=>{"max"=>undef,"categories"=>[],"min"=>undef}},"synonyms"=>[],"submissionTimestamp"=>undef}]},"metadata"=>{"pagination"=>{"pageSize"=>10,"currentPage"=>0,"totalCount"=>245,"totalPages"=>25},"status"=>[{"code"=>"info","message"=>"BrAPI base call found with page=0, pageSize=10"},{"message"=>"Loading CXGN::BrAPI::v1::ObservationVariables","code"=>"info"},{"code"=>"200","message"=>"Observationvariable search result constructed"}],"datafiles"=>[]}}, 'variables');

$mech->get_ok('http://localhost:3010/brapi/v1/variables-search?access_token='.$access_token );
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {"metadata"=>{"datafiles"=>[],"pagination"=>{"totalPages"=>25,"totalCount"=>245,"pageSize"=>10,"currentPage"=>0},"status"=>[{"code"=>"info","message"=>"BrAPI base call found with page=0, pageSize=10"},{"code"=>"info","message"=>"Loading CXGN::BrAPI::v1::ObservationVariables"},{"code"=>"200","message"=>"Observationvariable search result constructed"}]},"result"=>{"data"=>[{"trait"=>{"mainAbbreviations"=>"","xref"=>"CO_334:0000047","attribute"=>"abscisic acid content of leaf ug/g","status"=>"","synonyms"=>[],"description"=>"Abscisic acid content of leaf sample.","entity"=>"","alternativeAbbreviations"=>[],"traitDbId"=>"70692","traitName"=>"abscisic acid content of leaf ug/g","name"=>"abscisic acid content of leaf ug/g","class"=>"","ontologyReference"=>{"documentationURL"=>{"type"=>"","URL"=>""},"version"=>"","ontologyDbId"=>"186","ontologyName"=>"CO_334"}},"growthStage"=>"","scientist"=>"","ontologyName"=>"CO_334","xref"=>"CO_334:0000047","observationVariableDbId"=>"abscisic acid content of leaf ug/g|CO_334:0000047","synonyms"=>[],"status"=>JSON::true,"institution"=>"https://breedbase.org","method"=>{"methodName"=>"","ontologyReference"=>{"documentationURL"=>{"type"=>"","URL"=>""},"version"=>"","ontologyDbId"=>"186","ontologyName"=>"CO_334"},"class"=>"","name"=>"","methodDbId"=>"","reference"=>"","description"=>"","formula"=>""},"ontologyDbId"=>"186","observationVariableName"=>"abscisic acid content of leaf ug/g","submissionTimestamp"=>undef,"defaultValue"=>"","crop"=>"Cassava","contextOfUse"=>[],"scale"=>{"dataType"=>"","decimalPlaces"=>undef,"name"=>"","scaleName"=>"","validValues"=>{"min"=>undef,"max"=>undef,"categories"=>[]},"ontologyReference"=>{"documentationURL"=>{"type"=>"","URL"=>""},"version"=>"","ontologyDbId"=>"186","ontologyName"=>"CO_334"},"xref"=>"","scaleDbId"=>""},"name"=>"abscisic acid content of leaf ug/g","ontologyReference"=>{"documentationURL"=>{"type"=>"","URL"=>""},"version"=>"","ontologyDbId"=>"186","ontologyName"=>"CO_334"},"documentationURL"=>"","language"=>""},{"ontologyReference"=>{"version"=>"","documentationURL"=>{"URL"=>"","type"=>""},"ontologyName"=>"CO_334","ontologyDbId"=>"186"},"name"=>"amylopectin content ug/g in percentage","scale"=>{"dataType"=>"","decimalPlaces"=>undef,"scaleName"=>"","name"=>"","validValues"=>{"min"=>undef,"categories"=>[],"max"=>undef},"ontologyReference"=>{"version"=>"","documentationURL"=>{"URL"=>"","type"=>""},"ontologyName"=>"CO_334","ontologyDbId"=>"186"},"xref"=>"","scaleDbId"=>""},"documentationURL"=>"","language"=>"","crop"=>"Cassava","defaultValue"=>"","contextOfUse"=>[],"method"=>{"formula"=>"","description"=>"","methodDbId"=>"","reference"=>"","class"=>"","ontologyReference"=>{"version"=>"","documentationURL"=>{"URL"=>"","type"=>""},"ontologyName"=>"CO_334","ontologyDbId"=>"186"},"name"=>"","methodName"=>""},"ontologyDbId"=>"186","submissionTimestamp"=>undef,"observationVariableName"=>"amylopectin content ug/g in percentage","ontologyName"=>"CO_334","scientist"=>"","trait"=>{"name"=>"amylopectin content ug/g in percentage","class"=>"","ontologyReference"=>{"version"=>"","documentationURL"=>{"URL"=>"","type"=>""},"ontologyName"=>"CO_334","ontologyDbId"=>"186"},"traitName"=>"amylopectin content ug/g in percentage","entity"=>"","alternativeAbbreviations"=>[],"traitDbId"=>"70761","xref"=>"CO_334:0000121","mainAbbreviations"=>"","attribute"=>"amylopectin content ug/g in percentage","synonyms"=>[],"status"=>"","description"=>"Estimation of amylopectin content of cassava roots in percentage(%)."},"growthStage"=>"","status"=>JSON::true,"synonyms"=>[],"institution"=>"https://breedbase.org","xref"=>"CO_334:0000121","observationVariableDbId"=>"amylopectin content ug/g in percentage|CO_334:0000121"},{"scientist"=>"","trait"=>{"traitName"=>"amylose amylopectin root content ratio","name"=>"amylose amylopectin root content ratio","ontologyReference"=>{"documentationURL"=>{"type"=>"","URL"=>""},"version"=>"","ontologyDbId"=>"186","ontologyName"=>"CO_334"},"class"=>"","attribute"=>"amylose amylopectin root content ratio","mainAbbreviations"=>"","xref"=>"CO_334:0000124","status"=>"","synonyms"=>[],"description"=>"The amylose content of a cassava root sample divided by the amylopectin content of the same sample.","alternativeAbbreviations"=>[],"entity"=>"","traitDbId"=>"70752"},"growthStage"=>"","ontologyName"=>"CO_334","observationVariableDbId"=>"amylose amylopectin root content ratio|CO_334:0000124","xref"=>"CO_334:0000124","synonyms"=>[],"status"=>JSON::true,"institution"=>"https://breedbase.org","method"=>{"methodDbId"=>"","reference"=>"","description"=>"","formula"=>"","methodName"=>"","ontologyReference"=>{"documentationURL"=>{"type"=>"","URL"=>""},"version"=>"","ontologyDbId"=>"186","ontologyName"=>"CO_334"},"class"=>"","name"=>""},"ontologyDbId"=>"186","observationVariableName"=>"amylose amylopectin root content ratio","submissionTimestamp"=>undef,"defaultValue"=>"","crop"=>"Cassava","contextOfUse"=>[],"name"=>"amylose amylopectin root content ratio","scale"=>{"validValues"=>{"min"=>undef,"categories"=>[],"max"=>undef},"name"=>"","scaleName"=>"","ontologyReference"=>{"documentationURL"=>{"type"=>"","URL"=>""},"version"=>"","ontologyDbId"=>"186","ontologyName"=>"CO_334"},"dataType"=>"","decimalPlaces"=>undef,"xref"=>"","scaleDbId"=>""},"ontologyReference"=>{"documentationURL"=>{"type"=>"","URL"=>""},"version"=>"","ontologyDbId"=>"186","ontologyName"=>"CO_334"},"documentationURL"=>"","language"=>""},{"documentationURL"=>"","language"=>"","ontologyReference"=>{"documentationURL"=>{"URL"=>"","type"=>""},"version"=>"","ontologyDbId"=>"186","ontologyName"=>"CO_334"},"scale"=>{"scaleDbId"=>"","xref"=>"","ontologyReference"=>{"documentationURL"=>{"URL"=>"","type"=>""},"version"=>"","ontologyDbId"=>"186","ontologyName"=>"CO_334"},"scaleName"=>"","name"=>"","validValues"=>{"categories"=>[],"min"=>undef,"max"=>undef},"dataType"=>"","decimalPlaces"=>undef},"name"=>"amylose content in ug/g percentage","contextOfUse"=>[],"crop"=>"Cassava","defaultValue"=>"","submissionTimestamp"=>undef,"observationVariableName"=>"amylose content in ug/g percentage","method"=>{"formula"=>"","reference"=>"","methodDbId"=>"","description"=>"","name"=>"","ontologyReference"=>{"documentationURL"=>{"URL"=>"","type"=>""},"version"=>"","ontologyDbId"=>"186","ontologyName"=>"CO_334"},"class"=>"","methodName"=>""},"ontologyDbId"=>"186","status"=>JSON::true,"synonyms"=>[],"institution"=>"https://breedbase.org","observationVariableDbId"=>"amylose content in ug/g percentage|CO_334:0000075","xref"=>"CO_334:0000075","ontologyName"=>"CO_334","trait"=>{"traitName"=>"amylose content in ug/g percentage","class"=>"","ontologyReference"=>{"documentationURL"=>{"URL"=>"","type"=>""},"version"=>"","ontologyDbId"=>"186","ontologyName"=>"CO_334"},"name"=>"amylose content in ug/g percentage","description"=>"Estimation of amylose content of cassava roots in percentage (%).","synonyms"=>[],"status"=>"","mainAbbreviations"=>"","xref"=>"CO_334:0000075","attribute"=>"amylose content in ug/g percentage","traitDbId"=>"70676","entity"=>"","alternativeAbbreviations"=>[]},"scientist"=>"","growthStage"=>""},{"status"=>JSON::true,"synonyms"=>[],"institution"=>"https://breedbase.org","xref"=>"CO_334:0000061","observationVariableDbId"=>"anther color|CO_334:0000061","ontologyName"=>"CO_334","scientist"=>"","trait"=>{"class"=>"","ontologyReference"=>{"documentationURL"=>{"type"=>"","URL"=>""},"version"=>"","ontologyDbId"=>"186","ontologyName"=>"CO_334"},"name"=>"anther color","traitName"=>"anther color","traitDbId"=>"70717","entity"=>"","alternativeAbbreviations"=>[],"description"=>"Visual scoring of anther color with 1 = cream, 2 = yellow, and 3 = other.","synonyms"=>[],"status"=>"","xref"=>"CO_334:0000061","mainAbbreviations"=>"","attribute"=>"anther color"},"growthStage"=>"","submissionTimestamp"=>undef,"observationVariableName"=>"anther color","method"=>{"methodName"=>"","class"=>"","ontologyReference"=>{"documentationURL"=>{"type"=>"","URL"=>""},"version"=>"","ontologyDbId"=>"186","ontologyName"=>"CO_334"},"name"=>"","description"=>"","reference"=>"","methodDbId"=>"","formula"=>""},"ontologyDbId"=>"186","contextOfUse"=>[],"crop"=>"Cassava","defaultValue"=>"","language"=>"","documentationURL"=>"","ontologyReference"=>{"documentationURL"=>{"type"=>"","URL"=>""},"version"=>"","ontologyDbId"=>"186","ontologyName"=>"CO_334"},"scale"=>{"xref"=>"","scaleDbId"=>"","decimalPlaces"=>undef,"dataType"=>"","validValues"=>{"max"=>undef,"min"=>undef,"categories"=>[]},"scaleName"=>"","name"=>"","ontologyReference"=>{"documentationURL"=>{"type"=>"","URL"=>""},"version"=>"","ontologyDbId"=>"186","ontologyName"=>"CO_334"}},"name"=>"anther color"},{"xref"=>"CO_334:0000103","observationVariableDbId"=>"anthocyanin pigmentation visual rating 0-3|CO_334:0000103","institution"=>"https://breedbase.org","synonyms"=>[],"status"=>JSON::true,"scientist"=>"","trait"=>{"traitName"=>"anthocyanin pigmentation visual rating 0-3","ontologyReference"=>{"version"=>"","documentationURL"=>{"type"=>"","URL"=>""},"ontologyName"=>"CO_334","ontologyDbId"=>"186"},"class"=>"","name"=>"anthocyanin pigmentation visual rating 0-3","status"=>"","synonyms"=>[],"description"=>"Visual rating of distribution of anthocyanin pigmentation with 0 = absent, 1 = top part, 2 = central part, 3 = totally pigmented.","attribute"=>"anthocyanin pigmentation visual rating 0-3","mainAbbreviations"=>"","xref"=>"CO_334:0000103","traitDbId"=>"70775","alternativeAbbreviations"=>[],"entity"=>""},"growthStage"=>"","ontologyName"=>"CO_334","observationVariableName"=>"anthocyanin pigmentation visual rating 0-3","submissionTimestamp"=>undef,"ontologyDbId"=>"186","method"=>{"reference"=>"","methodDbId"=>"","description"=>"","formula"=>"","methodName"=>"","name"=>"","ontologyReference"=>{"version"=>"","documentationURL"=>{"type"=>"","URL"=>""},"ontologyName"=>"CO_334","ontologyDbId"=>"186"},"class"=>""},"contextOfUse"=>[],"defaultValue"=>"","crop"=>"Cassava","language"=>"","documentationURL"=>"","name"=>"anthocyanin pigmentation visual rating 0-3","scale"=>{"dataType"=>"","decimalPlaces"=>undef,"ontologyReference"=>{"version"=>"","documentationURL"=>{"type"=>"","URL"=>""},"ontologyName"=>"CO_334","ontologyDbId"=>"186"},"validValues"=>{"min"=>undef,"max"=>undef,"categories"=>[]},"scaleName"=>"","name"=>"","scaleDbId"=>"","xref"=>""},"ontologyReference"=>{"version"=>"","documentationURL"=>{"type"=>"","URL"=>""},"ontologyName"=>"CO_334","ontologyDbId"=>"186"}},{"growthStage"=>"","trait"=>{"name"=>"apical branching","ontologyReference"=>{"version"=>"","documentationURL"=>{"type"=>"","URL"=>""},"ontologyName"=>"CO_334","ontologyDbId"=>"186"},"class"=>"","traitName"=>"apical branching","alternativeAbbreviations"=>[],"entity"=>"","traitDbId"=>"70693","attribute"=>"apical branching","xref"=>"CO_334:0000086","mainAbbreviations"=>"","synonyms"=>[],"status"=>"","description"=>"Number of weeks from planting to first apical branching associated with the formation of inflorescence."},"scientist"=>"","ontologyName"=>"CO_334","xref"=>"CO_334:0000086","observationVariableDbId"=>"apical branching|CO_334:0000086","synonyms"=>[],"status"=>JSON::true,"institution"=>"https://breedbase.org","method"=>{"description"=>"","reference"=>"","methodDbId"=>"","formula"=>"","methodName"=>"","name"=>"","class"=>"","ontologyReference"=>{"version"=>"","documentationURL"=>{"type"=>"","URL"=>""},"ontologyName"=>"CO_334","ontologyDbId"=>"186"}},"ontologyDbId"=>"186","observationVariableName"=>"apical branching","submissionTimestamp"=>undef,"defaultValue"=>"","crop"=>"Cassava","contextOfUse"=>[],"name"=>"apical branching","scale"=>{"dataType"=>"","decimalPlaces"=>undef,"ontologyReference"=>{"version"=>"","documentationURL"=>{"type"=>"","URL"=>""},"ontologyName"=>"CO_334","ontologyDbId"=>"186"},"scaleName"=>"","name"=>"","validValues"=>{"categories"=>[],"min"=>undef,"max"=>undef},"scaleDbId"=>"","xref"=>""},"ontologyReference"=>{"version"=>"","documentationURL"=>{"type"=>"","URL"=>""},"ontologyName"=>"CO_334","ontologyDbId"=>"186"},"language"=>"","documentationURL"=>""},{"scale"=>{"dataType"=>"","decimalPlaces"=>undef,"ontologyReference"=>{"version"=>"","documentationURL"=>{"URL"=>"","type"=>""},"ontologyName"=>"CO_334","ontologyDbId"=>"186"},"name"=>"","scaleName"=>"","validValues"=>{"max"=>undef,"min"=>undef,"categories"=>[]},"scaleDbId"=>"","xref"=>""},"name"=>"apical pubescence","ontologyReference"=>{"version"=>"","documentationURL"=>{"URL"=>"","type"=>""},"ontologyName"=>"CO_334","ontologyDbId"=>"186"},"language"=>"","documentationURL"=>"","defaultValue"=>"","crop"=>"Cassava","contextOfUse"=>[],"ontologyDbId"=>"186","method"=>{"methodDbId"=>"","reference"=>"","description"=>"","formula"=>"","methodName"=>"","name"=>"","ontologyReference"=>{"version"=>"","documentationURL"=>{"URL"=>"","type"=>""},"ontologyName"=>"CO_334","ontologyDbId"=>"186"},"class"=>""},"observationVariableName"=>"apical pubescence","submissionTimestamp"=>undef,"growthStage"=>"","trait"=>{"description"=>"Visual rating of young leaf pubescence with 0 = absent or glabrous, 3 = little pubescence, 5 = moderate pubescence, and 7 = high pubescence.","synonyms"=>[],"status"=>"","mainAbbreviations"=>"","xref"=>"CO_334:0000026","attribute"=>"apical pubescence","traitDbId"=>"70743","entity"=>"","alternativeAbbreviations"=>[],"traitName"=>"apical pubescence","class"=>"","ontologyReference"=>{"version"=>"","documentationURL"=>{"URL"=>"","type"=>""},"ontologyName"=>"CO_334","ontologyDbId"=>"186"},"name"=>"apical pubescence"},"scientist"=>"","ontologyName"=>"CO_334","xref"=>"CO_334:0000026","observationVariableDbId"=>"apical pubescence|CO_334:0000026","institution"=>"https://breedbase.org","synonyms"=>[],"status"=>JSON::true},{"ontologyReference"=>{"ontologyName"=>"CO_334","ontologyDbId"=>"186","version"=>"","documentationURL"=>{"type"=>"","URL"=>""}},"name"=>"ascorbic acid in root percentage","scale"=>{"ontologyReference"=>{"ontologyName"=>"CO_334","ontologyDbId"=>"186","version"=>"","documentationURL"=>{"type"=>"","URL"=>""}},"validValues"=>{"min"=>undef,"max"=>undef,"categories"=>[]},"scaleName"=>"","name"=>"","decimalPlaces"=>undef,"dataType"=>"","scaleDbId"=>"","xref"=>""},"documentationURL"=>"","language"=>"","crop"=>"Cassava","defaultValue"=>"","contextOfUse"=>[],"method"=>{"ontologyReference"=>{"ontologyName"=>"CO_334","ontologyDbId"=>"186","version"=>"","documentationURL"=>{"type"=>"","URL"=>""}},"class"=>"","name"=>"","methodName"=>"","formula"=>"","reference"=>"","methodDbId"=>"","description"=>""},"ontologyDbId"=>"186","submissionTimestamp"=>undef,"observationVariableName"=>"ascorbic acid in root percentage","ontologyName"=>"CO_334","growthStage"=>"","trait"=>{"traitDbId"=>"70739","entity"=>"","alternativeAbbreviations"=>[],"synonyms"=>[],"description"=>"Antioxidant and water soluble vitamin of cassava storage root.","status"=>"","mainAbbreviations"=>"","xref"=>"CO_334:0000065","attribute"=>"ascorbic acid in root percentage","class"=>"","ontologyReference"=>{"ontologyName"=>"CO_334","ontologyDbId"=>"186","version"=>"","documentationURL"=>{"type"=>"","URL"=>""}},"name"=>"ascorbic acid in root percentage","traitName"=>"ascorbic acid in root percentage"},"scientist"=>"","synonyms"=>[],"status"=>JSON::true,"institution"=>"https://breedbase.org","observationVariableDbId"=>"ascorbic acid in root percentage|CO_334:0000065","xref"=>"CO_334:0000065"},{"method"=>{"formula"=>"","description"=>"","methodDbId"=>"","reference"=>"","name"=>"","class"=>"","ontologyReference"=>{"ontologyName"=>"CO_334","ontologyDbId"=>"186","version"=>"","documentationURL"=>{"URL"=>"","type"=>""}},"methodName"=>""},"ontologyDbId"=>"186","submissionTimestamp"=>undef,"observationVariableName"=>"ash content in percentage","ontologyName"=>"CO_334","growthStage"=>"","trait"=>{"class"=>"","ontologyReference"=>{"ontologyName"=>"CO_334","ontologyDbId"=>"186","version"=>"","documentationURL"=>{"URL"=>"","type"=>""}},"name"=>"ash content in percentage","traitName"=>"ash content in percentage","traitDbId"=>"70663","entity"=>"","alternativeAbbreviations"=>[],"status"=>"","synonyms"=>[],"description"=>"Residue left behind after all organic matter has been burnt off, a measure of total mineral salts in a food estimated in percentage (%).","xref"=>"CO_334:0000066","mainAbbreviations"=>"","attribute"=>"ash content in percentage"},"scientist"=>"","status"=>JSON::true,"synonyms"=>[],"institution"=>"https://breedbase.org","observationVariableDbId"=>"ash content in percentage|CO_334:0000066","xref"=>"CO_334:0000066","ontologyReference"=>{"ontologyName"=>"CO_334","ontologyDbId"=>"186","version"=>"","documentationURL"=>{"URL"=>"","type"=>""}},"scale"=>{"ontologyReference"=>{"ontologyName"=>"CO_334","ontologyDbId"=>"186","version"=>"","documentationURL"=>{"URL"=>"","type"=>""}},"name"=>"","scaleName"=>"","validValues"=>{"min"=>undef,"max"=>undef,"categories"=>[]},"decimalPlaces"=>undef,"dataType"=>"","scaleDbId"=>"","xref"=>""},"name"=>"ash content in percentage","documentationURL"=>"","language"=>"","crop"=>"Cassava","defaultValue"=>"","contextOfUse"=>[]}]}}, 'variables-search');

$mech->get_ok('http://localhost:3010/brapi/v1/samples-search?access_token='.$access_token );
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'result' => {'data' => []},'metadata' => {'datafiles' => [],'pagination' => {'totalPages' => 0,'pageSize' => 10,'currentPage' => 0,'totalCount' => 0},'status' => [{'message' => 'BrAPI base call found with page=0, pageSize=10','code' => 'info'},{'message' => 'Loading CXGN::BrAPI::v1::Samples','code' => 'info'},{'code' => '200','message' => 'Sample search result constructed'}]}}, 'samples');

done_testing();
