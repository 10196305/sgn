
use strict;
use warnings;

#use lib 't/lib';
#use SGN::Test::Fixture;
use Test::More;
use Test::WWW::Mechanize;

#Needed to update IO::Socket::SSL
use Data::Dumper;
use JSON;
local $Data::Dumper::Indent = 0;

my $mech = Test::WWW::Mechanize->new;
my $response;

$mech->get_ok('http://localhost:3010/brapi/v1/calls');
$response = decode_json $mech->content;
print STDERR Dumper $response;

is_deeply($response, {'result' => {'data' => [{'methods' => ['POST','DELETE'],'call' => 'token','datatypes' => ['json'],'versions' => ['1.0']},{'methods' => ['GET'],'versions' => ['1.0'],'datatypes' => ['json'],'call' => 'calls'},{'methods' => ['GET'],'call' => 'observationlevels','datatypes' => ['json'],'versions' => ['1.0']},{'call' => 'germplasm-search','datatypes' => ['json'],'versions' => ['1.0'],'methods' => ['GET','POST']},{'methods' => ['GET'],'versions' => ['1.0'],'call' => 'germplasm/id','datatypes' => ['json']},{'methods' => ['GET'],'versions' => ['1.0','1.2'],'call' => 'germplasm/id/pedigree','datatypes' => ['json']},{'methods' => ['GET'],'call' => 'germplasm/id/progeny','datatypes' => ['json'],'versions' => ['1.0','1.2']},{'call' => 'germplasm/id/markerprofiles','datatypes' => ['json'],'versions' => ['1.0'],'methods' => ['GET']},{'methods' => ['GET'],'versions' => ['1.0'],'call' => 'germplasm/id/attributes','datatypes' => ['json']},{'call' => 'attributes','datatypes' => ['json'],'versions' => ['1.0'],'methods' => ['GET']},{'datatypes' => ['json'],'call' => 'attributes/categories','versions' => ['1.0'],'methods' => ['GET']},{'methods' => ['GET'],'datatypes' => ['json'],'call' => 'markerprofiles','versions' => ['1.0']},{'methods' => ['GET'],'versions' => ['1.0'],'call' => 'markerprofiles/id','datatypes' => ['json']},{'versions' => ['1.0'],'call' => 'markerprofiles/methods','datatypes' => ['json'],'methods' => ['GET']},{'methods' => ['GET','POST'],'call' => 'allelematrix-search','datatypes' => ['json','tsv','csv','xls'],'versions' => ['1.0']},{'versions' => ['1.0'],'call' => 'programs','datatypes' => ['json'],'methods' => ['GET','POST']},{'versions' => ['1.0'],'call' => 'crops','datatypes' => ['json'],'methods' => ['GET']},{'versions' => ['1.0'],'datatypes' => ['json'],'call' => 'seasons','methods' => ['GET','POST']},{'methods' => ['GET','POST'],'call' => 'studytypes','datatypes' => ['json'],'versions' => ['1.0']},{'datatypes' => ['json'],'call' => 'trials','versions' => ['1.0'],'methods' => ['GET','POST']},{'call' => 'trials/id','datatypes' => ['json'],'versions' => ['1.0'],'methods' => ['GET']},{'versions' => ['1.0'],'call' => 'studies-search','datatypes' => ['json'],'methods' => ['GET','POST']},{'versions' => ['1.0'],'datatypes' => ['json'],'call' => 'studies/id','methods' => ['GET']},{'methods' => ['GET'],'call' => 'studies/id/germplasm','datatypes' => ['json'],'versions' => ['1.0']},{'methods' => ['GET'],'versions' => ['1.0'],'datatypes' => ['json'],'call' => 'studies/id/observationvariables'},{'methods' => ['GET'],'datatypes' => ['json'],'call' => 'studies/id/observationunits','versions' => ['1.0']},{'methods' => ['GET'],'call' => 'studies/id/table','datatypes' => ['json','csv','xls','tsv'],'versions' => ['1.0']},{'call' => 'studies/id/layout','datatypes' => ['json'],'versions' => ['1.0'],'methods' => ['GET']},{'methods' => ['GET'],'versions' => ['1.0'],'datatypes' => ['json'],'call' => 'studies/id/observations'},{'methods' => ['GET','POST'],'versions' => ['1.0'],'call' => 'phenotypes-search','datatypes' => ['json']},{'methods' => ['GET','POST'],'datatypes' => ['json'],'call' => 'phenotypes-search/table','versions' => ['1.0']},{'methods' => ['GET','POST'],'versions' => ['1.0'],'call' => 'phenotypes-search/tsv','datatypes' => ['json']},{'versions' => ['1.0'],'datatypes' => ['json'],'call' => 'phenotypes-search/csv','methods' => ['GET','POST']},{'versions' => ['1.0'],'call' => 'traits','datatypes' => ['json'],'methods' => ['GET']},{'versions' => ['1.0'],'call' => 'traits/id','datatypes' => ['json'],'methods' => ['GET']},{'methods' => ['GET'],'versions' => ['1.0'],'datatypes' => ['json'],'call' => 'maps'},{'versions' => ['1.0'],'call' => 'maps/id','datatypes' => ['json'],'methods' => ['GET']},{'methods' => ['GET'],'datatypes' => ['json'],'call' => 'maps/id/positions','versions' => ['1.0']},{'versions' => ['1.0'],'datatypes' => ['json'],'call' => 'maps/id/positions/id','methods' => ['GET']},{'methods' => ['GET'],'datatypes' => ['json'],'call' => 'locations','versions' => ['1.0']},{'methods' => ['GET'],'datatypes' => ['json'],'call' => 'variables/datatypes','versions' => ['1.0']},{'methods' => ['GET'],'datatypes' => ['json'],'call' => 'ontologies','versions' => ['1.0']},{'versions' => ['1.0'],'call' => 'variables','datatypes' => ['json'],'methods' => ['GET']},{'datatypes' => ['json'],'call' => 'variables/id','versions' => ['1.0'],'methods' => ['GET']},{'methods' => ['GET','POST'],'call' => 'variables-search','datatypes' => ['json'],'versions' => ['1.0']},{'methods' => ['GET','POST'],'versions' => ['1.0'],'datatypes' => ['json'],'call' => 'samples-search'},{'methods' => ['GET'],'versions' => ['1.0'],'datatypes' => ['json'],'call' => 'samples/id'}]},'metadata' => {'datafiles' => [],'status' => [{'info' => 'BrAPI base call found with page=0, pageSize=10'},{'info' => 'Loading CXGN::BrAPI::v1::Calls'},{'success' => 'Calls result constructed'}],'pagination' => {'currentPage' => 0,'totalPages' => 1,'pageSize' => 1000,'totalCount' => 47}}}, 'check calls response content');

$mech->get_ok('http://localhost:3010/brapi/v1/calls?pageSize=50&datatype=tsv');
$response = decode_json $mech->content;
print STDERR Dumper $response;

is_deeply($response, {'result' => {'data' => [{'methods' => ['GET','POST'],'call' => 'allelematrices-search','datatypes' => ['json','tsv','csv','xls']},{'methods' => ['GET'],'datatypes' => ['json','csv','xls','tsv'],'call' => 'studies/id/table'}]},'metadata' => {'datafiles' => [],'status' => [{'info' => 'BrAPI base call found with page=0, pageSize=50'},{'info' => 'Loading CXGN::BrAPI::v1::Calls'},{'success' => 'Calls result constructed'}],'pagination' => {'totalPages' => 1,'pageSize' => 50,'totalCount' => 2,'currentPage' => 0}}}, 'check calls response content');

$mech->post_ok('http://localhost:3010/brapi/v1/token', [ "username"=> "janedoe", "password"=> "secretpw", "grant_type"=> "password" ]);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is($response->{'metadata'}->{'status'}->[2]->{'success'}, 'Login Successfull');
is($response->{'userDisplayName'}, 'Jane Doe');
is($response->{'expires_in'}, '7200');

$mech->delete_ok('http://localhost:3010/brapi/v1/token');
$response = decode_json $mech->content;
print STDERR Dumper $response;
is($response->{'metadata'}->{'status'}->[2]->{'success'}, 'User Logged Out');

$mech->post_ok('http://localhost:3010/brapi/v1/token', [ "username"=> "janedoe", "password"=> "secretpw", "grant_type"=> "password" ]);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is($response->{'metadata'}->{'status'}->[2]->{'success'}, 'Login Successfull');
is($response->{'userDisplayName'}, 'Jane Doe');
is($response->{'expires_in'}, '7200');
my $access_token = $response->{access_token};

$mech->get_ok('http://localhost:3010/brapi/v1/observationlevels');
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'result' => {'data' => ['plant','plot','tissue_sample','all']},'metadata' => {'status' => [{'info' => 'BrAPI base call found with page=0, pageSize=10'},{'info' => 'Loading CXGN::BrAPI::v1::ObservationVariables'},{'success' => 'Observation Levels result constructed'}],'pagination' => {'totalCount' => 4,'pageSize' => 10,'currentPage' => 0,'totalPages' => 1},'datafiles' => []}}, 'observationlevels');

$mech->get_ok('http://localhost:3010/brapi/v1/germplasm-search?pageSize=2&page=3&access_token='.$access_token);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'result' => {'data' => [{'countryOfOriginCode' => '','biologicalStatusOfAccessionCode' => '','donors' => [],'genus' => 'Lycopersicon','germplasmPUI' => '','speciesAuthority' => '','instituteName' => '','subtaxa' => '','germplasmName' => 'new_test_crossP002','accessionNumber' => '','defaultDisplayName' => 'new_test_crossP002','germplasmSeedSource' => '','instituteCode' => '','acquisitionDate' => '','typeOfGermplasmStorageCode' => [],'subtaxaAuthority' => '','germplasmDbId' => 38847,'commonCropName' => 'tomato','species' => 'Solanum lycopersicum','synonyms' => [],'pedigree' => 'test_accession4/test_accession5','taxonIds' => []},{'defaultDisplayName' => 'new_test_crossP003','accessionNumber' => '','subtaxa' => '','germplasmName' => 'new_test_crossP003','speciesAuthority' => '','germplasmPUI' => '','instituteName' => '','countryOfOriginCode' => '','biologicalStatusOfAccessionCode' => '','donors' => [],'genus' => 'Lycopersicon','synonyms' => [],'pedigree' => 'test_accession4/test_accession5','taxonIds' => [],'species' => 'Solanum lycopersicum','subtaxaAuthority' => '','germplasmDbId' => 38848,'commonCropName' => 'tomato','germplasmSeedSource' => '','instituteCode' => '','acquisitionDate' => '','typeOfGermplasmStorageCode' => []}]},'metadata' => {'datafiles' => [],'status' => [{'info' => 'BrAPI base call found with page=3, pageSize=2'},{'info' => 'Loading CXGN::BrAPI::v1::Germplasm'},{'success' => 'Germplasm-search result constructed'}],'pagination' => {'totalPages' => 240,'currentPage' => 3,'totalCount' => 479,'pageSize' => 2}}}, 'germplasm-search');

$mech->get_ok('http://localhost:3010/brapi/v1/germplasm-search?pageSize=2&page=5&access_token='.$access_token);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'metadata' => {'pagination' => {'currentPage' => 5,'pageSize' => 2,'totalCount' => 479,'totalPages' => 240},'datafiles' => [],'status' => [{'info' => 'BrAPI base call found with page=5, pageSize=2'},{'info' => 'Loading CXGN::BrAPI::v1::Germplasm'},{'success' => 'Germplasm-search result constructed'}]},'result' => {'data' => [{'subtaxa' => '','germplasmName' => 'new_test_crossP006','defaultDisplayName' => 'new_test_crossP006','accessionNumber' => '','countryOfOriginCode' => '','genus' => 'Lycopersicon','donors' => [],'biologicalStatusOfAccessionCode' => '','speciesAuthority' => '','germplasmPUI' => '','instituteName' => '','species' => 'Solanum lycopersicum','pedigree' => 'test_accession4/test_accession5','synonyms' => [],'taxonIds' => [],'germplasmSeedSource' => '','typeOfGermplasmStorageCode' => [],'instituteCode' => '','acquisitionDate' => '','germplasmDbId' => 38851,'subtaxaAuthority' => '','commonCropName' => 'tomato'},{'genus' => 'Lycopersicon','donors' => [],'biologicalStatusOfAccessionCode' => '','countryOfOriginCode' => '','instituteName' => '','germplasmPUI' => '','speciesAuthority' => '','germplasmName' => 'new_test_crossP007','subtaxa' => '','accessionNumber' => '','defaultDisplayName' => 'new_test_crossP007','typeOfGermplasmStorageCode' => [],'instituteCode' => '','acquisitionDate' => '','germplasmSeedSource' => '','commonCropName' => 'tomato','germplasmDbId' => 38852,'subtaxaAuthority' => '','species' => 'Solanum lycopersicum','taxonIds' => [],'synonyms' => [],'pedigree' => 'test_accession4/test_accession5'}]}}, 'germplasm-search');

$mech->get_ok('http://localhost:3010/brapi/v1/germplasm-search?pageSize=2&page=0&germplasmDbId=38849&access_token='.$access_token);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'metadata' => {'pagination' => {'totalPages' => 1,'currentPage' => 0,'totalCount' => 1,'pageSize' => 2},'status' => [{'info' => 'BrAPI base call found with page=0, pageSize=2'},{'info' => 'Loading CXGN::BrAPI::v1::Germplasm'},{'success' => 'Germplasm-search result constructed'}],'datafiles' => []},'result' => {'data' => [{'species' => 'Solanum lycopersicum','pedigree' => 'test_accession4/test_accession5','synonyms' => [],'taxonIds' => [],'germplasmSeedSource' => '','typeOfGermplasmStorageCode' => [],'acquisitionDate' => '','instituteCode' => '','germplasmDbId' => 38849,'subtaxaAuthority' => '','commonCropName' => 'tomato','subtaxa' => '','germplasmName' => 'new_test_crossP004','accessionNumber' => '','defaultDisplayName' => 'new_test_crossP004','countryOfOriginCode' => '','genus' => 'Lycopersicon','donors' => [],'biologicalStatusOfAccessionCode' => '','speciesAuthority' => '','germplasmPUI' => '','instituteName' => ''}]}}, 'germplasm-search');

$mech->get_ok('http://localhost:3010/brapi/v1/germplasm-search?pageSize=2&page=4&germplasmName=te%&matchMethod=wildcard&access_token='.$access_token);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'result' => {'data' => [{'countryOfOriginCode' => '','biologicalStatusOfAccessionCode' => '','donors' => [],'genus' => 'Lycopersicon','germplasmPUI' => '','speciesAuthority' => '','instituteName' => '','subtaxa' => '','germplasmName' => 'new_test_crossP009','accessionNumber' => '','defaultDisplayName' => 'new_test_crossP009','germplasmSeedSource' => '','instituteCode' => '','acquisitionDate' => '','typeOfGermplasmStorageCode' => [],'subtaxaAuthority' => '','germplasmDbId' => 38854,'commonCropName' => 'tomato','species' => 'Solanum lycopersicum','pedigree' => 'test_accession4/test_accession5','synonyms' => [],'taxonIds' => []},{'subtaxa' => '','germplasmName' => 'new_test_crossP010','accessionNumber' => '','defaultDisplayName' => 'new_test_crossP010','countryOfOriginCode' => '','genus' => 'Lycopersicon','donors' => [],'biologicalStatusOfAccessionCode' => '','speciesAuthority' => '','germplasmPUI' => '','instituteName' => '','species' => 'Solanum lycopersicum','synonyms' => [],'pedigree' => 'test_accession4/test_accession5','taxonIds' => [],'germplasmSeedSource' => '','typeOfGermplasmStorageCode' => [],'acquisitionDate' => '','instituteCode' => '','germplasmDbId' => 38855,'subtaxaAuthority' => '','commonCropName' => 'tomato'}]},'metadata' => {'pagination' => {'totalCount' => 25,'pageSize' => 2,'currentPage' => 4,'totalPages' => 13},'status' => [{'info' => 'BrAPI base call found with page=4, pageSize=2'},{'info' => 'Loading CXGN::BrAPI::v1::Germplasm'},{'success' => 'Germplasm-search result constructed'}],'datafiles' => []}}, 'germplasm-search');

$mech->post_ok('http://localhost:3010/brapi/v1/germplasm-search?access_token='.$access_token, ['pageSize'=>'1', 'page'=>'5', 'germplasmName'=>'t%', 'matchMethod'=>'wildcard'] );
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'result' => {'data' => [{'commonCropName' => 'tomato','subtaxaAuthority' => '','germplasmDbId' => 38847,'acquisitionDate' => '','instituteCode' => '','typeOfGermplasmStorageCode' => [],'germplasmSeedSource' => '','taxonIds' => [],'synonyms' => [],'pedigree' => 'test_accession4/test_accession5','species' => 'Solanum lycopersicum','instituteName' => '','speciesAuthority' => '','germplasmPUI' => '','biologicalStatusOfAccessionCode' => '','donors' => [],'genus' => 'Lycopersicon','countryOfOriginCode' => '','defaultDisplayName' => 'new_test_crossP002','accessionNumber' => '','germplasmName' => 'new_test_crossP002','subtaxa' => ''}]},'metadata' => {'datafiles' => [],'status' => [{'info' => 'BrAPI base call found with page=5, pageSize=1'},{'info' => 'Loading CXGN::BrAPI::v1::Germplasm'},{'success' => 'Germplasm-search result constructed'}],'pagination' => {'totalPages' => 31,'totalCount' => 31,'pageSize' => 1,'currentPage' => 5}}}, 'germplasm-search post');

$mech->get_ok('http://localhost:3010/brapi/v1/germplasm/38876?access_token='.$access_token);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'metadata' => {'status' => [{'info' => 'BrAPI base call found with page=0, pageSize=10'},{'info' => 'Loading CXGN::BrAPI::v1::Germplasm'},{'success' => 'Germplasm detail result constructed'}],'datafiles' => [],'pagination' => {'totalPages' => 1,'currentPage' => 0,'totalCount' => 1,'pageSize' => 1}},'result' => {'synonyms' => [],'pedigree' => 'test_accession4/test_accession5','taxonIds' => [],'species' => 'Solanum lycopersicum','germplasmDbId' => 38876,'subtaxaAuthority' => '','commonCropName' => 'tomato','germplasmSeedSource' => '','typeOfGermplasmStorageCode' => [],'acquisitionDate' => '','instituteCode' => '','accessionNumber' => '','defaultDisplayName' => 'test5P004','subtaxa' => '','germplasmName' => 'test5P004','speciesAuthority' => '','germplasmPUI' => '','instituteName' => '','countryOfOriginCode' => '','genus' => 'Lycopersicon','donors' => [],'biologicalStatusOfAccessionCode' => ''}}, 'germplasm detail');

$mech->get_ok('http://localhost:3010/brapi/v1/germplasm/38876/pedigree?access_token='.$access_token);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'metadata' => {'status' => [{'info' => 'BrAPI base call found with page=0, pageSize=10'},{'info' => 'Loading CXGN::BrAPI::v1::Germplasm'},{'success' => 'Germplasm pedigree result constructed'}],'datafiles' => [],'pagination' => {'totalPages' => 1,'currentPage' => 0,'totalCount' => 1,'pageSize' => 1}},'result' => {'familyCode' => '','pedigree' => 'test_accession4/test_accession5','siblings' => [{'defaultDisplayName' => 'new_test_crossP001','germplasmDbId' => 38846},{'germplasmDbId' => 38847,'defaultDisplayName' => 'new_test_crossP002'},{'defaultDisplayName' => 'new_test_crossP003','germplasmDbId' => 38848},{'defaultDisplayName' => 'new_test_crossP004','germplasmDbId' => 38849},{'germplasmDbId' => 38850,'defaultDisplayName' => 'new_test_crossP005'},{'germplasmDbId' => 38851,'defaultDisplayName' => 'new_test_crossP006'},{'germplasmDbId' => 38852,'defaultDisplayName' => 'new_test_crossP007'},{'defaultDisplayName' => 'new_test_crossP008','germplasmDbId' => 38853},{'defaultDisplayName' => 'new_test_crossP009','germplasmDbId' => 38854},{'defaultDisplayName' => 'new_test_crossP010','germplasmDbId' => 38855},{'germplasmDbId' => 38873,'defaultDisplayName' => 'test5P001'},{'defaultDisplayName' => 'test5P002','germplasmDbId' => 38874},{'defaultDisplayName' => 'test5P003','germplasmDbId' => 38875},{'defaultDisplayName' => 'test5P005','germplasmDbId' => 38877}],'parent1Name' => 'test_accession4','parent1Type' => 'FEMALE','defaultDisplayName' => 'test5P004','germplasmDbId' => '38876','parent2DbId' => 38844,'parent2Name' => 'test_accession5','parent1DbId' => 38843,'parent2Id' => 38844,'parent1Id' => 38843,'parent2Type' => 'MALE','crossingPlan' => '','crossingYear' => ''}}, 'germplasm pedigree');

$mech->get_ok('http://localhost:3010/brapi/v1/germplasm/38843/progeny?access_token='.$access_token);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'metadata' => {'datafiles' => [],'pagination' => {'currentPage' => 0,'totalPages' => 2,'totalCount' => 15,'pageSize' => 10},'status' => [{'info' => 'BrAPI base call found with page=0, pageSize=10'},{'info' => 'Loading CXGN::BrAPI::v1::Germplasm'},{'success' => 'Germplasm progeny result constructed'}]},'result' => {'defaultDisplayName' => 'test_accession4','germplasmDbId' => '38843','data' => [{'parentType' => 'FEMALE','progenyGermplasmDbId' => 38846},{'parentType' => 'FEMALE','progenyGermplasmDbId' => 38847},{'progenyGermplasmDbId' => 38848,'parentType' => 'FEMALE'},{'progenyGermplasmDbId' => 38849,'parentType' => 'FEMALE'},{'progenyGermplasmDbId' => 38850,'parentType' => 'FEMALE'},{'parentType' => 'FEMALE','progenyGermplasmDbId' => 38851},{'parentType' => 'FEMALE','progenyGermplasmDbId' => 38852},{'parentType' => 'FEMALE','progenyGermplasmDbId' => 38853},{'progenyGermplasmDbId' => 38854,'parentType' => 'FEMALE'},{'progenyGermplasmDbId' => 38855,'parentType' => 'FEMALE'}]}}, 'germplasm progeny');

$mech->get_ok('http://localhost:3010/brapi/v1/germplasm/38937/markerprofiles?access_token='.$access_token);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'result' => {'germplasmDbId' => '38937','markerProfiles' => [1622,1934]},'metadata' => {'pagination' => {'totalCount' => 2,'pageSize' => 10,'currentPage' => 0,'totalPages' => 1},'datafiles' => [],'status' => [{'info' => 'BrAPI base call found with page=0, pageSize=10'},{'info' => 'Loading CXGN::BrAPI::v1::Germplasm'},{'success' => 'Germplasm markerprofiles result constructed'}]}}, 'germplasm markerprofile');

$mech->get_ok('http://localhost:3010/brapi/v1/markerprofiles?pageSize=2&page=3&access_token='.$access_token);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'metadata' => {'status' => [{'info' => 'BrAPI base call found with page=3, pageSize=2'},{'info' => 'Loading CXGN::BrAPI::v1::Markerprofiles'},{'success' => 'Markerprofiles-search result constructed'}],'pagination' => {'currentPage' => 3,'totalPages' => 1,'totalCount' => 2,'pageSize' => 2},'datafiles' => []},'result' => {'data' => [{'extractDbId' => 'UG120178|78266','uniqueDisplayName' => 'UG120178|78266','germplasmDbId' => 39027,'resultCount' => 500,'sampleDbId' => 'UG120178|78266','markerProfileDbId' => 1628,'analysisMethod' => 'GBS ApeKI genotyping v4'},{'analysisMethod' => 'GBS ApeKI genotyping v4','sampleDbId' => 'UG120179|78267','markerProfileDbId' => 1629,'germplasmDbId' => 39028,'resultCount' => 500,'extractDbId' => 'UG120179|78267','uniqueDisplayName' => 'UG120179|78267'}]}}, 'markerprofile');

$mech->get_ok('http://localhost:3010/brapi/v1/markerprofiles?pageSize=1&page=1&germplasmDbId=38937&access_token='.$access_token);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'result' => {'data' => [{'sampleDbId' => 'UG120066|79802','markerProfileDbId' => 1934,'analysisMethod' => 'GBS ApeKI genotyping v4','resultCount' => 500,'germplasmDbId' => 38937,'uniqueDisplayName' => 'UG120066|79802','extractDbId' => 'UG120066|79802'}]},'metadata' => {'pagination' => {'pageSize' => 1,'totalPages' => 1,'totalCount' => 1,'currentPage' => 1},'status' => [{'info' => 'BrAPI base call found with page=1, pageSize=1'},{'info' => 'Loading CXGN::BrAPI::v1::Markerprofiles'},{'success' => 'Markerprofiles-search result constructed'}],'datafiles' => []}}, 'markerprofile');

$mech->get_ok('http://localhost:3010/brapi/v1/markerprofiles?pageSize=2&page=3&methodDbId=1&access_token='.$access_token);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'result' => {'data' => [{'markerProfileDbId' => 1628,'sampleDbId' => 'UG120178|78266','analysisMethod' => 'GBS ApeKI genotyping v4','uniqueDisplayName' => 'UG120178|78266','extractDbId' => 'UG120178|78266','resultCount' => 500,'germplasmDbId' => 39027},{'markerProfileDbId' => 1629,'analysisMethod' => 'GBS ApeKI genotyping v4','sampleDbId' => 'UG120179|78267','uniqueDisplayName' => 'UG120179|78267','extractDbId' => 'UG120179|78267','germplasmDbId' => 39028,'resultCount' => 500}]},'metadata' => {'pagination' => {'totalCount' => 2,'totalPages' => 1,'currentPage' => 3,'pageSize' => 2},'status' => [{'info' => 'BrAPI base call found with page=3, pageSize=2'},{'info' => 'Loading CXGN::BrAPI::v1::Markerprofiles'},{'success' => 'Markerprofiles-search result constructed'}],'datafiles' => []}}, 'markerprofile');

$mech->get_ok('http://localhost:3010/brapi/v1/markerprofiles/1627?access_token='.$access_token);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'result' => {'uniqueDisplayName' => 'UG120156','data' => [{'S5_36739' => 'BB'},{'S13_92567' => 'BB'},{'S69_57277' => 'BB'},{'S80_224901' => 'AA'},{'S80_232173' => 'BB'},{'S80_265728' => 'AA'},{'S97_219243' => 'AB'},{'S224_309814' => 'BB'},{'S248_174244' => 'BB'},{'S318_245078' => 'AA'},{'S325_476494' => 'AA'},{'S341_311907' => 'BB'},{'S341_745165' => 'BB'},{'S341_927602' => 'BB'},{'S435_153155' => 'AA'},{'S620_130205' => 'BB'},{'S784_76866' => 'BB'},{'S821_289681' => 'AB'},{'S823_109683' => 'AA'},{'S823_119622' => 'BB'},{'S832_39811' => 'AA'},{'S847_188168' => 'BB'},{'S847_1315798' => 'AB'},{'S847_1804912' => 'AA'},{'S847_2403992' => 'BB'},{'S935_45975' => 'AB'},{'S940_150103' => 'AA'},{'S952_150314' => 'BB'},{'S999_310366' => 'AA'},{'S1027_465354' => 'BB'},{'S1046_216535' => 'BB'},{'S1127_16826' => 'BB'},{'S1441_60654' => 'AA'},{'S1551_652731' => 'BB'},{'S1551_712371' => 'BB'},{'S1551_1108196' => 'BB'},{'S1551_1252422' => 'AA'},{'S1551_1483219' => 'AA'},{'S1551_1622871' => 'BB'},{'S1551_1838719' => 'BB'},{'S1551_2906760' => 'AA'},{'S1551_2925283' => 'AA'},{'S1551_3200002' => 'BB'},{'S1551_3239448' => 'BB'},{'S1551_3366575' => 'AA'},{'S1551_3722622' => 'BB'},{'S1624_164812' => 'BB'},{'S1701_727586' => 'BB'},{'S1828_8899' => 'AA'},{'S1842_18522' => 'AA'},{'S1934_97870' => 'BB'},{'S1945_591357' => 'BB'},{'S1945_666842' => 'AA'},{'S2080_103510' => 'BB'},{'S2080_165181' => 'AA'},{'S2264_241725' => 'AA'},{'S2295_15627' => 'BB'},{'S2421_322288' => 'BB'},{'S2421_401501' => 'BB'},{'S2421_1140337' => 'AB'},{'S2431_166818' => 'BB'},{'S2431_391893' => 'AA'},{'S2436_67341' => 'BB'},{'S2477_162755' => 'AA'},{'S2477_323725' => 'AA'},{'S2477_406510' => 'AA'},{'S2538_42936' => 'AA'},{'S2538_411592' => 'AA'},{'S2572_310038' => 'AA'},{'S2572_338710' => 'BB'},{'S2658_486557' => 'BB'},{'S2658_601679' => 'BB'},{'S2658_679751' => 'BB'},{'S2688_335617' => 'BB'},{'S2817_91598' => 'AA'},{'S2817_245804' => 'BB'},{'S2853_503599' => 'AB'},{'S2892_478987' => 'AB'},{'S2895_111794' => 'BB'},{'S2912_229140' => 'BB'},{'S2915_246230' => 'BB'},{'S2915_247882' => 'AA'},{'S2915_338070' => 'BB'},{'S2932_69572' => 'BB'},{'S2936_101466' => 'AB'},{'S2943_243361' => 'AA'},{'S2943_739571' => 'BB'},{'S2959_122486' => 'AA'},{'S2960_262567' => 'AA'},{'S2960_406907' => 'BB'},{'S2960_544575' => 'BB'},{'S2960_642939' => 'BB'},{'S2975_103241' => 'AA'},{'S3000_214855' => 'BB'},{'S3000_300696' => 'AA'},{'S3049_211198' => 'BB'},{'S3049_609125' => 'AA'},{'S3049_747203' => 'BB'},{'S3049_987925' => 'BB'},{'S3115_41451' => 'BB'},{'S3115_135611' => 'BB'},{'S3115_156392' => 'AB'},{'S3115_240349' => 'BB'},{'S3130_128901' => 'AA'},{'S3150_262120' => 'AA'},{'S3150_319271' => 'BB'},{'S3150_505410' => 'BB'},{'S3186_44615' => 'AB'},{'S3235_140317' => 'BB'},{'S3237_271879' => 'BB'},{'S3241_181474' => 'BB'},{'S3241_314241' => 'AA'},{'S3241_355591' => 'AA'},{'S3245_85163' => 'BB'},{'S3264_99474' => 'BB'},{'S3264_149094' => 'BB'},{'S3264_464491' => 'AA'},{'S3264_734293' => 'AB'},{'S3264_774153' => 'AA'},{'S3329_32933' => 'AA'},{'S3332_613796' => 'AA'},{'S3332_808673' => 'AB'},{'S3332_1040319' => 'AA'},{'S3333_300006' => 'AA'},{'S3333_321757' => 'BB'},{'S3378_380126' => 'AA'},{'S3402_49570' => 'BB'},{'S3484_40231' => 'AA'},{'S3542_507815' => 'AA'},{'S3581_377460' => 'BB'},{'S3581_431736' => 'AB'},{'S3581_773436' => 'AB'},{'S3581_1333049' => 'AB'},{'S3581_1431971' => 'AB'},{'S3602_597743' => 'BB'},{'S3604_370570' => 'BB'},{'S3604_430194' => 'BB'},{'S3604_1044096' => 'BB'},{'S3614_10643' => 'BB'},{'S3614_529844' => 'AA'},{'S3614_868194' => 'BB'},{'S3614_1817341' => 'BB'},{'S3614_2789312' => 'AA'},{'S3614_3881800' => 'BB'},{'S3651_300950' => 'BB'},{'S3651_443200' => 'BB'},{'S3718_276118' => 'AA'},{'S3735_394293' => 'BB'},{'S3736_59970' => 'AA'},{'S3736_123338' => 'AA'},{'S3741_151581' => 'AA'},{'S3741_387303' => 'AA'},{'S3741_440684' => 'AA'},{'S3741_508439' => 'AA'},{'S3741_937767' => 'AA'},{'S3741_987743' => 'BB'},{'S3750_584997' => 'BB'},{'S3750_654240' => 'BB'},{'S3750_668529' => 'BB'},{'S3750_1088142' => 'AA'},{'S3750_1090019' => 'BB'},{'S3754_7252' => 'BB'},{'S3787_76554' => 'AA'},{'S3802_796806' => 'BB'},{'S3846_12968' => 'BB'},{'S3859_212947' => 'BB'},{'S3975_237757' => 'BB'},{'S3975_252778' => 'BB'},{'S4043_373081' => 'BB'},{'S4043_959955' => 'BB'},{'S4043_1147239' => 'BB'},{'S4043_1370276' => 'BB'},{'S4056_140993' => 'AB'},{'S4065_150573' => 'BB'},{'S4065_263245' => 'BB'},{'S4065_271143' => 'AA'},{'S4080_8045' => 'AA'},{'S4083_456173' => 'AA'},{'S4083_489335' => 'BB'},{'S4151_408968' => 'BB'},{'S4165_382338' => 'AA'},{'S4175_365840' => 'AB'},{'S4175_515602' => 'BB'},{'S4175_567563' => 'BB'},{'S4175_686615' => 'BB'},{'S4209_210894' => 'BB'},{'S4209_755236' => 'AA'},{'S4251_304804' => 'BB'},{'S4269_27179' => 'BB'},{'S4269_52542' => 'AB'},{'S4274_140837' => 'AA'},{'S4274_177473' => 'BB'},{'S4285_227555' => 'AB'},{'S4305_131355' => 'AA'},{'S4439_28513' => 'BB'},{'S4450_193257' => 'BB'},{'S4457_297856' => 'BB'},{'S4457_462709' => 'AA'},{'S4457_1097015' => 'BB'},{'S4457_1300393' => 'BB'},{'S4489_189071' => 'AA'},{'S4681_262496' => 'BB'},{'S4681_593453' => 'AA'},{'S4851_601229' => 'AA'},{'S4882_161352' => 'BB'},{'S4882_470222' => 'BB'},{'S5005_46565' => 'AA'},{'S5019_47183' => 'AB'},{'S5162_212284' => 'BB'},{'S5219_79565' => 'BB'},{'S5280_446764' => 'AA'},{'S5280_564518' => 'AA'},{'S5335_402068' => 'BB'},{'S5335_417949' => 'BB'},{'S5375_53450' => 'BB'},{'S5375_132818' => 'BB'},{'S5459_69682' => 'AA'},{'S5848_77293' => 'BB'},{'S5859_652772' => 'BB'},{'S5865_159403' => 'AA'},{'S5875_130394' => 'AA'},{'S5875_342195' => 'AA'},{'S5875_654914' => 'AA'},{'S5916_58666' => 'BB'},{'S5977_101347' => 'BB'},{'S5979_296753' => 'BB'},{'S6028_67175' => 'BB'},{'S6089_24864' => 'AB'},{'S6089_509226' => 'AA'},{'S6137_47666' => 'BB'},{'S6155_5121' => 'AA'},{'S6206_155413' => 'BB'},{'S6278_558480' => 'AA'},{'S6278_610459' => 'AA'},{'S6278_650925' => 'BB'},{'S6278_732960' => 'AA'},{'S6407_232902' => 'AA'},{'S6446_121660' => 'AA'},{'S6512_104772' => 'BB'},{'S6512_575155' => 'BB'},{'S6512_1743766' => 'AA'},{'S6512_2254100' => 'BB'},{'S6550_52292' => 'BB'},{'S6550_324831' => 'BB'},{'S6550_503577' => 'AB'},{'S6598_300948' => 'AB'},{'S6598_454335' => 'AA'},{'S6609_375938' => 'BB'},{'S6609_419187' => 'AA'},{'S6611_35506' => 'AA'},{'S6611_103757' => 'AA'},{'S6629_942' => 'AA'},{'S6631_66971' => 'BB'},{'S6656_80205' => 'BB'},{'S6656_133278' => 'BB'},{'S6656_309064' => 'BB'},{'S6656_803304' => 'BB'},{'S6701_438755' => 'BB'},{'S6705_400094' => 'BB'},{'S6707_77683' => 'AB'},{'S6707_146411' => 'BB'},{'S6761_25246' => 'AB'},{'S6775_95179' => 'BB'},{'S6814_93934' => 'BB'},{'S6814_392390' => 'AB'},{'S6814_646247' => 'BB'},{'S6816_60873' => 'AA'},{'S6825_286368' => 'AA'},{'S6825_291677' => 'AA'},{'S6825_348051' => 'BB'},{'S6850_23519' => 'AA'},{'S6853_107002' => 'AA'},{'S6877_11081' => 'BB'},{'S6908_174548' => 'BB'},{'S6908_232376' => 'BB'},{'S6908_237833' => 'AA'},{'S6914_477062' => 'BB'},{'S6914_917023' => 'BB'},{'S6914_1376609' => 'AB'},{'S6916_343692' => 'BB'},{'S6916_898371' => 'BB'},{'S6916_1130850' => 'AA'},{'S6916_1173117' => 'BB'},{'S6916_1522636' => 'BB'},{'S6980_52703' => 'AB'},{'S7012_411405' => 'AA'},{'S7012_666222' => 'AA'},{'S7012_1050824' => 'BB'},{'S7012_12891891' => 'BB'},{'S7035_17812' => 'AA'},{'S7035_107575' => 'BB'},{'S7035_336332' => 'AA'},{'S7041_105481' => 'BB'},{'S7069_330799' => 'AA'},{'S7069_339027' => 'BB'},{'S7088_73067' => 'AA'},{'S7107_65000' => 'AA'},{'S7292_69' => 'AB'},{'S7351_123029' => 'BB'},{'S7444_119272' => 'AA'},{'S7463_71588' => 'AA'},{'S7478_325486' => 'BB'},{'S7488_50987' => 'BB'},{'S7519_562902' => 'AA'},{'S7520_393434' => 'AA'},{'S7520_639628' => 'BB'},{'S7520_657920' => 'BB'},{'S7520_730357' => 'BB'},{'S7520_1438963' => 'AA'},{'S7520_1890285' => 'BB'},{'S7520_1896478' => 'BB'},{'S7520_2302096' => 'BB'},{'S7520_2326151' => 'BB'},{'S7520_2562868' => 'BB'},{'S7520_2804544' => 'BB'},{'S7543_258314' => 'BB'},{'S7571_117345' => 'BB'},{'S7571_291382' => 'AA'},{'S7571_626158' => 'BB'},{'S7571_657127' => 'BB'},{'S7591_141290' => 'BB'},{'S7660_98872' => 'BB'},{'S7762_171787' => 'AB'},{'S7762_244113' => 'BB'},{'S7861_4499' => 'AA'},{'S7991_19945' => 'BB'},{'S7996_258208' => 'BB'},{'S8003_188563' => 'BB'},{'S8004_147325' => 'BB'},{'S8122_306261' => 'BB'},{'S8151_113577' => 'BB'},{'S8167_142287' => 'AA'},{'S8245_22275' => 'AA'},{'S8265_125202' => 'AA'},{'S8265_252356' => 'BB'},{'S8265_382843' => 'BB'},{'S8265_404788' => 'AA'},{'S8265_1262361' => 'BB'},{'S8265_1563741' => 'AA'},{'S8265_1788254' => 'BB'},{'S8265_2172104' => 'BB'},{'S8265_2750819' => 'BB'},{'S8265_3146272' => 'BB'},{'S8265_3178182' => 'AB'},{'S8265_4827922' => 'AA'},{'S8265_6168752' => 'BB'},{'S8265_13857522' => 'AA'},{'S8265_22544562' => 'BB'},{'S8265_24005142' => 'BB'},{'S8265_28094061' => 'BB'},{'S8265_29680101' => 'AA'},{'S8265_32288641' => 'AA'},{'S8265_36795792' => 'BB'},{'S8265_42380592' => 'AB'},{'S8265_44371882' => 'BB'},{'S8314_33002' => 'AA'},{'S8316_61524' => 'AA'},{'S8316_64051' => 'AA'},{'S8316_828081' => 'BB'},{'S8359_287419' => 'AA'},{'S8359_781759' => 'AB'},{'S8359_1561375' => 'BB'},{'S8359_1689389' => 'BB'},{'S8359_1752715' => 'BB'},{'S8473_17888' => 'AA'},{'S8473_23707' => 'BB'},{'S8473_154142' => 'BB'},{'S8494_164649' => 'BB'},{'S8542_178809' => 'AB'},{'S8542_302774' => 'AB'},{'S8593_56062' => 'BB'},{'S8617_19507' => 'BB'},{'S8673_46833' => 'BB'},{'S8673_48171' => 'BB'},{'S8686_843269' => 'AA'},{'S8686_1074871' => 'AB'},{'S8686_5839121' => 'AA'},{'S8686_7615221' => 'BB'},{'S8686_7793511' => 'AA'},{'S8757_543709' => 'AB'},{'S8799_611047' => 'AA'},{'S8799_699207' => 'AA'},{'S8828_26701' => 'AA'},{'S8847_267195' => 'AB'},{'S8860_12876' => 'BB'},{'S8873_203398' => 'BB'},{'S8994_202519' => 'AA'},{'S9000_187825' => 'BB'},{'S9013_98478' => 'AB'},{'S9035_226' => 'BB'},{'S9120_441308' => 'AB'},{'S9120_466058' => 'AB'},{'S9231_115745' => 'AA'},{'S9260_85990' => 'BB'},{'S9324_41069' => 'BB'},{'S9360_88379' => 'BB'},{'S9365_148585' => 'BB'},{'S9410_23080' => 'BB'},{'S9414_6599' => 'AA'},{'S9460_85039' => 'BB'},{'S9460_91231' => 'BB'},{'S9492_223801' => 'BB'},{'S9501_521580' => 'AA'},{'S9692_230167' => 'BB'},{'S9702_205063' => 'BB'},{'S9761_459530' => 'AB'},{'S9788_66332' => 'AB'},{'S9788_453634' => 'AA'},{'S9876_584512' => 'AB'},{'S10114_185859' => 'AA'},{'S10173_777651' => 'BB'},{'S10173_899514' => 'BB'},{'S10241_146006' => 'AA'},{'S10367_21679' => 'BB'},{'S10493_191533' => 'BB'},{'S10493_282956' => 'AA'},{'S10493_529025' => 'BB'},{'S10551_41284' => 'BB'},{'S10551_44996' => 'AA'},{'S10551_96591' => 'BB'},{'S10563_6640' => 'AA'},{'S10563_110710' => 'BB'},{'S10563_458792' => 'AA'},{'S10563_535346' => 'AB'},{'S10563_996687' => 'AA'},{'S10689_537521' => 'BB'},{'S10689_585587' => 'AA'},{'S10780_25444' => 'AB'},{'S10797_134409' => 'AA'},{'S10797_244349' => 'AB'},{'S10963_781226' => 'AA'},{'S11106_78443' => 'AB'},{'S11179_10653' => 'AA'},{'S11179_231468' => 'BB'},{'S11267_108022' => 'BB'},{'S11279_135336' => 'BB'},{'S11297_160003' => 'AA'},{'S11297_430854' => 'AA'},{'S11297_587571' => 'AA'},{'S11297_591849' => 'AA'},{'S11341_175970' => 'BB'},{'S11341_582872' => 'AA'},{'S11378_324775' => 'AA'},{'S11388_132103' => 'BB'},{'S11495_150387' => 'BB'},{'S11495_272492' => 'BB'},{'S11495_580938' => 'AB'},{'S11581_567114' => 'AB'},{'S11581_902331' => 'AB'},{'S11584_97726' => 'BB'},{'S11661_221624' => 'AA'},{'S11661_255071' => 'BB'},{'S11689_120997' => 'BB'},{'S11689_232183' => 'BB'},{'S11689_416021' => 'AA'},{'S11821_196927' => 'BB'},{'S11874_29482' => 'AA'},{'S11897_254957' => 'AB'},{'S11998_475883' => 'BB'},{'S11998_632212' => 'BB'},{'S11998_795409' => 'AB'},{'S11998_912093' => 'BB'},{'S12004_39799' => 'AB'},{'S12004_43792' => 'AA'},{'S12004_315885' => 'BB'},{'S12004_526993' => 'AA'},{'S12091_54588' => 'BB'},{'S12211_104742' => 'AA'},{'S12211_157511' => 'BB'},{'S12262_123295' => 'AA'},{'S12262_166442' => 'BB'},{'S12262_295534' => 'BB'},{'S12279_48910' => 'BB'},{'S12414_138577' => 'BB'},{'S12439_186389' => 'BB'},{'S12455_245618' => 'AA'},{'S12455_488938' => 'AA'},{'S12455_550518' => 'AA'},{'S12498_209195' => 'BB'},{'S12525_579339' => 'BB'},{'S12525_581929' => 'BB'},{'S12525_872745' => 'BB'},{'S12529_29862' => 'BB'},{'S12542_14293' => 'BB'},{'S12686_58507' => 'BB'},{'S12728_11449' => 'AA'},{'S12753_445856' => 'AA'},{'S12759_185633' => 'BB'},{'S12794_742415' => 'BB'},{'S12794_1396029' => 'BB'},{'S12794_1408925' => 'AA'},{'S12794_1417026' => 'BB'},{'S12794_1615271' => 'AA'},{'S12794_1671144' => 'AB'},{'S12794_1740426' => 'BB'},{'S12794_1825180' => 'BB'},{'S12794_1954311' => 'BB'},{'S12794_2162836' => 'BB'},{'S12865_649906' => 'BB'},{'S12946_101555' => 'BB'}],'analysisMethod' => 'GBS ApeKI genotyping v4','germplasmDbId' => 39007,'extractDbId' => 'UG120156|78265','markerprofileDbId' => '1627'},'metadata' => {'status' => [{'info' => 'BrAPI base call found with page=0, pageSize=10'},{'info' => 'Loading CXGN::BrAPI::v1::Markerprofiles'},{'success' => 'Markerprofiles detail result constructed'}],'datafiles' => [],'pagination' => undef}}, 'markerprofile');

$mech->post_ok('http://localhost:3010/brapi/v1/allelematrices-search?access_token='.$access_token, ['markerprofileDbId'=>[1626,1627], 'format'=>'json'] );
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'metadata' => {'datafiles' => [],'status' => [{'info' => 'BrAPI base call found with page=0, pageSize=10'},{'info' => 'Loading CXGN::BrAPI::v1::Markerprofiles'},{'success' => 'Markerprofiles allelematrix result constructed'}],'pagination' => {'totalCount' => 1000,'currentPage' => 0,'pageSize' => 10,'totalPages' => 100}},'result' => {'data' => [['S10114_185859',1626,'BB'],['S10173_777651',1626,'BB'],['S10173_899514',1626,'BB'],['S10241_146006',1626,'AA'],['S1027_465354',1626,'AA'],['S10367_21679',1626,'AA'],['S1046_216535',1626,'AB'],['S10493_191533',1626,'BB'],['S10493_282956',1626,'AB']]}}, 'allelematrices-search');

$mech->get_ok('http://localhost:3010/brapi/v1/programs?access_token='.$access_token );
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'result' => {'data' => [{'name' => 'test','objective' => 'test','programDbId' => 134,'commonCropName' => 'Cassava','leadPerson' => '','abbreviation' => ''}]},'metadata' => {'datafiles' => [],'status' => [{'info' => 'BrAPI base call found with page=0, pageSize=10'},{'info' => 'Loading CXGN::BrAPI::v1::Programs'},{'success' => 'Program list result constructed'}],'pagination' => {'totalCount' => 1,'pageSize' => 10,'currentPage' => 0,'totalPages' => 1}}}, 'programs');

$mech->get_ok('http://localhost:3010/brapi/v1/crops?access_token='.$access_token );
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'metadata' => {'status' => [{'info' => 'BrAPI base call found with page=0, pageSize=10'},{'info' => 'Loading CXGN::BrAPI::v1::Crops'},{'success' => 'Crops result constructed'}],'datafiles' => [],'pagination' => {'totalCount' => 1,'currentPage' => 0,'pageSize' => 10,'totalPages' => 1}},'result' => {'data' => ['Cassava']}}, 'crops');

$mech->get_ok('http://localhost:3010/brapi/v1/seasons?access_token='.$access_token );
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'result' => {'data' => [{'year' => '2014','season' => undef,'seasonsDbId' => 145},{'seasonsDbId' => 147,'year' => '2015','season' => undef},{'seasonsDbId' => 151,'season' => undef,'year' => '2016'},{'season' => undef,'year' => '2017','seasonsDbId' => 174}]},'metadata' => {'status' => [{'info' => 'BrAPI base call found with page=0, pageSize=10'},{'info' => 'Loading CXGN::BrAPI::v1::Studies'},{'success' => 'Seasons list result constructed'}],'pagination' => {'currentPage' => 0,'totalPages' => 1,'pageSize' => 10,'totalCount' => 4},'datafiles' => []}}, 'seasons');

$mech->get_ok('http://localhost:3010/brapi/v1/studyTypes?access_token='.$access_token );
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'metadata' => {'datafiles' => [],'status' => [{'info' => 'BrAPI base call found with page=0, pageSize=10'},{'info' => 'Loading CXGN::BrAPI::v1::Studies'},{'success' => 'StudyTypes list result constructed'}],'pagination' => {'pageSize' => 10,'totalCount' => 17,'currentPage' => 0,'totalPages' => 2}},'result' => {'data' => [{'name' => 'Seedling Nursery','description' => 'seedling'},{'description' => 'phenotyping_trial','name' => 'phenotyping_trial'},{'name' => 'genotyping_trial','description' => 'genotyping_trial'},{'name' => 'Advanced Yield Trial','description' => undef},{'name' => 'Preliminary Yield Trial','description' => undef},{'name' => 'Uniform Yield Trial','description' => undef},{'description' => undef,'name' => 'Variety Release Trial'},{'name' => 'Clonal Evaluation','description' => undef},{'name' => 'genetic_gain_trial','description' => undef},{'name' => 'storage_trial','description' => undef}]}}, 'studyTypes');

$mech->get_ok('http://localhost:3010/brapi/v1/studytypes?pageSize=2&page=2&access_token='.$access_token);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'result' => {'data' => [{'name' => 'Preliminary Yield Trial','description' => undef},{'name' => 'Uniform Yield Trial','description' => undef}]},'metadata' => {'status' => [{'info' => 'BrAPI base call found with page=2, pageSize=2'},{'info' => 'Loading CXGN::BrAPI::v1::Studies'},{'success' => 'StudyTypes list result constructed'}],'datafiles' => [],'pagination' => {'currentPage' => 2,'totalCount' => 17,'pageSize' => 2,'totalPages' => 9}}}, 'studyTypes');

# $mech->get_ok('http://localhost:3010/brapi/v1/trials?pageSize=2&page=0&access_token='.$access_token);
# $response = decode_json $mech->content;
# print STDERR Dumper $response;
# is_deeply($response, {}, 'trials');

$mech->post_ok('http://localhost:3010/brapi/v1/studies-search?pageSize=2&page=3&access_token='.$access_token );
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'result' => {'data' => [{'trialName' => undef,'locationName' => 'test_location','studyType' => undef,'locationDbId' => '23','active' => '','startDate' => undef,'additionalInfo' => {'design' => 'CRD','description' => 'test tets'},'endDate' => undef,'programDbId' => 134,'studyDbId' => 144,'programName' => 'test','studyName' => 'test_t','trialDbId' => undef,'seasons' => ['2016']},{'programDbId' => 134,'endDate' => '2017-July-04','studyDbId' => 137,'locationName' => 'test_location','trialName' => undef,'additionalInfo' => {'design' => 'CRD','description' => 'test trial'},'startDate' => '2017-July-21','active' => '','locationDbId' => '23','studyType' => undef,'seasons' => ['2014'],'trialDbId' => undef,'studyName' => 'test_trial','programName' => 'test'}]},'metadata' => {'status' => [{'info' => 'BrAPI base call found with page=3, pageSize=2'},{'info' => 'Loading CXGN::BrAPI::v1::Studies'},{'success' => 'Studies-search result constructed'}],'pagination' => {'currentPage' => 3,'totalCount' => 9,'totalPages' => 5,'pageSize' => 2},'datafiles' => []}}, 'studies-search');

$mech->post_ok('http://localhost:3010/brapi/v1/studies-search?pageSize=2&page=0&studyLocations=test_location&access_token='.$access_token );
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'result' => {'data' => [{'studyType' => 'Preliminary Yield Trial','locationDbId' => '23','endDate' => undef,'active' => '','locationName' => 'test_location','startDate' => undef,'programDbId' => 134,'studyDbId' => 165,'trialDbId' => undef,'trialName' => undef,'additionalInfo' => {'description' => 'Copy of trial with postcomposed phenotypes from cassbase.','design' => 'RCBD'},'seasons' => ['2017'],'programName' => 'test','studyName' => 'CASS_6Genotypes_Sampling_2015'},{'active' => '','locationName' => 'test_location','endDate' => undef,'studyType' => 'Clonal Evaluation','locationDbId' => '23','trialName' => undef,'additionalInfo' => {'description' => 'This trial was loaded into the fixture to test solgs.','design' => 'Alpha'},'studyName' => 'Kasese solgs trial','programName' => 'test','seasons' => ['2014'],'programDbId' => 134,'startDate' => undef,'trialDbId' => undef,'studyDbId' => 139}]},'metadata' => {'pagination' => {'pageSize' => 2,'totalPages' => 5,'currentPage' => 0,'totalCount' => 9},'datafiles' => [],'status' => [{'info' => 'BrAPI base call found with page=0, pageSize=2'},{'info' => 'Loading CXGN::BrAPI::v1::Studies'},{'success' => 'Studies-search result constructed'}]}}, 'studies-search');

$mech->post_ok('http://localhost:3010/brapi/v1/studies-search?pageSize=2&page=0&locationName=test_location&studyType=Clonal%20Evaluation&access_token='.$access_token );
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'result' => {'data' => [{'trialName' => undef,'additionalInfo' => {'description' => 'This trial was loaded into the fixture to test solgs.','design' => 'Alpha'},'studyDbId' => 139,'startDate' => undef,'studyType' => 'Clonal Evaluation','seasons' => ['2014'],'active' => '','trialDbId' => undef,'programDbId' => 134,'studyName' => 'Kasese solgs trial','locationDbId' => '23','locationName' => 'test_location','programName' => 'test','endDate' => undef}]},'metadata' => {'status' => [{'info' => 'BrAPI base call found with page=0, pageSize=2'},{'info' => 'Loading CXGN::BrAPI::v1::Studies'},{'success' => 'Studies-search result constructed'}],'datafiles' => [],'pagination' => {'totalPages' => 1,'currentPage' => 0,'pageSize' => 2,'totalCount' => 1}}}, 'studies-search');

$mech->post_ok('http://localhost:3010/brapi/v1/studies-search?pageSize=2&page=0&programName=test&access_token='.$access_token );
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'metadata' => {'status' => [{'info' => 'BrAPI base call found with page=0, pageSize=2'},{'info' => 'Loading CXGN::BrAPI::v1::Studies'},{'success' => 'Studies-search result constructed'}],'datafiles' => [],'pagination' => {'totalCount' => 6,'totalPages' => 3,'pageSize' => 2,'currentPage' => 0}},'result' => {'data' => [{'programDbId' => 134,'startDate' => undef,'trialDbId' => undef,'studyDbId' => 165,'trialName' => undef,'additionalInfo' => {'design' => 'RCBD','description' => 'Copy of trial with postcomposed phenotypes from cassbase.'},'studyName' => 'CASS_6Genotypes_Sampling_2015','programName' => 'test','seasons' => ['2017'],'endDate' => undef,'locationDbId' => '23','studyType' => 'Preliminary Yield Trial','active' => '','locationName' => 'test_location'},{'endDate' => undef,'studyType' => 'Clonal Evaluation','locationDbId' => '23','active' => '','locationName' => 'test_location','programDbId' => 134,'startDate' => undef,'trialDbId' => undef,'studyDbId' => 139,'trialName' => undef,'additionalInfo' => {'design' => 'Alpha','description' => 'This trial was loaded into the fixture to test solgs.'},'programName' => 'test','studyName' => 'Kasese solgs trial','seasons' => ['2014']}]}}, 'studies-search');

$mech->get_ok('http://localhost:3010/brapi/v1/studies/139?access_token='.$access_token);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'metadata' => {'status' => [{'info' => 'BrAPI base call found with page=0, pageSize=10'},{'info' => 'Loading CXGN::BrAPI::v1::Studies'},{'success' => 'Studies detail result constructed'}],'pagination' => {'totalPages' => 1,'currentPage' => 0,'pageSize' => 10,'totalCount' => 1},'datafiles' => []},'result' => {'studyType' => 'Clonal Evaluation','location' => {'abbreviation' => '','countryCode' => 'USA','longitude' => '-115.864','latitude' => '32.6136','additionalInfo' => {'breeding_program' => '134','geodetic datum' => undef},'locationDbId' => 23,'name' => 'test_location','countryName' => 'United States','altitude' => '109','locationType' => ''},'contacts' => undef,'trialDbId' => 134,'studyName' => 'Kasese solgs trial','additionalInfo' => {},'programDbId' => 134,'studyDbId' => '139','locationName' => 'test_location','startDate' => '','locationDbId' => '23','active' => '','trialName' => 'test','endDate' => '','programName' => 'test','seasons' => ['2014']}}, 'study details');

$mech->get_ok('http://localhost:3010/brapi/v1/studies/139/germplasm?access_token='.$access_token);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'metadata' => {'datafiles' => [],'status' => [{'info' => 'BrAPI base call found with page=0, pageSize=10'},{'info' => 'Loading CXGN::BrAPI::v1::Studies'},{'success' => 'Studies-germplasm result constructed'}],'pagination' => {'totalCount' => 374,'totalPages' => 38,'currentPage' => 0,'pageSize' => 10}},'result' => {'studyDbId' => '139','data' => [{'seedSource' => '','entryNumber' => '','germplasmPUI' => '','germplasmName' => 'UG120001','germplasmDbId' => 38878,'synonyms' => [],'pedigree' => '','accessionNumber' => ''},{'pedigree' => '','accessionNumber' => '','synonyms' => [],'germplasmDbId' => 38879,'germplasmName' => 'UG120002','germplasmPUI' => '','entryNumber' => '','seedSource' => ''},{'synonyms' => [],'germplasmDbId' => 38880,'accessionNumber' => '','pedigree' => '','entryNumber' => '','seedSource' => '','germplasmPUI' => '','germplasmName' => 'UG120003'},{'germplasmName' => 'UG120004','seedSource' => '','entryNumber' => '','germplasmPUI' => '','accessionNumber' => '','pedigree' => '','synonyms' => [],'germplasmDbId' => 38881},{'germplasmPUI' => '','seedSource' => '','entryNumber' => '','germplasmName' => 'UG120005','germplasmDbId' => 38882,'synonyms' => [],'pedigree' => '','accessionNumber' => ''},{'accessionNumber' => '','pedigree' => '','germplasmDbId' => 38883,'synonyms' => [],'germplasmName' => 'UG120006','seedSource' => '','entryNumber' => '','germplasmPUI' => ''},{'germplasmPUI' => '','seedSource' => '','entryNumber' => '','germplasmName' => 'UG120007','germplasmDbId' => 38884,'synonyms' => [],'pedigree' => '','accessionNumber' => ''},{'germplasmDbId' => 38885,'synonyms' => [],'accessionNumber' => '','pedigree' => '','germplasmPUI' => '','entryNumber' => '','seedSource' => '','germplasmName' => 'UG120008'},{'accessionNumber' => '','pedigree' => '','germplasmDbId' => 38886,'synonyms' => [],'germplasmName' => 'UG120009','entryNumber' => '','seedSource' => '','germplasmPUI' => ''},{'germplasmName' => 'UG120010','seedSource' => '','entryNumber' => '','germplasmPUI' => '','accessionNumber' => '','pedigree' => '','synonyms' => [],'germplasmDbId' => 38887}],'studyName' => 'Kasese solgs trial'}}, 'study germplasm');

$mech->get_ok('http://localhost:3010/brapi/v1/studies/165/observationvariables?access_token='.$access_token);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'metadata' => {'datafiles' => [],'pagination' => {'totalCount' => 12,'pageSize' => 10,'totalPages' => 2,'currentPage' => 0},'status' => [{'info' => 'BrAPI base call found with page=0, pageSize=10'},{'info' => 'Loading CXGN::BrAPI::v1::Studies'},{'success' => 'Studies observation variables result constructed'}]},'result' => {'studyDbId' => '165','data' => [{'name' => 'cass sink leaf|3-phosphoglyceric acid|ug/g|week 16|COMP:0000013','observationVariableDbId' => 77559,'method' => {},'xref' => 'COMP:0000013','trait' => {'name' => 'cass sink leaf|3-phosphoglyceric acid|ug/g|week 16','traitDbId' => 77559,'description' => undef},'ontologyDbId' => 305,'defaultValue' => '','scale' => {'scaleDbId' => '','datatype' => '','xref' => '','validValues' => {'max' => '','min' => '','categories' => []},'name' => '','decimalPlaces' => ''},'ontologyName' => 'COMP'},{'defaultValue' => '','ontologyName' => 'COMP','scale' => {'name' => '','decimalPlaces' => '','scaleDbId' => '','datatype' => '','xref' => '','validValues' => {'max' => '','min' => '','categories' => []}},'name' => 'cass sink leaf|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000011','observationVariableDbId' => 77557,'xref' => 'COMP:0000011','method' => {},'trait' => {'description' => undef,'name' => 'cass sink leaf|ADP alpha-D-glucoside|ug/g|week 16','traitDbId' => 77557},'ontologyDbId' => 305},{'method' => {},'xref' => 'COMP:0000010','trait' => {'traitDbId' => 77556,'name' => 'cass sink leaf|ADP|ug/g|week 16','description' => undef},'ontologyDbId' => 305,'name' => 'cass sink leaf|ADP|ug/g|week 16|COMP:0000010','observationVariableDbId' => 77556,'scale' => {'validValues' => {'categories' => [],'min' => '','max' => ''},'xref' => '','datatype' => '','scaleDbId' => '','decimalPlaces' => '','name' => ''},'ontologyName' => 'COMP','defaultValue' => ''},{'defaultValue' => '','ontologyName' => 'COMP','scale' => {'xref' => '','validValues' => {'max' => '','min' => '','categories' => []},'scaleDbId' => '','datatype' => '','name' => '','decimalPlaces' => ''},'name' => 'cass source leaf|3-phosphoglyceric acid|ug/g|week 16|COMP:0000002','observationVariableDbId' => 77548,'ontologyDbId' => 305,'xref' => 'COMP:0000002','method' => {},'trait' => {'traitDbId' => 77548,'name' => 'cass source leaf|3-phosphoglyceric acid|ug/g|week 16','description' => undef}},{'scale' => {'decimalPlaces' => '','name' => '','datatype' => '','scaleDbId' => '','validValues' => {'max' => '','min' => '','categories' => []},'xref' => ''},'ontologyName' => 'COMP','defaultValue' => '','ontologyDbId' => 305,'method' => {},'xref' => 'COMP:0000007','trait' => {'name' => 'cass source leaf|ADP alpha-D-glucoside|ug/g|week 16','traitDbId' => 77553,'description' => undef},'observationVariableDbId' => 77553,'name' => 'cass source leaf|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000007'},{'defaultValue' => '','ontologyName' => 'COMP','scale' => {'validValues' => {'min' => '','max' => '','categories' => []},'xref' => '','datatype' => '','scaleDbId' => '','decimalPlaces' => '','name' => ''},'name' => 'cass source leaf|ADP|ug/g|week 16|COMP:0000003','observationVariableDbId' => 77549,'ontologyDbId' => 305,'xref' => 'COMP:0000003','method' => {},'trait' => {'traitDbId' => 77549,'name' => 'cass source leaf|ADP|ug/g|week 16','description' => undef}},{'ontologyDbId' => 305,'method' => {},'xref' => 'COMP:0000006','trait' => {'description' => undef,'traitDbId' => 77552,'name' => 'cass storage root|3-phosphoglyceric acid|ug/g|week 16'},'observationVariableDbId' => 77552,'name' => 'cass storage root|3-phosphoglyceric acid|ug/g|week 16|COMP:0000006','scale' => {'xref' => '','validValues' => {'categories' => [],'max' => '','min' => ''},'scaleDbId' => '','datatype' => '','name' => '','decimalPlaces' => ''},'ontologyName' => 'COMP','defaultValue' => ''},{'ontologyDbId' => 305,'xref' => 'COMP:0000004','method' => {},'trait' => {'name' => 'cass storage root|ADP alpha-D-glucoside|ug/g|week 16','traitDbId' => 77550,'description' => undef},'observationVariableDbId' => 77550,'name' => 'cass storage root|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000004','scale' => {'xref' => '','validValues' => {'min' => '','max' => '','categories' => []},'scaleDbId' => '','datatype' => '','name' => '','decimalPlaces' => ''},'ontologyName' => 'COMP','defaultValue' => ''},{'name' => 'cass storage root|ADP|ug/g|week 16|COMP:0000005','observationVariableDbId' => 77551,'ontologyDbId' => 305,'trait' => {'description' => undef,'name' => 'cass storage root|ADP|ug/g|week 16','traitDbId' => 77551},'xref' => 'COMP:0000005','method' => {},'defaultValue' => '','scale' => {'name' => '','decimalPlaces' => '','xref' => '','validValues' => {'categories' => [],'min' => '','max' => ''},'scaleDbId' => '','datatype' => ''},'ontologyName' => 'COMP'},{'ontologyName' => 'COMP','scale' => {'name' => '','decimalPlaces' => '','scaleDbId' => '','datatype' => '','xref' => '','validValues' => {'max' => '','min' => '','categories' => []}},'defaultValue' => '','trait' => {'name' => 'cass upper stem|3-phosphoglyceric acid|ug/g|week 16','traitDbId' => 77558,'description' => undef},'method' => {},'xref' => 'COMP:0000012','ontologyDbId' => 305,'observationVariableDbId' => 77558,'name' => 'cass upper stem|3-phosphoglyceric acid|ug/g|week 16|COMP:0000012'}]}}, 'study variables');

$mech->get_ok('http://localhost:3010/brapi/v1/studies/165/observationunits?access_token='.$access_token);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'result' => {'data' => [{'germplasmName' => 'IITA-TMS-IBA980581','Y' => '','observationUnitDbId' => 41284,'X' => '','plantNumber' => '','observations' => [{'observationTimeStamp' => 'NA2017-04-21_21:11:28','observationDbId' => 740347,'observationVariableName' => 'cass upper stem|ADP|ug/g|week 16|COMP:0000009','value' => '379.16','collector' => 'johndoe','observationVariableDbId' => 77555}],'replicate' => '1','pedigree' => 'NA/NA','plotNumber' => '103','germplasmDbId' => 41283,'observationUnitName' => 'CASS_6Genotypes_103','blockNumber' => '1','entryNumber' => '','entryType' => 'Test'},{'blockNumber' => '2','entryNumber' => '','entryType' => 'Test','observationUnitName' => 'CASS_6Genotypes_205','germplasmDbId' => 41281,'plotNumber' => '205','pedigree' => 'NA/NA','replicate' => '1','observations' => [{'observationDbId' => 740433,'value' => '61.2228','observationVariableName' => 'cass sink leaf|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000011','observationVariableDbId' => 77557,'collector' => 'johndoe','observationTimeStamp' => 'NA2017-04-21_21:11:28'}],'plantNumber' => '','X' => '','observationUnitDbId' => 41285,'Y' => '','germplasmName' => 'IITA-TMS-IBA011412'},{'observationUnitName' => 'CASS_6Genotypes_206','blockNumber' => '2','entryNumber' => '','entryType' => 'Test','germplasmDbId' => 41279,'plantNumber' => '','replicate' => '1','observations' => [{'observationDbId' => 740448,'value' => '28.1402','observationVariableName' => 'cass source leaf|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000007','observationVariableDbId' => 77553,'collector' => 'johndoe','observationTimeStamp' => 'NA2017-04-21_21:11:28'}],'pedigree' => 'NA/NA','plotNumber' => '206','germplasmName' => 'IITA-TMS-IBA30572','Y' => '','observationUnitDbId' => 41286,'X' => ''},{'entryType' => 'Test','blockNumber' => '1','entryNumber' => '','observationUnitName' => 'CASS_6Genotypes_104','germplasmDbId' => 41282,'pedigree' => 'NA/NA','plotNumber' => '104','observations' => [{'observationTimeStamp' => 'NA2017-04-21_21:11:28','collector' => 'johndoe','observationVariableDbId' => 77555,'value' => '341.041','observationVariableName' => 'cass upper stem|ADP|ug/g|week 16|COMP:0000009','observationDbId' => 740359}],'replicate' => '1','plantNumber' => '','X' => '','observationUnitDbId' => 41295,'Y' => '','germplasmName' => 'IITA-TMS-IBA980002'},{'observationUnitName' => 'CASS_6Genotypes_105','blockNumber' => '1','entryNumber' => '','entryType' => 'Test','germplasmDbId' => 41279,'observations' => [{'value' => '662.087','observationVariableName' => 'cass sink leaf|3-phosphoglyceric acid|ug/g|week 16|COMP:0000013','observationVariableDbId' => 77559,'collector' => 'johndoe','observationDbId' => 740360,'observationTimeStamp' => 'NA2017-04-21_21:11:28'}],'replicate' => '1','plotNumber' => '105','pedigree' => 'NA/NA','plantNumber' => '','X' => '','germplasmName' => 'IITA-TMS-IBA30572','Y' => '','observationUnitDbId' => 41296},{'X' => '','observationUnitDbId' => 41297,'germplasmName' => 'IITA-TMS-IBA011412','Y' => '','plotNumber' => '106','pedigree' => 'NA/NA','replicate' => '1','observations' => [{'observationTimeStamp' => 'NA2017-04-21_21:11:28','observationVariableDbId' => 77555,'collector' => 'johndoe','value' => '469.818','observationVariableName' => 'cass upper stem|ADP|ug/g|week 16|COMP:0000009','observationDbId' => 740383}],'plantNumber' => '','germplasmDbId' => 41281,'entryNumber' => '','blockNumber' => '1','entryType' => 'Test','observationUnitName' => 'CASS_6Genotypes_106'},{'germplasmDbId' => 41280,'observationUnitName' => 'CASS_6Genotypes_107','entryNumber' => '','blockNumber' => '1','entryType' => 'Test','X' => '','germplasmName' => 'TMEB693','Y' => '','observationUnitDbId' => 41298,'replicate' => '1','observations' => [{'observationTimeStamp' => 'NA2017-04-21_21:11:28','observationVariableName' => 'cass upper stem|ADP|ug/g|week 16|COMP:0000009','value' => '423.355','observationVariableDbId' => 77555,'collector' => 'johndoe','observationDbId' => 740395}],'pedigree' => 'NA/NA','plotNumber' => '107','plantNumber' => ''},{'plantNumber' => '','pedigree' => 'NA/NA','plotNumber' => '202','replicate' => '1','observations' => [{'observationDbId' => 740407,'observationVariableDbId' => 77555,'collector' => 'johndoe','observationVariableName' => 'cass upper stem|ADP|ug/g|week 16|COMP:0000009','value' => '241.418','observationTimeStamp' => 'NA2017-04-21_21:11:28'}],'observationUnitDbId' => 41300,'germplasmName' => 'TMEB693','Y' => '','X' => '','blockNumber' => '2','entryType' => 'Test','entryNumber' => '','observationUnitName' => 'CASS_6Genotypes_202','germplasmDbId' => 41280},{'observationUnitName' => 'CASS_6Genotypes_203','entryNumber' => '','blockNumber' => '2','entryType' => 'Test','germplasmDbId' => 41282,'observations' => [{'observationTimeStamp' => 'NA2017-04-21_21:11:28','value' => '303.323','observationVariableName' => 'cass upper stem|ADP|ug/g|week 16|COMP:0000009','collector' => 'johndoe','observationVariableDbId' => 77555,'observationDbId' => 740419}],'replicate' => '1','pedigree' => 'NA/NA','plotNumber' => '203','plantNumber' => '','X' => '','germplasmName' => 'IITA-TMS-IBA980002','Y' => '','observationUnitDbId' => 41301},{'germplasmDbId' => 41283,'observationUnitName' => 'CASS_6Genotypes_204','entryNumber' => '','blockNumber' => '2','entryType' => 'Test','X' => '','germplasmName' => 'IITA-TMS-IBA980581','Y' => '','observationUnitDbId' => 41302,'observations' => [{'observationDbId' => 740431,'observationVariableName' => 'cass upper stem|ADP|ug/g|week 16|COMP:0000009','value' => '849.946','collector' => 'johndoe','observationVariableDbId' => 77555,'observationTimeStamp' => 'NA2017-04-21_21:11:28'}],'replicate' => '1','pedigree' => 'NA/NA','plotNumber' => '204','plantNumber' => ''}]},'metadata' => {'pagination' => {'totalPages' => 2,'currentPage' => 0,'pageSize' => 10,'totalCount' => 17},'datafiles' => [],'status' => [{'info' => 'BrAPI base call found with page=0, pageSize=10'},{'info' => 'Loading CXGN::BrAPI::v1::Studies'},{'success' => 'Studies observations result constructed'}]}}, 'study observation units');

$mech->get_ok('http://localhost:3010/brapi/v1/studies/165/table?access_token='.$access_token);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'metadata' => {'status' => [{'info' => 'BrAPI base call found with page=0, pageSize=10'},{'info' => 'Loading CXGN::BrAPI::v1::Studies'},{'success' => 'Studies observations table result constructed'}],'pagination' => {'currentPage' => 0,'totalPages' => 2,'pageSize' => 10,'totalCount' => 17},'datafiles' => []},'result' => {'observationVariableNames' => ['cass sink leaf|3-phosphoglyceric acid|ug/g|week 16|COMP:0000013','cass sink leaf|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000011','cass sink leaf|ADP|ug/g|week 16|COMP:0000010','cass source leaf|3-phosphoglyceric acid|ug/g|week 16|COMP:0000002','cass source leaf|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000007','cass source leaf|ADP|ug/g|week 16|COMP:0000003','cass storage root|3-phosphoglyceric acid|ug/g|week 16|COMP:0000006','cass storage root|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000004','cass storage root|ADP|ug/g|week 16|COMP:0000005','cass upper stem|3-phosphoglyceric acid|ug/g|week 16|COMP:0000012','cass upper stem|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000008','cass upper stem|ADP|ug/g|week 16|COMP:0000009'],'data' => [['studyYear','studyDbId','studyName','studyDesign','locationDbId','locationName','germplasmDbId','germplasmName','germplasmSynonyms','observationLevel','observationUnitDbId','observationUnitName','replicate','blockNumber','plotNumber','cass sink leaf|3-phosphoglyceric acid|ug/g|week 16|COMP:0000013','cass sink leaf|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000011','cass sink leaf|ADP|ug/g|week 16|COMP:0000010','cass source leaf|3-phosphoglyceric acid|ug/g|week 16|COMP:0000002','cass source leaf|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000007','cass source leaf|ADP|ug/g|week 16|COMP:0000003','cass storage root|3-phosphoglyceric acid|ug/g|week 16|COMP:0000006','cass storage root|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000004','cass storage root|ADP|ug/g|week 16|COMP:0000005','cass upper stem|3-phosphoglyceric acid|ug/g|week 16|COMP:0000012','cass upper stem|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000008','cass upper stem|ADP|ug/g|week 16|COMP:0000009'],['2017',165,'CASS_6Genotypes_Sampling_2015','RCBD','23','test_location',41283,'IITA-TMS-IBA980581','','plot',41284,'CASS_6Genotypes_103','1','1','103','601.518','39.84365','655.92','1259.08','17.38275','192.1495','67.9959','20.3038','102.0875','108.56995','28.83915','379.16'],['2017',165,'CASS_6Genotypes_Sampling_2015','RCBD','23','test_location',41282,'IITA-TMS-IBA980002','','plot',41295,'CASS_6Genotypes_104','1','1','104','221.6135','36.12425','316.489','908.9045','29.6934','162.9475','23.09545','14.3795','85.9106','54.2099','13.8628','341.041'],['2017',165,'CASS_6Genotypes_Sampling_2015','RCBD','23','test_location',41279,'IITA-TMS-IBA30572','','plot',41296,'CASS_6Genotypes_105','1','1','105','662.087','46.1458','559.441','1974.265','38.1064','484.765','33.1455','16.7238','98.71395','97.8179','35.4435','439.9695'],['2017',165,'CASS_6Genotypes_Sampling_2015','RCBD','23','test_location',41281,'IITA-TMS-IBA011412','','plot',41297,'CASS_6Genotypes_106','1','1','106','612.37','23.788','604.5625','646.902','26.60415','192.46','39.6698','16.78125','107.74','78.72305','28.3805','469.818'],['2017',165,'CASS_6Genotypes_Sampling_2015','RCBD','23','test_location',41280,'TMEB693','','plot',41298,'CASS_6Genotypes_107','1','1','107','198.089','47.64845','485.944','779.191','21.12875','147.0405','31.554','10.59626','46.41935','101.7506','30.86975','423.355'],['2017',165,'CASS_6Genotypes_Sampling_2015','RCBD','23','test_location',41280,'TMEB693','','plot',41300,'CASS_6Genotypes_202','1','2','202','250.228','39.2627','478.0445','1295.29','21.56485','169.757','26.2744','5.31292','39.4774','61.51325','36.2316','241.418'],['2017',165,'CASS_6Genotypes_Sampling_2015','RCBD','23','test_location',41282,'IITA-TMS-IBA980002','','plot',41301,'CASS_6Genotypes_203','1','2','203','245.679','29.4029','299.096','1013.111','17.04795','202.893','40.306','7.442495','75.2132','57.47695','20.43645','303.3225'],['2017',165,'CASS_6Genotypes_Sampling_2015','RCBD','23','test_location',41283,'IITA-TMS-IBA980581','','plot',41302,'CASS_6Genotypes_204','1','2','204','235.825','31.0018','491.9535','1302.695','22.82925','281.091','74.1941','15.9235','83.2802','154.109','31.2364','849.9465']],'observationVariableDbIds' => [77559,77557,77556,77548,77553,77549,77552,77550,77551,77558,77554,77555],'headerRow' => ['studyYear','studyDbId','studyName','studyDesign','locationDbId','locationName','germplasmDbId','germplasmName','germplasmSynonyms','observationLevel','observationUnitDbId','observationUnitName','replicate','blockNumber','plotNumber'],'studyDbId' => '165'}}, 'study table');

$mech->get_ok('http://localhost:3010/brapi/v1/studies/165/layout?access_token='.$access_token);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'result' => {'data' => [{'germplasmDbId' => 41283,'studyDbId' => '165','observationUnitName' => 'CASS_6Genotypes_103','entryType' => 'Test','blockNumber' => '1','observationLevel' => 'plot','germplasmName' => 'IITA-TMS-IBA980581','Y' => '','observationUnitDbId' => 41284,'X' => '','additionalInfo' => {'plantDbIds' => [],'plantNames' => []},'replicate' => ''},{'additionalInfo' => {'plantNames' => [],'plantDbIds' => []},'replicate' => '','observationUnitDbId' => 41295,'Y' => '','germplasmName' => 'IITA-TMS-IBA980002','X' => '','entryType' => 'Test','blockNumber' => '1','observationUnitName' => 'CASS_6Genotypes_104','observationLevel' => 'plot','studyDbId' => '165','germplasmDbId' => 41282},{'studyDbId' => '165','germplasmDbId' => 41279,'observationLevel' => 'plot','blockNumber' => '1','entryType' => 'Test','observationUnitName' => 'CASS_6Genotypes_105','X' => '','observationUnitDbId' => 41296,'germplasmName' => 'IITA-TMS-IBA30572','Y' => '','replicate' => '','additionalInfo' => {'plantNames' => [],'plantDbIds' => []}},{'replicate' => '','additionalInfo' => {'plantDbIds' => [],'plantNames' => []},'X' => '','observationUnitDbId' => 41297,'Y' => '','germplasmName' => 'IITA-TMS-IBA011412','observationLevel' => 'plot','blockNumber' => '1','entryType' => 'Test','observationUnitName' => 'CASS_6Genotypes_106','studyDbId' => '165','germplasmDbId' => 41281},{'studyDbId' => '165','germplasmDbId' => 41280,'observationLevel' => 'plot','entryType' => 'Test','blockNumber' => '1','observationUnitName' => 'CASS_6Genotypes_107','X' => '','observationUnitDbId' => 41298,'germplasmName' => 'TMEB693','Y' => '','replicate' => '','additionalInfo' => {'plantDbIds' => [],'plantNames' => []}},{'germplasmName' => 'BLANK','Y' => '','observationUnitDbId' => 41299,'X' => '','additionalInfo' => {'plantNames' => [],'plantDbIds' => []},'replicate' => '','germplasmDbId' => 40326,'studyDbId' => '165','observationUnitName' => 'CASS_6Genotypes_201','blockNumber' => '2','entryType' => 'Test','observationLevel' => 'plot'},{'germplasmName' => 'TMEB693','Y' => '','observationUnitDbId' => 41300,'X' => '','additionalInfo' => {'plantDbIds' => [],'plantNames' => []},'replicate' => '','germplasmDbId' => 41280,'studyDbId' => '165','observationUnitName' => 'CASS_6Genotypes_202','entryType' => 'Test','blockNumber' => '2','observationLevel' => 'plot'},{'additionalInfo' => {'plantNames' => [],'plantDbIds' => []},'replicate' => '','observationUnitDbId' => 41301,'germplasmName' => 'IITA-TMS-IBA980002','Y' => '','X' => '','entryType' => 'Test','blockNumber' => '2','observationUnitName' => 'CASS_6Genotypes_203','observationLevel' => 'plot','studyDbId' => '165','germplasmDbId' => 41282},{'entryType' => 'Test','blockNumber' => '2','observationUnitName' => 'CASS_6Genotypes_204','observationLevel' => 'plot','studyDbId' => '165','germplasmDbId' => 41283,'additionalInfo' => {'plantNames' => [],'plantDbIds' => []},'replicate' => '','observationUnitDbId' => 41302,'germplasmName' => 'IITA-TMS-IBA980581','Y' => '','X' => ''},{'germplasmDbId' => 41281,'studyDbId' => '165','observationLevel' => 'plot','observationUnitName' => 'CASS_6Genotypes_205','blockNumber' => '2','entryType' => 'Test','X' => '','Y' => '','germplasmName' => 'IITA-TMS-IBA011412','observationUnitDbId' => 41285,'replicate' => '','additionalInfo' => {'plantDbIds' => [],'plantNames' => []}}]},'metadata' => {'datafiles' => [],'pagination' => {'totalCount' => 19,'pageSize' => 10,'currentPage' => 0,'totalPages' => 2},'status' => [{'info' => 'BrAPI base call found with page=0, pageSize=10'},{'info' => 'Loading CXGN::BrAPI::v1::Studies'},{'success' => 'Studies layout result constructed'}]}}, 'study layout');

$mech->get_ok('http://localhost:3010/brapi/v1/studies/165/observations?access_token='.$access_token);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'metadata' => {'datafiles' => [],'pagination' => {'totalCount' => 198,'pageSize' => 10,'totalPages' => 20,'currentPage' => 0},'status' => [{'info' => 'BrAPI base call found with page=0, pageSize=10'},{'info' => 'Loading CXGN::BrAPI::v1::Studies'},{'success' => 'Studies observations granular result constructed'}]},'result' => {'data' => [{'observationVariableDbId' => undef,'value' => '379.16','germplasmName' => 'IITA-TMS-IBA980581','observationUnitDbId' => '23','operator' => '','observationLevel' => undef,'observationVariableName' => 'cass upper stem|ADP|ug/g|week 16|COMP:0000009','uploadedBy' => '','observationUnitName' => 'CASS_6Genotypes_103','observationDbId' => 'RCBD','germplasmDbId' => 165,'observationTimestamp' => 41283,'studyDbId' => undef},{'observationUnitName' => 'CASS_6Genotypes_103','uploadedBy' => '','observationDbId' => 'RCBD','operator' => '','observationVariableName' => 'cass upper stem|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000008','observationLevel' => undef,'germplasmDbId' => 165,'observationTimestamp' => 41283,'studyDbId' => undef,'observationVariableDbId' => undef,'value' => '28.83915','germplasmName' => 'IITA-TMS-IBA980581','observationUnitDbId' => '23'},{'observationTimestamp' => 41283,'germplasmDbId' => 165,'studyDbId' => undef,'operator' => '','observationVariableName' => 'cass upper stem|3-phosphoglyceric acid|ug/g|week 16|COMP:0000012','observationLevel' => undef,'uploadedBy' => '','observationUnitName' => 'CASS_6Genotypes_103','observationDbId' => 'RCBD','germplasmName' => 'IITA-TMS-IBA980581','observationUnitDbId' => '23','observationVariableDbId' => undef,'value' => '108.56995'},{'observationVariableDbId' => undef,'value' => '102.0875','germplasmName' => 'IITA-TMS-IBA980581','observationUnitDbId' => '23','operator' => '','observationVariableName' => 'cass storage root|ADP|ug/g|week 16|COMP:0000005','observationLevel' => undef,'uploadedBy' => '','observationUnitName' => 'CASS_6Genotypes_103','observationDbId' => 'RCBD','germplasmDbId' => 165,'observationTimestamp' => 41283,'studyDbId' => undef},{'uploadedBy' => '','observationUnitName' => 'CASS_6Genotypes_103','observationDbId' => 'RCBD','operator' => '','observationLevel' => undef,'observationVariableName' => 'cass storage root|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000004','observationTimestamp' => 41283,'germplasmDbId' => 165,'studyDbId' => undef,'observationVariableDbId' => undef,'value' => '20.3038','germplasmName' => 'IITA-TMS-IBA980581','observationUnitDbId' => '23'},{'observationLevel' => undef,'observationVariableName' => 'cass storage root|3-phosphoglyceric acid|ug/g|week 16|COMP:0000006','operator' => '','observationDbId' => 'RCBD','uploadedBy' => '','observationUnitName' => 'CASS_6Genotypes_103','studyDbId' => undef,'observationTimestamp' => 41283,'germplasmDbId' => 165,'value' => '67.9959','observationVariableDbId' => undef,'observationUnitDbId' => '23','germplasmName' => 'IITA-TMS-IBA980581'},{'germplasmName' => 'IITA-TMS-IBA980581','observationUnitDbId' => '23','observationVariableDbId' => undef,'value' => '192.1495','germplasmDbId' => 165,'observationTimestamp' => 41283,'studyDbId' => undef,'uploadedBy' => '','observationUnitName' => 'CASS_6Genotypes_103','observationDbId' => 'RCBD','operator' => '','observationLevel' => undef,'observationVariableName' => 'cass source leaf|ADP|ug/g|week 16|COMP:0000003'},{'observationUnitDbId' => '23','germplasmName' => 'IITA-TMS-IBA980581','value' => '17.38275','observationVariableDbId' => undef,'studyDbId' => undef,'germplasmDbId' => 165,'observationTimestamp' => 41283,'observationDbId' => 'RCBD','uploadedBy' => '','observationUnitName' => 'CASS_6Genotypes_103','observationLevel' => undef,'observationVariableName' => 'cass source leaf|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000007','operator' => ''},{'germplasmDbId' => 165,'observationTimestamp' => 41283,'studyDbId' => undef,'uploadedBy' => '','observationUnitName' => 'CASS_6Genotypes_103','observationDbId' => 'RCBD','operator' => '','observationVariableName' => 'cass source leaf|3-phosphoglyceric acid|ug/g|week 16|COMP:0000002','observationLevel' => undef,'germplasmName' => 'IITA-TMS-IBA980581','observationUnitDbId' => '23','observationVariableDbId' => undef,'value' => '1259.08'},{'observationLevel' => undef,'observationVariableName' => 'cass sink leaf|ADP|ug/g|week 16|COMP:0000010','operator' => '','observationDbId' => 'RCBD','uploadedBy' => '','observationUnitName' => 'CASS_6Genotypes_103','studyDbId' => undef,'observationTimestamp' => 41283,'germplasmDbId' => 165,'value' => '655.92','observationVariableDbId' => undef,'observationUnitDbId' => '23','germplasmName' => 'IITA-TMS-IBA980581'}]}}, 'study observations');

$mech->get_ok('http://localhost:3010/brapi/v1/phenotypes-search?pageSize=2&access_token='.$access_token);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'result' => {'data' => [{'observationLevels' => 'plot','observationUnitDbId' => 39252,'observationUnitName' => 'KASESE_TP2013_1016','studyLocation' => 'test_location','studyLocationDbId' => '23','plotNumber' => '36031','germplasmDbId' => 39211,'Y' => undef,'observations' => [{'observationDbId' => 738999,'observationVariableDbId' => 70666,'value' => undef,'collector' => '','observationVariableName' => 'fresh root weight|CO_334:0000012','season' => '2014','observationTimestamp' => undef},{'season' => '2014','observationVariableName' => 'dry matter content percentage|CO_334:0000092','collector' => '','observationTimestamp' => undef,'value' => undef,'observationVariableDbId' => 70741,'observationDbId' => 738998},{'value' => undef,'observationVariableDbId' => 70773,'observationDbId' => 738997,'observationVariableName' => 'fresh shoot weight measurement in kg|CO_334:0000016','season' => '2014','collector' => '','observationTimestamp' => undef}],'observationLevel' => 'plot','treatments' => [],'X' => undef,'blockNumber' => '56','replicate' => '1','entryNumber' => '','studyName' => 'Kasese solgs trial','programName' => '','germplasmName' => 'UG130095','plantNumber' => '','entryType' => '','studyDbId' => 139},{'Y' => undef,'germplasmDbId' => 38945,'plotNumber' => '35975','studyLocationDbId' => '23','studyLocation' => 'test_location','observationLevel' => 'plot','observations' => [{'value' => '2.22','observationVariableDbId' => 70666,'observationDbId' => 737508,'observationTimestamp' => undef,'season' => '2014','observationVariableName' => 'fresh root weight|CO_334:0000012','collector' => ''},{'observationVariableDbId' => 70741,'value' => '24.4','observationDbId' => 737507,'observationTimestamp' => undef,'observationVariableName' => 'dry matter content percentage|CO_334:0000092','season' => '2014','collector' => ''},{'value' => '2','observationVariableDbId' => 70773,'observationDbId' => 737506,'observationTimestamp' => undef,'observationVariableName' => 'fresh shoot weight measurement in kg|CO_334:0000016','season' => '2014','collector' => ''}],'observationUnitName' => 'KASESE_TP2013_962','observationUnitDbId' => 39253,'observationLevels' => 'plot','plantNumber' => '','entryType' => '','germplasmName' => 'UG120076','programName' => '','studyDbId' => 139,'treatments' => [],'X' => undef,'studyName' => 'Kasese solgs trial','entryNumber' => '','replicate' => '1','blockNumber' => '47'}]},'metadata' => {'datafiles' => [],'pagination' => {'currentPage' => 0,'totalPages' => 508,'totalCount' => 1016,'pageSize' => 2},'status' => [{'info' => 'BrAPI base call found with page=0, pageSize=2'},{'info' => 'Loading CXGN::BrAPI::v1::Phenotypes'},{'success' => 'Studies observations result constructed'}]}}, 'phenotype search');

$mech->get_ok('http://localhost:3010/brapi/v1/phenotypes-search?pageSize=2&studyDbId=165&access_token='.$access_token);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'metadata' => {'pagination' => {'totalPages' => 508,'currentPage' => 0,'pageSize' => 2,'totalCount' => 1016},'status' => [{'info' => 'BrAPI base call found with page=0, pageSize=2'},{'info' => 'Loading CXGN::BrAPI::v1::Phenotypes'},{'success' => 'Studies observations result constructed'}],'datafiles' => []},'result' => {'data' => [{'studyName' => 'Kasese solgs trial','entryNumber' => '','replicate' => '1','blockNumber' => '56','treatments' => [],'X' => undef,'studyDbId' => 139,'entryType' => '','plantNumber' => '','germplasmName' => 'UG130095','programName' => '','observationUnitName' => 'KASESE_TP2013_1016','observationUnitDbId' => 39252,'observationLevels' => 'plot','observationLevel' => 'plot','observations' => [{'observationVariableDbId' => 70666,'value' => undef,'observationDbId' => 738999,'season' => '2014','observationVariableName' => 'fresh root weight|CO_334:0000012','collector' => '','observationTimestamp' => undef},{'observationTimestamp' => undef,'collector' => '','season' => '2014','observationVariableName' => 'dry matter content percentage|CO_334:0000092','observationDbId' => 738998,'value' => undef,'observationVariableDbId' => 70741},{'observationVariableDbId' => 70773,'value' => undef,'observationDbId' => 738997,'observationTimestamp' => undef,'season' => '2014','observationVariableName' => 'fresh shoot weight measurement in kg|CO_334:0000016','collector' => ''}],'Y' => undef,'plotNumber' => '36031','germplasmDbId' => 39211,'studyLocation' => 'test_location','studyLocationDbId' => '23'},{'observationUnitDbId' => 39253,'observationLevels' => 'plot','observationUnitName' => 'KASESE_TP2013_962','observationLevel' => 'plot','observations' => [{'observationVariableDbId' => 70666,'value' => '2.22','observationDbId' => 737508,'season' => '2014','observationVariableName' => 'fresh root weight|CO_334:0000012','collector' => '','observationTimestamp' => undef},{'collector' => '','season' => '2014','observationVariableName' => 'dry matter content percentage|CO_334:0000092','observationTimestamp' => undef,'observationDbId' => 737507,'value' => '24.4','observationVariableDbId' => 70741},{'observationDbId' => 737506,'value' => '2','observationVariableDbId' => 70773,'collector' => '','observationVariableName' => 'fresh shoot weight measurement in kg|CO_334:0000016','season' => '2014','observationTimestamp' => undef}],'studyLocationDbId' => '23','studyLocation' => 'test_location','Y' => undef,'germplasmDbId' => 38945,'plotNumber' => '35975','blockNumber' => '47','entryNumber' => '','studyName' => 'Kasese solgs trial','replicate' => '1','X' => undef,'treatments' => [],'studyDbId' => 139,'germplasmName' => 'UG120076','programName' => '','entryType' => '','plantNumber' => ''}]}}, 'phenotype search study 139');

$mech->get_ok('http://localhost:3010/brapi/v1/traits?pageSize=1&page=1&access_token='.$access_token );
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {}, 'traits');

$mech->get_ok('http://localhost:3010/brapi/v1/maps?pageSize=1&page=1&access_token='.$access_token );
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {}, 'maps');

$mech->get_ok('http://localhost:3010/brapi/v1/locations?pageSize=1&page=1&access_token='.$access_token );
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'metadata' => {'datafiles' => [],'status' => [{'info' => 'BrAPI base call found with page=1, pageSize=1'},{'info' => 'Loading CXGN::BrAPI::v1::Locations'},{'success' => 'Locations list result constructed'}],'pagination' => {'totalPages' => 3,'pageSize' => 1,'totalCount' => 3,'currentPage' => 1}},'result' => {'data' => [{'locationType' => '','latitude' => '42.4534','name' => 'Cornell Biotech','locationDbId' => 24,'countryName' => 'United States','instituteAddress' => '','longitude' => '-76.4735','altitude' => '274','countryCode' => 'USA','abbreviation' => '','instituteName' => '','additionalInfo' => {'geodetic datum' => undef}}]}}, 'location');

$mech->get_ok('http://localhost:3010/brapi/v1/ontologies?access_token='.$access_token );
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {}, 'ontologies');

$mech->get_ok('http://localhost:3010/brapi/v1/variables?access_token='.$access_token );
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {}, 'variables');

$mech->get_ok('http://localhost:3010/brapi/v1/variables-search?access_token='.$access_token );
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {}, 'variables-search');

$mech->get_ok('http://localhost:3010/brapi/v1/samples?access_token='.$access_token );
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {}, 'samples');

done_testing();
